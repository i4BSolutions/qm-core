# Milestone v1.3: UX & Bug Fixes

**Status:** SHIPPED 2026-02-02
**Phases:** 13-16
**Total Plans:** 11

## Overview

Users experience consistent input behavior, standardized currency display, and can edit entities from detail pages while status change notes are properly captured in audit history.

## Phases

### Phase 13: Verification & Quick Fixes
**Goal**: Verify already-deployed features work correctly and fix any gaps in attachment deletion and QMHQ fulfillment
**Depends on**: Phase 12
**Requirements**: ATCH-01, ATCH-02, FULF-01, FULF-02, FULF-03
**Plans**: 2 plans

Plans:
- [x] 13-01-PLAN.md - Fix attachment delete permission UI to match RLS policy
- [x] 13-02-PLAN.md - Add fulfillment progress tracking and stock-out restrictions

**Success Criteria:**
1. User who uploaded an attachment can delete it from QMRL/QMHQ detail page
2. Admin and Quartermaster can delete any attachment regardless of uploader
3. QMHQ item route stock-out is only accessible from QMHQ detail page
4. Stock-out quantity cannot exceed remaining unfulfilled quantity
5. QMHQ detail page shows fulfillment progress indicator

### Phase 14: Currency & Number Input Standardization
**Goal**: Number inputs preserve user-typed values and currency displays show original value with EUSD equivalent
**Depends on**: Phase 13
**Requirements**: NINP-01, NINP-02, NINP-03, NINP-04, CURR-01, CURR-02, CURR-03
**Plans**: 7 plans

Plans:
- [x] 14-01-PLAN.md - Create number input utilities (keydown handlers, validators)
- [x] 14-02-PLAN.md - Create CurrencyDisplay component for two-line format
- [x] 14-03-PLAN.md - Update inventory and QMHQ forms with number input handlers
- [x] 14-04-PLAN.md - Update PO and Invoice forms with number input handlers
- [x] 14-05-PLAN.md - Update card components and list pages with CurrencyDisplay
- [x] 14-06-PLAN.md - Update QMHQ, PO, Invoice detail pages with CurrencyDisplay
- [x] 14-07-PLAN.md - Update warehouse, item, QMRL detail pages with CurrencyDisplay

**Success Criteria:**
1. Typing a number and clicking away preserves the exact typed value
2. Empty number inputs show blank (not "0" or "0.00")
3. Amount fields format to 2 decimal places only when form is submitted
4. Exchange rate fields format to 4 decimal places only when form is submitted
5. Financial amounts display original currency value (USD, THB, etc.)
6. EUSD equivalent appears alongside original currency in all financial displays
7. Currency formatting is consistent across all entity views

### Phase 15: Edit Capability
**Goal**: Users can edit entities directly from their detail pages with permission-based visibility
**Depends on**: Phase 14
**Requirements**: EDIT-01, EDIT-02, EDIT-03, EDIT-04
**Plans**: 1 plan

Plans:
- [x] 15-01-PLAN.md - Add permission-gated Edit buttons to detail pages

**Success Criteria:**
1. QMRL detail page has Edit button that routes to the edit form
2. QMHQ detail page has Edit button that routes to the edit form
3. PO detail page has Edit button that routes to the edit form (hidden when closed)
4. Invoice detail page shows view-only with no Edit button

### Phase 16: Audit Notes Feature
**Goal**: Status change notes are captured in audit log and displayed in History tab
**Depends on**: Phase 15
**Requirements**: HIST-01, HIST-02
**Plans**: 1 plan

Plans:
- [x] 16-01-PLAN.md - Create RPC for status updates with notes and wire UI

**Success Criteria:**
1. When user changes status with a note, the note appears in the History tab entry
2. Audit log records include user-entered reason/notes for status changes
3. Status changes without notes still appear in History
4. No duplicate audit entries when status is changed

---

## Milestone Summary

**Key Decisions:**
- Attachment delete per-file ownership check — Users can delete own uploads, admin/quartermaster can delete any
- FulfillmentProgressBar emerald color gradient — Matches existing Complete badge styling
- Max issuable qty = min(available stock, remaining QMHQ qty) — Prevents over-issuance
- General stock-out excludes QMHQ-assigned items — Items in QMHQ item routes only issuable from QMHQ
- EUSD line always shown even for USD currency — Visual consistency
- CurrencyDisplay size variants (sm/md/lg) — Typography scaling for different UI contexts
- Quartermaster cannot edit PO — Explicit business rule override of permission matrix
- Invoice has no Edit button — Void functionality serves as modification mechanism
- Permission-gated buttons with can() check — Wrap action buttons in conditional permission check
- RPC creates audit entry before entity update — Enables trigger deduplication
- 2-second time window for audit deduplication — Balances race condition protection vs. usability

**Issues Resolved:**
- Attachment delete permissions now match RLS policy at UI level
- Number inputs no longer auto-format on blur
- Currency display standardized to original + EUSD format
- Status change notes now captured in audit log

**Technical Debt:**
- PO Edit page does not exist at /po/[id]/edit (pre-existing, Edit button links to 404)

---

*Archived: 2026-02-02*
*For current project status, see .planning/ROADMAP.md*
