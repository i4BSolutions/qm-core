# Milestone v1.4: UX Enhancements & Workflow Improvements

**Status:** SHIPPED 2026-02-06
**Phases:** 17-22
**Total Plans:** 9

## Overview

v1.4 focused on improving file attachment workflows, enhancing number display formatting, and streamlining item/PO creation with inline capabilities.

## Phases

### Phase 17: Attachment Delete Fixes

**Goal**: Users can delete attachments on QMRL and QMHQ detail pages without errors
**Depends on**: Phase 16
**Requirements**: ATCH-02, ATCH-03
**Plans**: 1 plan

Plans:
- [x] 17-01-PLAN.md - Fix deleteFile query pattern (fetch before update)

**Success Criteria:**
1. User can delete own attachment on QMRL detail page without RLS or database errors
2. User can delete own attachment on QMHQ detail page without RLS or database errors
3. Admin/Quartermaster can delete any attachment on both pages without errors
4. Deleted attachments are removed from UI immediately after successful deletion

### Phase 18: QMRL Create Attachments

**Goal**: Users can upload files during QMRL creation before the entity is saved
**Depends on**: Phase 17
**Requirements**: ATCH-01
**Plans**: 1 plan

Plans:
- [x] 18-01-PLAN.md - Staged file upload with Upload-After-Create pattern

**Success Criteria:**
1. User sees file upload area in QMRL create form
2. User can select and preview files before submitting form
3. Files are uploaded and linked to QMRL after entity creation succeeds
4. Failed file uploads do not block QMRL creation (graceful degradation)

### Phase 19: QMHQ Creation Workflow Enhancement

**Goal**: Users see full QMRL context when creating QMHQ without leaving the creation flow
**Depends on**: Phase 17
**Requirements**: QMHQ-01
**Plans**: 1 plan

Plans:
- [x] 19-01-PLAN.md - QMRL context panel with responsive layout and attachment preview

**Success Criteria:**
1. User sees side panel showing QMRL details when creating QMHQ
2. Side panel displays QMRL title, description, status, category, and key fields
3. Side panel remains visible throughout multi-step QMHQ creation
4. Panel can be collapsed/expanded without losing QMHQ form state

### Phase 20: Number Display Formatting

**Goal**: Financial amounts display with thousand separators and fit within containers
**Depends on**: Phase 17
**Requirements**: NUMD-01, NUMD-02
**Plans**: 1 plan

Plans:
- [x] 20-01-PLAN.md - AmountInput/ExchangeRateInput components with thousand separators

**Success Criteria:**
1. Amount input fields show thousand separators as user types (1000 -> 1,000)
2. Separators are stripped before form submission (clean numeric values)
3. Large amounts (millions/billions) display responsively without overflow
4. Currency display components handle long values without breaking layout

### Phase 21: Item Enhancements

**Goal**: Items support price reference notes and auto-generated SKU codes based on category
**Depends on**: Phase 20
**Requirements**: ITEM-01, ITEM-02, ITEM-03
**Plans**: 2 plans

Plans:
- [x] 21-01-PLAN.md - Database migration (price_reference, SKU trigger, backfill) + Tooltip component
- [x] 21-02-PLAN.md - UI updates (Item Dialog, Item List, PO Line Items)

**Success Criteria:**
1. User can enter price reference note when creating/editing an item
2. Price reference displays in PO line item selector as tooltip on hover
3. Item codes auto-generate as SKU-[CAT]-[XXXX] format on item save
4. Code cannot be overridden by user (immutable once generated)
5. Category is required for new item creation

### Phase 22: PO Inline Item Creation & Validation

**Goal**: Users can create new items inline during PO entry and contact person is enforced for financial routes
**Depends on**: Phase 21
**Requirements**: POCR-01, AUTH-01, CONT-01, CONT-02
**Plans**: 3 plans

Plans:
- [x] 22-01-PLAN.md - Inline item creation in PO line items via ItemDialog
- [x] 22-02-PLAN.md - Contact person validation for Expense and PO routes
- [x] 22-03-PLAN.md - Multi-tab session handling with cross-tab logout sync

**Success Criteria:**
1. User can create new item inline from PO line item selector without leaving PO form
2. Newly created item immediately appears in selector and can be added to PO
3. User can work across multiple browser tabs without authentication errors
4. Money-Out transactions (Expense route) require contact person before save
5. PO route transactions require contact person before save

---

## Milestone Summary

**Key Decisions:**
- Fetch-Before-Update pattern for soft-delete with RLS
- Upload-After-Create pattern with sessionStorage progress tracking
- QmrlContextPanel with responsive desktop/mobile layout
- react-number-format for automatic thousand separator handling
- SKU format SKU-[CAT]-[XXXX] with random 3-letter category codes
- Dialog callback pattern with return value for inline creation
- BroadcastChannel with Safari fallback for cross-tab logout sync

**Issues Resolved:**
- Attachment delete RLS conflicts (fetch before update)
- No file upload in QMRL create form (staged upload pattern)
- Lost context when creating QMHQ (side panel)
- Number inputs without thousand separators
- Missing item price reference in PO
- No inline item creation during PO entry
- Multi-tab authentication errors

**Technical Debt Carried Forward:**
- PO Edit page does not exist at /po/[id]/edit (Edit button links to 404)
- Auto stock-out trigger handles only single-item QMHQ (multi-item enhancement needed)

---

_For current project status, see .planning/ROADMAP.md_
