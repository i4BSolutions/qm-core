# Milestone v1.1: QM System Enhancement

**Status:** ✅ SHIPPED 2026-01-28
**Phases:** 1-6
**Total Plans:** 17

## Overview

QM System V1.1 builds on the completed V1.0 foundation to deliver critical bug fixes, comprehensive file attachment capabilities, a management dashboard for visibility, and enhanced UX through inline status updates and transaction viewing. This roadmap prioritizes unblocking broken workflows first (PO creation, stock-in), establishes secure file storage infrastructure before UI, enables management oversight through live dashboards, and polishes the user experience with quick-access interactions.

## Phases

### Phase 1: Critical Bug Fixes
**Goal**: Users can create purchase orders and receive inventory without errors
**Depends on**: Nothing (first phase)
**Requirements**: BUG-01, BUG-02, BUG-03, BUG-04, INV-01, INV-02
**Plans**: 3 plans

Plans:
- [x] 01-01-PLAN.md — Investigate and fix PO creation workflow
- [x] 01-02-PLAN.md — Investigate and fix stock-in functionality
- [x] 01-03-PLAN.md — Verify invoice creation and stock-out, confirm invoice qty validation

**Success Criteria** (all verified):
1. User can create PO from QMHQ (PO route) without system errors
2. User can complete stock-in transaction from invoice without system errors
3. Invoice creation wizard completes all 3 steps successfully
4. Stock-out form processes transactions and updates warehouse quantities
5. Invoice line item quantity validation enforces PO quantity limits
6. Invoice total amount can exceed PO total amount (price flexibility)

### Phase 2: File Storage Foundation
**Goal**: Secure file storage infrastructure ready for uploads
**Depends on**: Phase 1
**Requirements**: FILE-05, FILE-06, FILE-12
**Plans**: 2 plans

Plans:
- [x] 02-01-PLAN.md — Create file attachments table and storage bucket with RLS
- [x] 02-02-PLAN.md — Build server-side upload/delete utilities with validation

**Success Criteria** (all verified):
1. File attachments table exists with RLS policies mirroring entity permissions
2. Supabase Storage bucket configured with RLS policies on storage.objects
3. Server-side validation enforces file type allowlist and 25MB size limit
4. File deletion removes both metadata and storage object (no orphans)

### Phase 3: File Upload UI
**Goal**: Users can attach files to QMRL and QMHQ entities via detail pages
**Depends on**: Phase 2
**Requirements**: FILE-02, FILE-04, FILE-08, FILE-11
**Plans**: 3 plans

Plans:
- [x] 03-01-PLAN.md — Build file upload components (dropzone, cards, progress, delete dialog)
- [x] 03-02-PLAN.md — Integrate file upload into QMRL detail page
- [x] 03-03-PLAN.md — Integrate file upload into QMHQ detail page

**Success Criteria** (all verified):
1. User can drag-drop files onto QMRL detail page to upload
2. User can drag-drop files onto QMHQ detail page to upload
3. User sees list of uploaded files sorted by upload date with thumbnail previews
4. Upload progress indicators display during file transfer

### Phase 4: File Preview & Download
**Goal**: Users can view files without leaving the application
**Depends on**: Phase 3
**Requirements**: FILE-09, FILE-10, FILE-13
**Plans**: 3 plans

Plans:
- [x] 04-01-PLAN.md — Preview modal foundation and image preview with zoom controls
- [x] 04-02-PLAN.md — PDF preview with react-pdf page navigation
- [x] 04-03-PLAN.md — Download All as ZIP functionality

**Success Criteria** (all verified):
1. User can click image file to see full-size inline preview
2. User can click PDF file to see in-app document viewer
3. User can download all files as ZIP archive in one click
4. Preview modal shows file metadata (name, size, upload date, uploader)

### Phase 5: Management Dashboard
**Goal**: Admin and Quartermaster roles have real-time visibility into system activity
**Depends on**: Phase 1 (independent of file features)
**Requirements**: DASH-01, DASH-02, DASH-03, DASH-04, DASH-05, DASH-06, DASH-07
**Plans**: 3 plans

Plans:
- [x] 05-01-PLAN.md — Create dashboard RPC functions, server action, and polling hook
- [x] 05-02-PLAN.md — Build dashboard UI components (status bar, KPI cards, alerts, timelines)
- [x] 05-03-PLAN.md — Integrate components with role-based routing and auto-refresh

**Success Criteria** (all verified):
1. Admin and Quartermaster see live dashboard when visiting /dashboard
2. Non-management roles redirect to their primary workflow page
3. Dashboard displays QMRL counts grouped by status (to_do, in_progress, done)
4. Dashboard displays QMHQ counts grouped by status
5. Dashboard shows low stock alerts for items below 10 units
6. Dashboard shows 5 most recent audit log entries
7. Dashboard shows recent stock movements (in/out transactions)

### Phase 6: Status & Transaction UX
**Goal**: Users can make quick updates without full edit forms
**Depends on**: Phase 5
**Requirements**: UX-01, UX-02, UX-03, UX-04, UX-05, UX-08, UX-09
**Plans**: 3 plans

Plans:
- [x] 06-01-PLAN.md — Build quick status change component with dropdown and confirmation dialog
- [x] 06-02-PLAN.md — Build view-only transaction detail modal
- [x] 06-03-PLAN.md — Standardize date picker UI across all forms

**Success Criteria** (all verified):
1. User can click QMRL status badge to change status via dropdown
2. User can click QMHQ status badge to change status via dropdown
3. Status changes appear in audit history with user and timestamp
4. User can click View button on transaction row to open detail modal
5. Transaction modal displays full transaction data in read-only view
6. Transaction amount and exchange rate remain read-only (audit integrity)
7. Date picker UI matches DD/MM/YYYY format across all forms

## Progress

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 1. Critical Bug Fixes | 3/3 | Complete | 2026-01-27 |
| 2. File Storage Foundation | 2/2 | Complete | 2026-01-27 |
| 3. File Upload UI | 3/3 | Complete | 2026-01-28 |
| 4. File Preview & Download | 3/3 | Complete | 2026-01-28 |
| 5. Management Dashboard | 3/3 | Complete | 2026-01-28 |
| 6. Status & Transaction UX | 3/3 | Complete | 2026-01-28 |

---

## Milestone Summary

**Key Decisions:**
- Supabase Storage for files (already using Supabase, no new infrastructure)
- Global low stock threshold (10 units) — simpler than per-item config
- Transaction amount locked after creation (audit integrity)
- Full preview for all file types (better UX than download-only)
- Dashboard for Admin/Quartermaster only (other roles redirect)
- Quick status via badge click (minimal UI change, intuitive)

**Issues Resolved:**
- PO creation workflow broken (fixed audit trigger schema handling)
- Stock-in not working (fixed currency/exchange_rate defaults)
- Invoice quantity validation needed (added UI + database trigger)

**Issues Deferred:**
- FILE-01, FILE-03: Create form uploads (entity must exist first)
- UX-06, UX-07: Transaction editing (audit integrity by design)
- Real-time dashboard updates (polling sufficient)
- Per-item stock thresholds (global default sufficient)

**Technical Debt Incurred:**
- None — all implementations complete without shortcuts

---

_For current project status, see .planning/ROADMAP.md_
_Archived: 2026-01-28_
