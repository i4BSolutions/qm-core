---
phase: 51-standard-unit-entity-admin
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/20260216100000_standard_units.sql
  - types/database.ts
  - app/(dashboard)/admin/settings/page.tsx
autonomous: true

must_haves:
  truths:
    - "standard_units table exists with name, display_order, and audit columns"
    - "9 seed units exist in correct order: pcs, kg, g, L, mL, m, cm, box, pack"
    - "RLS enforces admin-only write, all-users read on standard_units"
    - "Hard delete is blocked when items reference a unit (DB constraint ready for Phase 52 FK)"
    - "Global standard_unit_name setting removed from /admin/settings page"
    - "system_config standard_unit_name row deleted from database"
  artifacts:
    - path: "supabase/migrations/20260216100000_standard_units.sql"
      provides: "standard_units table, RLS, seed data, system_config cleanup"
      contains: "CREATE TABLE.*standard_units"
    - path: "types/database.ts"
      provides: "StandardUnit type alias"
      contains: "StandardUnit"
    - path: "app/(dashboard)/admin/settings/page.tsx"
      provides: "Settings page without standard unit config"
  key_links:
    - from: "types/database.ts"
      to: "supabase/migrations/20260216100000_standard_units.sql"
      via: "StandardUnit type matches table schema"
      pattern: "StandardUnit.*Tables.*standard_units"
---

<objective>
Create the standard_units database table with seed data, RLS policies, and TypeScript types. Remove the global standard_unit_name system_config entry and its admin settings UI since standard units are now managed as entities.

Purpose: Foundation for standard unit entity management - table must exist before admin UI can be built.
Output: Database migration, updated types, cleaned-up admin settings page.
</objective>

<execution_context>
@/home/yaungni/.claude/get-shit-done/workflows/execute-plan.md
@/home/yaungni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@supabase/migrations/20260214210000_system_config.sql
@types/database.ts
@app/(dashboard)/admin/settings/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create standard_units table migration with seed data and remove global config</name>
  <files>supabase/migrations/20260216100000_standard_units.sql</files>
  <action>
Create a new migration file that does TWO things:

**Part 1: Create standard_units table**
- Table name: `standard_units`
- Columns:
  - `id` UUID PRIMARY KEY DEFAULT gen_random_uuid()
  - `name` TEXT NOT NULL UNIQUE (e.g., "kg", "pcs")
  - `display_order` INTEGER NOT NULL DEFAULT 0
  - `created_at` TIMESTAMPTZ DEFAULT NOW()
  - `updated_at` TIMESTAMPTZ DEFAULT NOW()
  - `created_by` UUID REFERENCES public.users(id) ON DELETE SET NULL
  - `updated_by` UUID REFERENCES public.users(id) ON DELETE SET NULL
- Apply `update_updated_at_column()` trigger (same pattern as other tables)
- Index on `display_order` for sorting
- NO `is_active` column (hard delete per decision, no soft delete)

**RLS Policies:**
- Enable RLS on the table
- SELECT: All authenticated users (`USING (true)`)
- INSERT: Admin only (`WITH CHECK (public.get_user_role() = 'admin')`)
- UPDATE: Admin only (`USING (public.get_user_role() = 'admin')`)
- DELETE: Admin only (`USING (public.get_user_role() = 'admin')`)

**Seed data** (9 units in sensible order):
1. pcs (display_order: 1) - most common
2. kg (display_order: 2)
3. g (display_order: 3)
4. L (display_order: 4)
5. mL (display_order: 5)
6. m (display_order: 6)
7. cm (display_order: 7)
8. box (display_order: 8)
9. pack (display_order: 9)

Use INSERT with ON CONFLICT (name) DO NOTHING for idempotency.

**Part 2: Remove global standard_unit_name from system_config**
At the end of the migration, add:
```sql
DELETE FROM public.system_config WHERE key = 'standard_unit_name';
```

Add table and column COMMENT statements for documentation.

NOTE: Do NOT add any FK from items table to standard_units. Phase 52 handles that.
  </action>
  <verify>
Run `npm run type-check` to ensure no TypeScript errors. The migration file should be syntactically valid SQL. Verify the file contains CREATE TABLE, all 9 INSERT statements, RLS policies, and the DELETE from system_config.
  </verify>
  <done>
standard_units table migration exists with correct schema, 9 seed units, admin-only RLS, updated_at trigger, and system_config cleanup. No FK to items table.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add StandardUnit type and update admin settings page</name>
  <files>
    types/database.ts
    app/(dashboard)/admin/settings/page.tsx
  </files>
  <action>
**1. Update types/database.ts:**
Add a `StandardUnit` interface near the other type aliases (after the `Category` line):

```typescript
export interface StandardUnit {
  id: string;
  name: string;
  display_order: number;
  created_at: string;
  updated_at: string;
  created_by: string | null;
  updated_by: string | null;
}
```

Use a manual interface (not `Tables<"standard_units">`) since the generated types may not be updated yet. This matches the pattern used for `QMHQItem`.

**2. Update admin settings page:**
The settings page at `app/(dashboard)/admin/settings/page.tsx` currently ONLY contains the standard unit name configuration. Since that's being removed, replace the entire page content with a simple placeholder that says "No configurable settings at this time" or similar. Keep the PageHeader with the same styling.

Remove the standard-unit-specific imports (Ruler, useStandardUnitName), the state variables for unitName, the fetchConfig/handleSave functions, and the entire Standard Unit Configuration card. Replace with a simple info message indicating no settings are currently available.

Alternatively, since the page becomes empty, it could show a clean "System Settings" page with a message like "Standard units are now managed in the Standard Units admin page." Keep it minimal - just PageHeader + info card.

Remove the `useUser` import and `user` usage since it was only needed for the save functionality. Remove the `useCallback` import if no longer needed.
  </action>
  <verify>
Run `npm run type-check` to verify no TypeScript errors. Check that `StandardUnit` type is exported from `types/database.ts`. Check that the admin settings page no longer references `system_config` or `standard_unit_name`.
  </verify>
  <done>
StandardUnit type is defined and exported. Admin settings page no longer manages standard unit name configuration. Build passes with no new errors.
  </done>
</task>

</tasks>

<verification>
1. `npm run type-check` passes with no new errors
2. Migration file contains CREATE TABLE standard_units with correct columns
3. Migration file contains 9 INSERT statements for seed data
4. Migration file contains 4 RLS policies (SELECT, INSERT, UPDATE, DELETE)
5. Migration file contains DELETE FROM system_config WHERE key = 'standard_unit_name'
6. types/database.ts exports StandardUnit type
7. Admin settings page compiles without standard unit configuration
</verification>

<success_criteria>
- Database foundation for standard units is complete
- Global standard_unit_name config entry is removed
- Admin settings page is cleaned up
- TypeScript types are ready for Phase 51 Plan 02 to build admin UI
</success_criteria>

<output>
After completion, create `.planning/phases/51-standard-unit-entity-admin/51-01-SUMMARY.md`
</output>
