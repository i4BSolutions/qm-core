---
phase: 07.1
plan: 01
subsystem: ui-permissions
tags: [permissions, ui, calendar, attachments, rbac]
requires: [07-02]
provides:
  - role-based attachment delete permissions
  - simplified calendar navigation
affects: []
tech-stack:
  added: []
  patterns: [role-based-ui-permissions]
key-files:
  created: []
  modified:
    - app/(dashboard)/qmrl/[id]/page.tsx
    - app/(dashboard)/qmhq/[id]/page.tsx
    - components/ui/calendar.tsx
decisions:
  - attachment-delete-admin-only: "Only admin and quartermaster roles can delete attachments, matching RLS policy enforcement"
  - calendar-navigation-arrows-only: "Simplified calendar to show only left/right arrow navigation without month/year dropdowns for better UX"
metrics:
  duration: 8.5 minutes
  completed: 2026-01-29
---

# Phase 07.1 Plan 01: Attachment & Calendar UX Fixes Summary

**One-liner:** Role-based attachment delete permissions enforced in UI, calendar navigation simplified to arrows-only.

## What Was Built

### Task 1: Attachment Delete Permissions
- Added `canEditAttachments` permission calculation based on user role in QMRL detail page
- Added `canEditAttachments` permission calculation based on user role in QMHQ detail page
- Imported `useAuth` hook to access current user's role
- Modified `AttachmentsTab` component prop from `canEdit={true}` to `canEdit={canEditAttachments}`
- Only users with `admin` or `quartermaster` roles can now see delete buttons on attachments
- UI now correctly reflects RLS policy permissions that were already enforced at database level

### Task 2: Calendar Navigation Simplification
- Changed `captionLayout` prop from `"dropdown-buttons"` to `"buttons"` in Calendar component
- Removed `fromYear={2020}` prop (no longer needed without dropdowns)
- Removed `toYear={2030}` prop (no longer needed without dropdowns)
- Removed dropdown-related classNames:
  - `caption_dropdowns`
  - `dropdown`
  - `dropdown_month`
  - `dropdown_year`
- Calendar now displays only left/right arrow buttons for month navigation
- Simplified user experience eliminates unnecessary complexity

## Technical Implementation

### Permission Check Pattern
```tsx
const { user } = useAuth();
const canEditAttachments = user?.role === 'admin' || user?.role === 'quartermaster';

<AttachmentsTab canEdit={canEditAttachments} />
```

### Calendar Configuration
```tsx
<DayPicker
  captionLayout="buttons"  // arrows-only navigation
  // No fromYear/toYear props
  // No dropdown classNames
/>
```

## Files Modified

### app/(dashboard)/qmrl/[id]/page.tsx
- Added `useAuth` import
- Added `canEditAttachments` permission calculation
- Changed AttachmentsTab canEdit prop to use calculated permission

### app/(dashboard)/qmhq/[id]/page.tsx
- Added `canEditAttachments` permission calculation (useAuth already imported)
- Changed AttachmentsTab canEdit prop to use calculated permission

### components/ui/calendar.tsx
- Simplified DayPicker configuration
- Removed year range constraints
- Removed dropdown-related styling classes

## Decisions Made

### 1. Attachment Delete Restriction
**Decision:** Only admin and quartermaster roles can delete attachments in UI
**Rationale:**
- RLS policies already enforce this at database level
- UI was incorrectly showing delete buttons to all users
- Admin and quartermaster are trusted roles for data management
- Matches existing permission patterns in the system

**Alternatives Considered:**
- Allow all users to delete their own uploads: Rejected because attachments are shared documentation
- Add per-attachment ownership: Rejected as overly complex for this use case

### 2. Calendar Navigation Simplification
**Decision:** Show only arrow navigation without month/year dropdowns
**Rationale:**
- User feedback indicated dropdowns were confusing
- Arrow navigation is more intuitive for most use cases
- Reduces visual clutter
- Most date selections are near current month

**Alternatives Considered:**
- Keep both arrows and dropdowns: Rejected due to user confusion
- Add different navigation method: Rejected to maintain simplicity

## Deviations from Plan

None - plan executed exactly as written.

## Next Phase Readiness

### Blockers
None

### Concerns
None - these were isolated UI improvements

### Recommendations
1. Monitor user feedback on calendar navigation simplicity
2. Consider adding keyboard navigation for power users (future enhancement)
3. Document role-based permission pattern for future UI components

## Testing Notes

### Verification Performed
1. ✅ `npm run build` - Completed without errors
2. ✅ `npm run lint` - No ESLint warnings or errors
3. ✅ TypeScript compilation successful
4. ✅ All page routes generated successfully

### Manual Testing Required
1. Login as admin user - verify delete icons visible on attachment cards
2. Login as requester user - verify delete icons NOT visible on attachment cards
3. Open any date picker - verify only left/right arrows appear
4. Navigate between months using arrows - verify correct behavior
5. Verify upload dropzone follows same permission pattern

## Metrics

- **Duration:** 8.5 minutes
- **Tasks completed:** 2/2
- **Files modified:** 3
- **Commits created:** 2 (1 per task)
- **Build time:** ~45 seconds
- **Zero errors:** All builds and lints passed

## Commit History

1. **3984fdd** - `fix(07.1-01): restrict attachment delete to admin/quartermaster roles`
   - Added role-based permission checks in QMRL and QMHQ detail pages

2. **322f3ef** - `refactor(07.1-01): simplify calendar navigation to arrows-only`
   - Removed dropdown selectors from calendar component
