---
phase: 40-ui-consistency-rollout
plan: 05
type: execute
wave: 3
depends_on: []
files_modified:
  - app/(dashboard)/qmhq/new/page.tsx
  - app/(dashboard)/qmhq/new/[route]/page.tsx
  - app/(dashboard)/po/new/page.tsx
autonomous: true

must_haves:
  truths:
    - "QMHQ creation wizard (both pages) uses FormSection and PageHeader composites"
    - "PO creation form uses FormSection, FormField, and PageHeader composites"
    - "Multi-page QMHQ wizard navigation still works (page 1 route selection → page 2 route-specific form)"
    - "PO line items table and balance-in-hand calculations preserved"
  artifacts:
    - path: "app/(dashboard)/qmhq/new/page.tsx"
      provides: "QMHQ create page 1 with composites"
      contains: "FormSection"
    - path: "app/(dashboard)/qmhq/new/[route]/page.tsx"
      provides: "QMHQ create page 2 with composites"
      contains: "FormSection"
    - path: "app/(dashboard)/po/new/page.tsx"
      provides: "PO create form with composites"
      contains: "FormSection"
  key_links:
    - from: "app/(dashboard)/qmhq/new/page.tsx"
      to: "app/(dashboard)/qmhq/new/[route]/page.tsx"
      via: "router.push navigation on route selection"
      pattern: "router.push"
---

<objective>
Migrate 3 medium-complexity form pages (QMHQ new wizard 2 pages, PO new) to FormSection + FormField composites.

Purpose: Extend form migration to multi-page wizards and forms with complex line item tables. QMHQ creation has 2-page flow (route selection then route-specific form). PO creation has line items table with financial calculations.
Output: 3 form pages using composites with preserved wizard navigation and financial logic.
</objective>

<execution_context>
@/home/yaungni/.claude/get-shit-done/workflows/execute-plan.md
@/home/yaungni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-ui-component-standardization/36-01-SUMMARY.md
@components/composite/form-section.tsx
@components/composite/form-field.tsx
@components/composite/page-header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate QMHQ new wizard (2 pages) to FormSection + PageHeader composites</name>
  <files>
    app/(dashboard)/qmhq/new/page.tsx
    app/(dashboard)/qmhq/new/[route]/page.tsx
  </files>
  <action>
**QMHQ new - Page 1: Route Selection** (~901 lines):
1. Read full file carefully. This page has:
   - Header with "Create QMHQ" title and parent QMRL info
   - Basic info form section (line name, category, contact, assigned to, status)
   - Route selection section with 3 cards (Item, Expense, PO)
   - "Next" button to navigate to route-specific page
2. Add import: `import { FormSection, FormField, PageHeader } from "@/components/composite";`
3. Replace inline header with PageHeader:
   ```tsx
   <PageHeader title="Create QMHQ Line" description={`For ${qmrlTitle}`} />
   ```
4. Replace basic info section (command-panel + section-header) with FormSection:
   ```tsx
   <FormSection title="Basic Information" icon={...}>
     <FormField label="Line Name" required>...</FormField>
     <FormField label="Category">...</FormField>
     {/* etc */}
   </FormSection>
   ```
5. Replace route selection section with FormSection:
   ```tsx
   <FormSection title="Select Route Type" icon={...}>
     {/* Route selection cards - PRESERVE card click handlers and styling */}
   </FormSection>
   ```
6. PRESERVE: Route selection card click handlers, inline-create-select for status/category, QMRL data loading, form validation, "Next" button navigation to /qmhq/new/[route].
7. The route selection cards have custom layouts (icon, title, description, selected state) — keep this domain-specific content inside the FormSection.

**QMHQ new - Page 2: Route-Specific Form** (~815 lines):
1. Read full file. This page renders different form sections based on route type (item/expense/po).
2. Add import: `import { FormSection, FormField, PageHeader } from "@/components/composite";`
3. Replace inline header with PageHeader (showing route type).
4. Replace each route-specific form section with FormSection:
   - Item route: "Item Selection" section with item search and quantity
   - Expense route: "Expense Details" with amount, exchange rate, EUSD display
   - PO route: "PO Budget" with budget amount, exchange rate, balance info
5. Replace individual field wrappers with FormField.
6. PRESERVE: All route-specific conditional rendering, item search, warehouse availability display, currency calculations, EUSD auto-calculation, form submission, navigation back to page 1.

After both edits, run `npx tsc --noEmit`.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Run `grep 'FormSection' app/\(dashboard\)/qmhq/new/page.tsx app/\(dashboard\)/qmhq/new/\[route\]/page.tsx` — both files contain FormSection.
Run `grep 'PageHeader' app/\(dashboard\)/qmhq/new/page.tsx app/\(dashboard\)/qmhq/new/\[route\]/page.tsx` — both files contain PageHeader.
  </verify>
  <done>QMHQ creation wizard (both pages) uses FormSection and PageHeader composites. Route selection cards preserved. Navigation between pages works. All form logic unchanged.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate PO new form to FormSection + FormField + PageHeader composites</name>
  <files>
    app/(dashboard)/po/new/page.tsx
  </files>
  <action>
**PO new page** (~625 lines):
1. Read full file. Identify form structure:
   - Header with "Create Purchase Order" title and QMHQ reference
   - "PO Information" section (QMHQ selection, supplier, currency, exchange rate)
   - "Line Items" section with dynamic table (add/edit/remove rows)
   - "Financial Summary" section (totals, balance in hand)
   - Submit/Cancel buttons
2. Add import: `import { FormSection, FormField, PageHeader } from "@/components/composite";`
3. Replace inline header with PageHeader:
   ```tsx
   <PageHeader title="Create Purchase Order" description={`QMHQ: ${qmhqRef}`} />
   ```
4. Replace "PO Information" command-panel section with FormSection:
   ```tsx
   <FormSection title="PO Information" icon={...}>
     <FormField label="QMHQ" required>...</FormField>
     <FormField label="Supplier" required>...</FormField>
     <div className="grid grid-cols-2 gap-4">
       <FormField label="Currency" required>...</FormField>
       <FormField label="Exchange Rate" required>...</FormField>
     </div>
   </FormSection>
   ```
5. Replace "Line Items" section with FormSection. The dynamic line items table should remain INSIDE the FormSection as-is — do NOT try to FormField-ify individual table cells.
   ```tsx
   <FormSection title="Line Items" icon={...}>
     {/* Existing line items table with Add/Remove row buttons — PRESERVE */}
   </FormSection>
   ```
6. Replace "Financial Summary" section with FormSection.
7. PRESERVE: All line item management (add/remove/edit rows), quantity validation, unit price inputs, subtotal calculations, balance-in-hand display, EUSD calculations, submit handler, QMHQ/supplier search.

After edit, run `npx tsc --noEmit` and `npm run build`.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Run `npm run build` — production build succeeds.
Run `grep 'FormSection' app/\(dashboard\)/po/new/page.tsx` — file contains FormSection.
Run `grep 'FormField' app/\(dashboard\)/po/new/page.tsx` — file contains FormField.
Run `grep 'PageHeader' app/\(dashboard\)/po/new/page.tsx` — file contains PageHeader.
  </verify>
  <done>PO creation form uses FormSection, FormField, and PageHeader composites. Line items table and financial calculations preserved. Production build passes.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. All 3 form pages import composites from "@/components/composite"
4. QMHQ wizard page navigation (page 1 → page 2) still works
5. Route selection cards in QMHQ page 1 still functional
6. PO line items table (add/remove/edit) still functional
7. All financial calculations (EUSD, balance-in-hand) preserved
8. Form submissions work on all 3 pages
</verification>

<success_criteria>
- 3 medium-complexity form pages migrated to composites
- Zero TypeScript errors
- Production build passes
- Multi-page wizard navigation preserved
- Line item management and financial logic preserved
</success_criteria>

<output>
After completion, create `.planning/phases/40-ui-consistency-rollout/40-05-SUMMARY.md`
</output>
