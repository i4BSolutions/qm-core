---
phase: 40-ui-consistency-rollout
plan: 03
type: execute
wave: 2
depends_on: []
files_modified:
  - app/(dashboard)/qmrl/[id]/page.tsx
  - app/(dashboard)/po/[id]/page.tsx
  - app/(dashboard)/warehouse/[id]/page.tsx
  - app/(dashboard)/qmhq/[id]/page.tsx
  - app/(dashboard)/invoice/[id]/page.tsx
  - app/(dashboard)/inventory/stock-out-requests/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "All 6 detail pages use DetailPageLayout composite for consistent back-navigation, header, and content structure"
    - "Detail pages with KPI panels pass them via kpiPanel slot"
    - "Tab content and domain-specific sections preserved unchanged"
    - "No visual or functional regression on any detail page"
  artifacts:
    - path: "app/(dashboard)/qmrl/[id]/page.tsx"
      provides: "QMRL detail with DetailPageLayout"
      contains: "DetailPageLayout"
    - path: "app/(dashboard)/po/[id]/page.tsx"
      provides: "PO detail with DetailPageLayout"
      contains: "DetailPageLayout"
    - path: "app/(dashboard)/warehouse/[id]/page.tsx"
      provides: "Warehouse detail with DetailPageLayout"
      contains: "DetailPageLayout"
    - path: "app/(dashboard)/qmhq/[id]/page.tsx"
      provides: "QMHQ detail with DetailPageLayout"
      contains: "DetailPageLayout"
    - path: "app/(dashboard)/invoice/[id]/page.tsx"
      provides: "Invoice detail with DetailPageLayout"
      contains: "DetailPageLayout"
    - path: "app/(dashboard)/inventory/stock-out-requests/[id]/page.tsx"
      provides: "SOR detail with DetailPageLayout"
      contains: "DetailPageLayout"
  key_links:
    - from: "all 6 detail pages"
      to: "components/composite/detail-page-layout.tsx"
      via: "import { DetailPageLayout } from '@/components/composite'"
      pattern: "DetailPageLayout"
---

<objective>
Migrate 6 detail pages to use DetailPageLayout composite, replacing inline back-navigation + header + content structures with standardized layout.

Purpose: Standardize all detail page layouts (back button, header with title/ID, action buttons, optional KPI panel, tab content). This covers the second-largest page category.
Output: 6 detail pages using DetailPageLayout with preserved tab content, KPI panels, and domain-specific sections.
</objective>

<execution_context>
@/home/yaungni/.claude/get-shit-done/workflows/execute-plan.md
@/home/yaungni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-ui-component-standardization/36-03-SUMMARY.md
@components/composite/detail-page-layout.tsx
@app/(dashboard)/item/[id]/page.tsx (reference: already migrated item detail page as template)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate QMRL detail, PO detail, and Warehouse detail to DetailPageLayout</name>
  <files>
    app/(dashboard)/qmrl/[id]/page.tsx
    app/(dashboard)/po/[id]/page.tsx
    app/(dashboard)/warehouse/[id]/page.tsx
  </files>
  <action>
Use the Item detail page (already migrated in Phase 36-03) as the template. The pattern is:

```tsx
<DetailPageLayout
  backHref="/entity-list"
  header={/* title + ID/badge + metadata */}
  actions={/* Edit, Create linked entity buttons */}
  kpiPanel={/* optional KPI cards */}
>
  <Tabs>{/* tab content unchanged */}</Tabs>
</DetailPageLayout>
```

**QMRL detail** (~664 lines):
1. Read full file. Find the inline layout: grid-overlay div, back button (Link to /qmrl), header with title/request_id, action buttons (Edit, Create QMHQ), tabs.
2. Add `import { DetailPageLayout } from "@/components/composite";`
3. Replace the outer wrapper (`<div className="space-y-6 relative">`) with DetailPageLayout:
   - backHref="/qmrl"
   - header: existing title, request_id, status badge, priority badge, category badge content
   - actions: Edit button (link to edit page), Create QMHQ button
   - kpiPanel: If QMRL detail has KPI cards, pass as slot. If not, omit.
4. Children: The Tabs component with all its tab panels (Details, QMHQ Lines, History, Comments).
5. Remove: the grid-overlay div (DetailPageLayout provides it), the ArrowLeft back button (DetailPageLayout provides it), the flex wrapper around header/actions.
6. PRESERVE: All data fetching, tab content, status change logic, QMHQ creation flow, comments section, history tab, loading/error states.

**PO detail** (~651 lines):
1. Read full file. Find inline layout with back to /po, PO number, supplier info, status, action buttons, tabs.
2. Add DetailPageLayout import.
3. Replace outer wrapper with DetailPageLayout:
   - backHref="/po"
   - header: PO number, supplier, status badge, QMHQ reference
   - actions: existing buttons (may include void, close, etc.)
   - kpiPanel: If PO has financial summary cards (total, invoiced, balance), pass as slot.
4. Children: Tabs (Line Items, Invoices, History).
5. PRESERVE: PO status logic, financial calculations, line items display, invoice links.

**Warehouse detail** (~699 lines):
1. Read full file. Find inline layout with back to /warehouse, warehouse name, location, KPI cards, tabs.
2. Add DetailPageLayout import.
3. Replace outer wrapper with DetailPageLayout:
   - backHref="/warehouse"
   - header: warehouse name, location, description
   - actions: Edit button, Stock In/Out links
   - kpiPanel: Total Items, Total Units, Total Value, Total Value EUSD KPI cards
4. Children: Tabs (Inventory, Stock Movement, Details).
5. PRESERVE: WAC display, stock levels, all inventory calculations.

After all 3 edits, run `npx tsc --noEmit`.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Run `grep 'DetailPageLayout' app/\(dashboard\)/qmrl/\[id\]/page.tsx app/\(dashboard\)/po/\[id\]/page.tsx app/\(dashboard\)/warehouse/\[id\]/page.tsx` — all 3 files contain DetailPageLayout.
Verify no duplicate grid-overlay divs in any of the 3 files.
  </verify>
  <done>QMRL, PO, and Warehouse detail pages use DetailPageLayout composite. Back navigation, headers, actions, and KPI panels rendered via composite slots. Tab content and domain logic unchanged.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate QMHQ detail, Invoice detail, and Stock Out Request detail to DetailPageLayout</name>
  <files>
    app/(dashboard)/qmhq/[id]/page.tsx
    app/(dashboard)/invoice/[id]/page.tsx
    app/(dashboard)/inventory/stock-out-requests/[id]/page.tsx
  </files>
  <action>
**QMHQ detail** (~1289 lines — LARGEST page, requires extra care):
1. Read full file carefully. This is the most complex detail page.
2. Identify the outer layout wrapper: grid-overlay, back button (Link to /qmhq), header with line name/QMHQ ID/route type badge, action buttons.
3. Add `import { DetailPageLayout } from "@/components/composite";`
4. Replace ONLY the outermost layout wrapper with DetailPageLayout. Do NOT touch any of the inner content.
   - backHref="/qmhq"
   - header: line name, QMHQ ID, route type badge, status badge
   - actions: Edit button, any other action buttons
   - kpiPanel: Financial summary if present (amount, EUSD)
5. Children: The entire Tabs component with all tab panels.
6. CRITICAL: This file is 1289 lines. Only modify the outermost JSX wrapper (typically first 20-30 lines of the return statement). Do NOT modify anything inside the tabs.
7. PRESERVE: ALL route-type-specific content (item/expense/po sections), financial displays, transaction lists, stock-out integration, comments, history.

**Invoice detail** (~840 lines):
1. Read full file. Find inline layout with back to /invoice, invoice number, status, financial amounts.
2. Add DetailPageLayout import.
3. Replace outer wrapper:
   - backHref="/invoice"
   - header: invoice number, PO reference, status badge
   - actions: void button (if present), other actions
   - kpiPanel: Financial summary (total, currency, EUSD)
4. Children: Tabs (Line Items, Stock Receipts, History).
5. PRESERVE: Void functionality, financial calculations, line items display.

**Stock Out Request detail** (~1047 lines):
1. Read full file. Find inline layout with back to /inventory/stock-out-requests, SOR ID, status, items.
2. Add DetailPageLayout import.
3. Replace outer wrapper:
   - backHref="/inventory/stock-out-requests"
   - header: SOR ID, status badge, requester info
   - actions: Approve/Reject buttons (admin-only), Execute button
   - kpiPanel: If present (item count, fulfillment progress)
4. Children: Tabs or main content section.
5. PRESERVE: ALL approval logic, execution workflow, line items, permission guards.

After all 3 edits, run `npx tsc --noEmit` and `npm run build`.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Run `npm run build` — production build succeeds.
Run `grep 'DetailPageLayout' app/\(dashboard\)/qmhq/\[id\]/page.tsx app/\(dashboard\)/invoice/\[id\]/page.tsx app/\(dashboard\)/inventory/stock-out-requests/\[id\]/page.tsx` — all 3 files contain DetailPageLayout.
  </verify>
  <done>QMHQ, Invoice, and Stock Out Request detail pages use DetailPageLayout composite. All domain-specific content (route types, financials, approvals) preserved unchanged. Production build passes.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. All 6 detail pages import DetailPageLayout from "@/components/composite"
4. No duplicate grid-overlay divs (DetailPageLayout provides it)
5. No duplicate back-button JSX (DetailPageLayout provides it)
6. All tabs, domain content, financial displays, permissions unchanged
7. KPI panels correctly passed via slot where applicable
</verification>

<success_criteria>
- 6 detail pages migrated to DetailPageLayout composite
- Zero TypeScript errors
- Production build passes
- All tab content, KPI panels, and domain logic preserved
- Combined with Item detail (already migrated): 7/7 detail pages using DetailPageLayout
</success_criteria>

<output>
After completion, create `.planning/phases/40-ui-consistency-rollout/40-03-SUMMARY.md`
</output>
