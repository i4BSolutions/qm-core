---
phase: 40-ui-consistency-rollout
plan: 04
type: execute
wave: 3
depends_on: []
files_modified:
  - app/(dashboard)/qmrl/new/page.tsx
  - app/(dashboard)/qmrl/[id]/edit/page.tsx
  - app/(dashboard)/qmhq/[id]/edit/page.tsx
autonomous: true

must_haves:
  truths:
    - "QMRL new form uses FormSection and FormField composites for consistent form layout"
    - "QMRL edit form uses FormSection and FormField composites matching the new form"
    - "QMHQ edit form uses FormSection and FormField composites for consistent form layout"
    - "All form validation logic and submit handlers are preserved unchanged"
  artifacts:
    - path: "app/(dashboard)/qmrl/new/page.tsx"
      provides: "QMRL create form with composites"
      contains: "FormSection"
    - path: "app/(dashboard)/qmrl/[id]/edit/page.tsx"
      provides: "QMRL edit form with composites"
      contains: "FormSection"
    - path: "app/(dashboard)/qmhq/[id]/edit/page.tsx"
      provides: "QMHQ edit form with composites"
      contains: "FormSection"
  key_links:
    - from: "all 3 form pages"
      to: "components/composite/index.ts"
      via: "import { FormSection, FormField, PageHeader } from '@/components/composite'"
      pattern: "FormSection"
---

<objective>
Migrate 3 simpler form pages (QMRL new, QMRL edit, QMHQ edit) to use FormSection and FormField composites for consistent form layout.

Purpose: Establish form migration patterns on simpler forms before tackling complex multi-step wizards. These forms have section-header patterns that map directly to FormSection.
Output: 3 form pages using FormSection/FormField composites with all validation and submit logic preserved.
</objective>

<execution_context>
@/home/yaungni/.claude/get-shit-done/workflows/execute-plan.md
@/home/yaungni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-ui-component-standardization/36-01-SUMMARY.md
@components/composite/form-section.tsx
@components/composite/form-field.tsx
@components/composite/page-header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate QMRL new and QMRL edit forms to FormSection + FormField composites</name>
  <files>
    app/(dashboard)/qmrl/new/page.tsx
    app/(dashboard)/qmrl/[id]/edit/page.tsx
  </files>
  <action>
**QMRL new page** (~572 lines):
1. Read full file. Identify form sections (typically command-panel divs with section-header containing icon + h3 title):
   - "Basic Information" section (title, description, priority)
   - "Department & Contact" section (department, contact person)
   - "Assignment & Status" section (assigned to, status, category)
   - "Description" section (notes, additional info)
2. Add import: `import { FormSection, FormField, PageHeader } from "@/components/composite";`
3. Replace the page header (h1 "Create New Request") with PageHeader:
   ```tsx
   <PageHeader title="Create New Request" description="..." />
   ```
4. Replace each `<div className="command-panel corner-accents p-6 space-y-4">` section with FormSection:
   ```tsx
   <FormSection title="Basic Information" icon={<FileText className="h-5 w-5 text-amber-400" />}>
     {/* form fields */}
   </FormSection>
   ```
5. Replace individual field wrappers (`<div className="space-y-2"><Label>...</Label><Input ... /></div>`) with FormField:
   ```tsx
   <FormField label="Title" required error={errors?.title}>
     <Input value={formData.title} onChange={...} />
   </FormField>
   ```
6. PRESERVE: All onChange handlers, validation logic, formData state, inline-create-select components, submit handler, navigation after submit, loading states.
7. PRESERVE: Any custom field layouts (e.g., grid layouts for side-by-side fields). Wrap grid containers inside FormSection, not FormField.
8. Keep spacing="default" for all FormSection instances (consistent with the form's existing p-6 space-y-4 pattern).

**QMRL edit page** (~533 lines):
1. Read full file. This is structurally similar to QMRL new but with pre-populated data.
2. Apply the exact same pattern as QMRL new: PageHeader, FormSection, FormField.
3. The edit page likely has "Save Changes" instead of "Create" button and loads existing data.
4. PRESERVE: Data loading (useEffect to fetch existing QMRL), all form state, validation, submit handler, navigation.

After both edits, run `npx tsc --noEmit`.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Run `grep 'FormSection' app/\(dashboard\)/qmrl/new/page.tsx app/\(dashboard\)/qmrl/\[id\]/edit/page.tsx` — both files contain FormSection.
Run `grep 'FormField' app/\(dashboard\)/qmrl/new/page.tsx app/\(dashboard\)/qmrl/\[id\]/edit/page.tsx` — both files contain FormField.
Verify no remaining inline `section-header` divs in either file.
  </verify>
  <done>QMRL new and edit forms use FormSection and FormField composites. All form sections consistently styled. Validation, state management, and submit logic unchanged.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate QMHQ edit form to FormSection + FormField composites</name>
  <files>
    app/(dashboard)/qmhq/[id]/edit/page.tsx
  </files>
  <action>
**QMHQ edit page** (~412 lines):
1. Read full file. Identify form sections (command-panel + section-header pattern):
   - "Basic Information" section (line name, category, contact)
   - "Assignment & Status" section (assigned to, status)
   - Route-specific section (Item details, Expense amounts, PO budget)
2. Add import: `import { FormSection, FormField, PageHeader } from "@/components/composite";`
3. Replace the page header with PageHeader.
4. Replace each command-panel section with FormSection (matching icons and titles).
5. Replace individual field wrappers with FormField.
6. For route-specific fields: Keep them inside a FormSection with appropriate title (e.g., "Item Details", "Expense Details", "PO Details"). The conditional rendering of route-specific sections should be PRESERVED inside the form, not inside FormSection.
   ```tsx
   {routeType === 'expense' && (
     <FormSection title="Expense Details" icon={...}>
       <FormField label="Amount" required>
         <Input ... />
       </FormField>
       <FormField label="Exchange Rate" required>
         <Input ... />
       </FormField>
     </FormSection>
   )}
   ```
7. PRESERVE: Route type logic, conditional field rendering, currency calculations, EUSD display, all validation, submit handler.

After edit, run `npx tsc --noEmit` and `npm run build`.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Run `npm run build` — production build succeeds.
Run `grep 'FormSection' app/\(dashboard\)/qmhq/\[id\]/edit/page.tsx` — file contains FormSection.
Run `grep 'FormField' app/\(dashboard\)/qmhq/\[id\]/edit/page.tsx` — file contains FormField.
  </verify>
  <done>QMHQ edit form uses FormSection and FormField composites. Route-specific sections conditionally rendered inside composites. All validation and domain logic preserved. Production build passes.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. All 3 form pages import FormSection and FormField from "@/components/composite"
4. No remaining inline section-header divs in migrated files
5. All form validation, state management, submit handlers preserved
6. Inline-create-select components still functional
7. Route-specific conditional rendering still works in QMHQ edit
</verification>

<success_criteria>
- 3 form pages migrated to FormSection + FormField composites
- Zero TypeScript errors
- Production build passes
- All validation and form logic preserved
- Consistent spacing across all form sections (spacing="default")
</success_criteria>

<output>
After completion, create `.planning/phases/40-ui-consistency-rollout/40-04-SUMMARY.md`
</output>
