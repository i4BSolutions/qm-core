---
phase: 40-ui-consistency-rollout
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(dashboard)/qmhq/page.tsx
  - app/(dashboard)/invoice/page.tsx
  - app/(dashboard)/inventory/page.tsx
  - app/(dashboard)/inventory/stock-out-requests/page.tsx
autonomous: true

must_haves:
  truths:
    - "QMHQ list page displays consistent PageHeader, FilterBar, and CardViewGrid composites"
    - "Invoice list page displays consistent PageHeader, FilterBar, and CardViewGrid composites"
    - "Inventory dashboard displays consistent PageHeader and FilterBar composites"
    - "Stock Out Requests list page displays consistent PageHeader composite"
    - "Card view layouts use CardViewGrid with render props pattern for domain-specific card content"
  artifacts:
    - path: "app/(dashboard)/qmhq/page.tsx"
      provides: "QMHQ list with composites"
      contains: "CardViewGrid"
    - path: "app/(dashboard)/invoice/page.tsx"
      provides: "Invoice list with composites"
      contains: "PageHeader"
    - path: "app/(dashboard)/inventory/page.tsx"
      provides: "Inventory dashboard with composites"
      contains: "PageHeader"
    - path: "app/(dashboard)/inventory/stock-out-requests/page.tsx"
      provides: "SOR list with PageHeader"
      contains: "PageHeader"
  key_links:
    - from: "app/(dashboard)/qmhq/page.tsx"
      to: "components/composite/index.ts"
      via: "import { PageHeader, FilterBar, CardViewGrid }"
      pattern: "CardViewGrid"
    - from: "app/(dashboard)/invoice/page.tsx"
      to: "components/composite/index.ts"
      via: "import { PageHeader, FilterBar, CardViewGrid }"
      pattern: "PageHeader.*FilterBar"
---

<objective>
Migrate 4 list pages with card views and complex filters to composite components (PageHeader, FilterBar, CardViewGrid).

Purpose: Standardize card-based list pages that have status-grouped kanban layouts and filter bars. These are medium-complexity pages where CardViewGrid provides the most structural benefit.
Output: 4 pages using composite components with preserved domain-specific card content.
</objective>

<execution_context>
@/home/yaungni/.claude/get-shit-done/workflows/execute-plan.md
@/home/yaungni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-ui-component-standardization/36-03-SUMMARY.md
@components/composite/page-header.tsx
@components/composite/filter-bar.tsx
@components/composite/card-view-grid.tsx
@app/(dashboard)/qmrl/page.tsx (reference: already migrated QMRL list page as template)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate QMHQ list and Invoice list to PageHeader + FilterBar + CardViewGrid</name>
  <files>
    app/(dashboard)/qmhq/page.tsx
    app/(dashboard)/invoice/page.tsx
  </files>
  <action>
Use the QMRL list page (already migrated in Phase 36-03) as the template for migration pattern.

**QMHQ list page** (~606 lines):
1. Read full file. Identify: inline header, inline search/filters, inline kanban grid with 3 status group columns.
2. Add import: `import { PageHeader, FilterBar, CardViewGrid } from "@/components/composite";`
3. Replace inline header div (h1 "QMHQ Lines", description, action buttons) with:
   ```tsx
   <PageHeader title="QMHQ Lines" description={dynamic count} actions={existing buttons} />
   ```
4. Replace inline search/filter section with:
   ```tsx
   <FilterBar>
     <FilterBar.Search value={searchQuery} onChange={setSearchQuery} placeholder="Search..." />
     <FilterBar.Select value={routeFilter} onChange={setRouteFilter} options={routeOptions} placeholder="Route Type" />
     <FilterBar.Select value={statusFilter} onChange={setStatusFilter} options={statusOptions} placeholder="Status" />
   </FilterBar>
   ```
5. Replace inline kanban grid (3-column grid with status groups) with:
   ```tsx
   <CardViewGrid
     items={filteredItems}
     groups={statusGroupConfig}
     groupBy={(qmhq) => qmhq.status?.status_group || 'to_do'}
     renderCard={(qmhq, index) => (
       /* PRESERVE existing QMHQCard or inline card content exactly */
     )}
     emptyMessage="No QMHQ lines"
   />
   ```
6. PRESERVE: All data fetching, filtering logic, route type badges, tactical-card styling inside renderCard, card click navigation, view mode toggle (if present).
7. Remove now-unused icon imports (Search if used only in filter bar).

**Invoice list page** (~540 lines):
1. Read full file. Identify: inline header, search/filter bar, card/list view with status groups.
2. Add import: `import { PageHeader, FilterBar, CardViewGrid } from "@/components/composite";`
3. Replace inline header with PageHeader. Invoice page has view toggle (card/list) — put toggle buttons in actions slot alongside "New Invoice" button.
4. Replace inline search/filter section with FilterBar compound component.
5. For the card view section: If the page uses status-grouped card layout, replace with CardViewGrid. If it has a separate list view mode, conditionally render `<CardViewGrid>` for card view and existing `<DataTable>` or list for list view.
6. PRESERVE: InvoiceCard component rendering, InvoiceStatusBadge, CurrencyDisplay, void indicators, all domain-specific card content inside renderCard.

After both edits, run `npx tsc --noEmit`.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Run `grep 'CardViewGrid' app/\(dashboard\)/qmhq/page.tsx app/\(dashboard\)/invoice/page.tsx` — both files contain CardViewGrid.
Run `grep 'PageHeader' app/\(dashboard\)/qmhq/page.tsx app/\(dashboard\)/invoice/page.tsx` — both files contain PageHeader.
Run `grep 'FilterBar' app/\(dashboard\)/qmhq/page.tsx app/\(dashboard\)/invoice/page.tsx` — both files contain FilterBar.
  </verify>
  <done>QMHQ and Invoice list pages use PageHeader, FilterBar, and CardViewGrid composites. Domain-specific card content preserved inside renderCard. View toggle functionality preserved.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate Inventory dashboard and Stock Out Requests list to composites</name>
  <files>
    app/(dashboard)/inventory/page.tsx
    app/(dashboard)/inventory/stock-out-requests/page.tsx
  </files>
  <action>
**Inventory dashboard** (~579 lines):
1. Read full file. This page is an inventory dashboard with KPI cards and possibly tabbed content.
2. Add import: `import { PageHeader } from "@/components/composite";` (and FilterBar if it has filters).
3. Replace inline header with PageHeader. The inventory page likely has action buttons for Stock In/Stock Out navigation.
4. If the page has a search/filter bar, replace with FilterBar.
5. If the page has a card view with status groups, use CardViewGrid. If it's primarily a dashboard with KPI cards, keep the custom KPI layout (don't force composites on dashboard-style layouts per research anti-pattern guidance).
6. PRESERVE: All KPI calculations, stock levels, warehouse summaries, navigation links.

**Stock Out Requests list** (~411 lines):
1. Read full file. This is a list/table page showing stock-out requests.
2. Add import: `import { PageHeader } from "@/components/composite";` (and FilterBar if applicable).
3. Replace inline header with PageHeader.
4. If the page has status-grouped cards, replace with CardViewGrid. If it's a table with DataTable, just migrate the header and filters.
5. PRESERVE: Request status badges, approval indicators, all domain-specific display logic.

After both edits, run `npx tsc --noEmit` and `npm run build`.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero errors.
Run `npm run build` — production build succeeds.
Run `grep 'PageHeader' app/\(dashboard\)/inventory/page.tsx app/\(dashboard\)/inventory/stock-out-requests/page.tsx` — both files contain PageHeader.
  </verify>
  <done>Inventory dashboard and Stock Out Requests list use PageHeader (and FilterBar where applicable). Production build passes. Dashboard KPI layout preserved without forcing generic composites.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. All 4 pages import composites from "@/components/composite"
4. QMHQ and Invoice list pages use CardViewGrid for status-grouped card layouts
5. Domain-specific card content (tactical-card, route badges, currency) preserved
6. View toggle (card/list) still functional on pages that have it
7. All search, filter, and pagination functionality preserved
</verification>

<success_criteria>
- 4 card-view list pages migrated to composite components
- Zero TypeScript errors
- Production build passes
- Card view functionality and domain-specific content preserved
</success_criteria>

<output>
After completion, create `.planning/phases/40-ui-consistency-rollout/40-02-SUMMARY.md`
</output>
