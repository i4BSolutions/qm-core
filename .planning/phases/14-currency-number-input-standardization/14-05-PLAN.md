---
phase: 14-currency-number-input-standardization
plan: 05
type: execute
wave: 2
depends_on: ["14-02"]
files_modified:
  - components/po/po-card.tsx
  - components/invoice/invoice-card.tsx
  - components/invoice/invoice-summary-panel.tsx
  - components/po/po-balance-panel.tsx
  - app/(dashboard)/qmhq/page.tsx
  - app/(dashboard)/po/page.tsx
  - app/(dashboard)/invoice/page.tsx
autonomous: true

must_haves:
  truths:
    - "PO card shows original currency + EUSD in two-line stacked format"
    - "Invoice card shows original currency + EUSD in two-line stacked format"
    - "QMHQ list shows original currency + EUSD for expense/PO route items"
    - "Thousand separators appear in all formatted amounts"
    - "EUSD line appears below original currency in smaller, muted text"
  artifacts:
    - path: "components/po/po-card.tsx"
      provides: "PO card with two-line currency display"
      contains: "CurrencyDisplay"
    - path: "components/invoice/invoice-card.tsx"
      provides: "Invoice card with two-line currency display"
      contains: "CurrencyDisplay"
    - path: "app/(dashboard)/qmhq/page.tsx"
      provides: "QMHQ list with two-line currency display"
      contains: "CurrencyDisplay"
  key_links:
    - from: "components/po/po-card.tsx"
      to: "components/ui/currency-display.tsx"
      via: "import CurrencyDisplay"
      pattern: "import.*CurrencyDisplay.*from"
---

<objective>
Update list pages and card components to use CurrencyDisplay for consistent two-line format

Purpose: Apply the CurrencyDisplay component to PO cards, Invoice cards, QMHQ list, and related summary panels to show original currency with EUSD equivalent in a consistent stacked format.

Output: All card-style financial displays show two-line currency format (original on top, EUSD below)
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-currency-number-input-standardization/14-CONTEXT.md
@.planning/phases/14-currency-number-input-standardization/14-02-SUMMARY.md
@components/ui/currency-display.tsx
@components/po/po-card.tsx
@components/invoice/invoice-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update card components with CurrencyDisplay</name>
  <files>components/po/po-card.tsx, components/invoice/invoice-card.tsx</files>
  <action>
**PO Card (`components/po/po-card.tsx`):**

1. **Import CurrencyDisplay**:
```typescript
import { CurrencyDisplay } from "@/components/ui/currency-display";
```

2. **Replace financial info section**:
Current:
```tsx
<span className="font-mono text-sm text-emerald-400">
  {formatCurrency(po.total_amount_eusd ?? 0)} EUSD
</span>
```

Replace with:
```tsx
<CurrencyDisplay
  amount={po.total_amount}
  currency={po.currency || "MMK"}
  amountEusd={po.total_amount_eusd}
  size="sm"
  align="right"
/>
```

Note: PO has `total_amount`, `currency`, and `total_amount_eusd` fields.

**Invoice Card (`components/invoice/invoice-card.tsx`):**

1. **Import CurrencyDisplay**:
```typescript
import { CurrencyDisplay } from "@/components/ui/currency-display";
```

2. **Replace financial info section**:
The current card already shows both currencies but in a different layout. Update to use CurrencyDisplay:
```tsx
<CurrencyDisplay
  amount={invoice.total_amount}
  currency={invoice.currency || "MMK"}
  amountEusd={invoice.total_amount_eusd}
  size="sm"
  align="right"
/>
```

3. **Remove the separate currency line** that shows original currency below EUSD (the current implementation shows EUSD first, then original below - we're reversing that order per CONTEXT).
  </action>
  <verify>grep -c "CurrencyDisplay" components/po/po-card.tsx shows 1+ match; grep -c "CurrencyDisplay" components/invoice/invoice-card.tsx shows 1+ match</verify>
  <done>PO and Invoice cards use CurrencyDisplay for two-line format</done>
</task>

<task type="auto">
  <name>Task 2: Update summary/balance panel components</name>
  <files>components/invoice/invoice-summary-panel.tsx, components/po/po-balance-panel.tsx</files>
  <action>
**Invoice Summary Panel (`components/invoice/invoice-summary-panel.tsx`):**

Review and update if needed. The panel shows:
- Total in original currency
- Exchange rate
- Total in EUSD

This is a vertical breakdown (acceptable for summary panels). Consider if CurrencyDisplay fits or if the current layout is appropriate.

If updating:
1. Import CurrencyDisplay
2. Replace the Total (currency) + Total (EUSD) sections with a single CurrencyDisplay for a cleaner look

**PO Balance Panel (`components/po/po-balance-panel.tsx`):**

1. Read the file to understand its structure
2. Update any amount displays to use two-line format where appropriate
3. Balance panels may need to keep detailed breakdown format

For both: Use judgment on whether CurrencyDisplay improves or complicates the existing layout. Summary panels may benefit from keeping their detailed breakdown.
  </action>
  <verify>Review changes to summary panels, ensure they maintain clarity</verify>
  <done>Summary panels updated or preserved based on layout needs</done>
</task>

<task type="auto">
  <name>Task 3: Update QMHQ, PO, Invoice list pages</name>
  <files>app/(dashboard)/qmhq/page.tsx, app/(dashboard)/po/page.tsx, app/(dashboard)/invoice/page.tsx</files>
  <action>
**QMHQ List Page (`app/(dashboard)/qmhq/page.tsx`):**

1. **Import CurrencyDisplay**:
```typescript
import { CurrencyDisplay } from "@/components/ui/currency-display";
```

2. **Find amount displays** for expense/PO route items in both card and list views
3. **Replace with CurrencyDisplay** using the item's amount, currency, and amount_eusd fields
4. Item route items don't have currency amounts - those should not show CurrencyDisplay

**PO List Page (`app/(dashboard)/po/page.tsx`):**

If the page has inline amount displays (separate from POCard component):
1. Import CurrencyDisplay
2. Update any amount displays to use two-line format

**Invoice List Page (`app/(dashboard)/invoice/page.tsx`):**

If the page has inline amount displays (separate from InvoiceCard component):
1. Import CurrencyDisplay
2. Update any amount displays to use two-line format

Note: Most list pages delegate to card components, so changes may be minimal if cards were updated in Task 1.
  </action>
  <verify>Check list pages for consistent currency display; npm run type-check passes</verify>
  <done>List pages use CurrencyDisplay or delegate to updated card components</done>
</task>

</tasks>

<verification>
- [ ] PO card shows original currency on top, EUSD below
- [ ] Invoice card shows original currency on top, EUSD below
- [ ] QMHQ list items show two-line currency format for financial routes
- [ ] Summary panels maintain clarity (updated or preserved as appropriate)
- [ ] npm run type-check passes
- [ ] All formatted amounts have thousand separators
</verification>

<success_criteria>
Card views and list pages consistently display financial amounts in two-line stacked format with original currency above EUSD equivalent.
</success_criteria>

<output>
After completion, create `.planning/phases/14-currency-number-input-standardization/14-05-SUMMARY.md`
</output>
