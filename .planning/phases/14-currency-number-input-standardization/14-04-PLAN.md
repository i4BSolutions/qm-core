---
phase: 14-currency-number-input-standardization
plan: 04
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - app/(dashboard)/po/new/page.tsx
  - app/(dashboard)/invoice/new/page.tsx
  - components/po/po-line-items-table.tsx
  - components/invoice/invoice-line-items-table.tsx
autonomous: true

must_haves:
  truths:
    - "PO form exchange rate input blocks extra decimals beyond 4"
    - "Invoice form exchange rate input blocks extra decimals beyond 4"
    - "PO line item quantity inputs block decimal points (integers only)"
    - "Invoice line item quantity inputs block decimal points (integers only)"
    - "Line item unit price inputs block extra decimals beyond 2"
  artifacts:
    - path: "app/(dashboard)/po/new/page.tsx"
      provides: "PO create form with standardized exchange rate input"
      contains: "handleExchangeRateKeyDown"
    - path: "app/(dashboard)/invoice/new/page.tsx"
      provides: "Invoice create form with standardized exchange rate input"
      contains: "handleExchangeRateKeyDown"
    - path: "components/po/po-line-items-table.tsx"
      provides: "PO line items table with standardized quantity and price inputs"
      contains: "handleQuantityKeyDown|handleAmountKeyDown"
    - path: "components/invoice/invoice-line-items-table.tsx"
      provides: "Invoice line items table with standardized quantity and price inputs"
      contains: "handleQuantityKeyDown|handleAmountKeyDown"
  key_links:
    - from: "components/po/po-line-items-table.tsx"
      to: "lib/utils/number-input.ts"
      via: "import keydown handlers"
      pattern: "import.*handleQuantityKeyDown.*from"
---

<objective>
Apply standardized number input behavior to PO and Invoice forms

Purpose: Ensure PO create, Invoice create, and their line item table components have consistent number input behavior using centralized keydown handlers.

Output: Updated PO and Invoice forms with consistent numeric input behavior across exchange rates, quantities, and prices
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-currency-number-input-standardization/14-CONTEXT.md
@.planning/phases/14-currency-number-input-standardization/14-01-SUMMARY.md
@lib/utils/number-input.ts
@components/po/po-line-items-table.tsx
@components/invoice/invoice-line-items-table.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update PO create form and line items table</name>
  <files>app/(dashboard)/po/new/page.tsx, components/po/po-line-items-table.tsx</files>
  <action>
**PO Create Page (`app/(dashboard)/po/new/page.tsx`):**

1. **Import handler**:
```typescript
import { handleExchangeRateKeyDown } from "@/lib/utils";
```

2. **Update Exchange Rate input**:
   - Replace inline `onKeyDown` with `handleExchangeRateKeyDown`
   - Keep value as string state (`exchangeRate`)

**PO Line Items Table (`components/po/po-line-items-table.tsx`):**

1. **Import handlers**:
```typescript
import { handleQuantityKeyDown, handleAmountKeyDown } from "@/lib/utils";
```

2. **Update EditableLineItemsTable component**:
   - Find quantity input in line item row
   - Apply `handleQuantityKeyDown` to quantity inputs
   - Apply `handleAmountKeyDown` to unit_price inputs

3. **Ensure empty handling**:
   - Quantity/price inputs should allow empty and show blank
   - No auto-fill with "0" on blur
  </action>
  <verify>grep -c "handleExchangeRateKeyDown" app/(dashboard)/po/new/page.tsx shows 1+ match; grep -c "handleQuantityKeyDown\|handleAmountKeyDown" components/po/po-line-items-table.tsx shows 2+ matches</verify>
  <done>PO form and line items table use centralized number input handlers</done>
</task>

<task type="auto">
  <name>Task 2: Update Invoice create form and line items table</name>
  <files>app/(dashboard)/invoice/new/page.tsx, components/invoice/invoice-line-items-table.tsx</files>
  <action>
**Invoice Create Page (`app/(dashboard)/invoice/new/page.tsx`):**

1. **Import handler**:
```typescript
import { handleExchangeRateKeyDown } from "@/lib/utils";
```

2. **Update Exchange Rate input** (in Step 1):
   - Replace inline `onKeyDown` with `handleExchangeRateKeyDown`
   - Keep value as string state (`exchangeRate`)

3. **Update inline line item inputs** (in Step 2 - the page has inline quantity/price inputs):
   - Import `handleQuantityKeyDown, handleAmountKeyDown`
   - Apply to the quantity and unit_price inputs in the line items loop

**Invoice Line Items Table (if exists as separate component):**

1. First check if `components/invoice/invoice-line-items-table.tsx` has editable inputs
2. If it does, apply same handlers as PO table
3. If it's read-only, skip this component

Note: Invoice create has inline inputs in the page itself (Step 2), so the page update is the priority.
  </action>
  <verify>grep -c "handleExchangeRateKeyDown\|handleQuantityKeyDown\|handleAmountKeyDown" app/(dashboard)/invoice/new/page.tsx shows 3+ matches</verify>
  <done>Invoice form and line items use centralized number input handlers</done>
</task>

<task type="auto">
  <name>Task 3: Update transaction dialog component</name>
  <files>components/qmhq/transaction-dialog.tsx</files>
  <action>
Check if transaction-dialog.tsx has number inputs and update if needed:

1. **Read the file** to understand its structure
2. **If it has amount/quantity inputs**:
   - Import appropriate handlers from "@/lib/utils"
   - Apply handlers to the inputs
3. **If it's read-only or uses different patterns**, note that in summary

This dialog is used for QMHQ expense/PO route transactions.
  </action>
  <verify>Check components/qmhq/transaction-dialog.tsx for number input usage</verify>
  <done>Transaction dialog uses standardized handlers (if applicable)</done>
</task>

</tasks>

<verification>
- [ ] PO create page uses handleExchangeRateKeyDown
- [ ] PO line items table uses handleQuantityKeyDown and handleAmountKeyDown
- [ ] Invoice create page uses handleExchangeRateKeyDown
- [ ] Invoice inline line items use handleQuantityKeyDown and handleAmountKeyDown
- [ ] Transaction dialog updated if has number inputs
- [ ] npm run type-check passes
- [ ] npm run lint passes (or acceptable warnings only)
</verification>

<success_criteria>
PO and Invoice creation forms, including their line item inputs, have consistent number input behavior that blocks invalid characters while typing.
</success_criteria>

<output>
After completion, create `.planning/phases/14-currency-number-input-standardization/14-04-SUMMARY.md`
</output>
