---
phase: 14-currency-number-input-standardization
plan: 07
type: execute
wave: 3
depends_on: ["14-02"]
files_modified:
  - app/(dashboard)/warehouse/[id]/page.tsx
  - app/(dashboard)/item/[id]/page.tsx
  - app/(dashboard)/qmrl/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Warehouse detail page shows WAC values in two-line format"
    - "Item detail page shows WAC values in two-line format"
    - "QMRL detail page shows linked QMHQ amounts in two-line format (if applicable)"
    - "Currency formatting is consistent across all entity detail views"
  artifacts:
    - path: "app/(dashboard)/warehouse/[id]/page.tsx"
      provides: "Warehouse detail with two-line currency display"
      contains: "CurrencyDisplay"
    - path: "app/(dashboard)/item/[id]/page.tsx"
      provides: "Item detail with two-line currency display"
      contains: "CurrencyDisplay"
  key_links:
    - from: "app/(dashboard)/warehouse/[id]/page.tsx"
      to: "components/ui/currency-display.tsx"
      via: "import CurrencyDisplay"
      pattern: "import.*CurrencyDisplay.*from"
---

<objective>
Complete currency display standardization for remaining detail pages

Purpose: Update warehouse, item, and QMRL detail pages to use CurrencyDisplay for any financial amounts, completing the phase-wide standardization.

Output: All remaining detail pages use consistent two-line currency format where financial amounts are displayed
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-currency-number-input-standardization/14-CONTEXT.md
@.planning/phases/14-currency-number-input-standardization/14-02-SUMMARY.md
@components/ui/currency-display.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Warehouse detail page</name>
  <files>app/(dashboard)/warehouse/[id]/page.tsx</files>
  <action>
**Warehouse Detail Page (`app/(dashboard)/warehouse/[id]/page.tsx`):**

1. **Import CurrencyDisplay**:
```typescript
import { CurrencyDisplay } from "@/components/ui/currency-display";
```

2. **Update inventory value displays**:
   - Per-item WAC displays in the inventory table
   - Total warehouse value in KPI cards
   - Stock movement transaction values

3. **For WAC values**:
   - WAC has `wac_amount`, `wac_currency`, `wac_amount_eusd` (or calculated)
   - Use CurrencyDisplay with appropriate size

4. **Table cells with limited space**:
   - Consider using CurrencyInline for table cells
   - EUSD can be shown in tooltip if space is constrained
   - Or use CurrencyDisplay with size="sm" if column can accommodate

5. **KPI section** (Total Value card):
   - Update to show two-line format with original currency + EUSD
  </action>
  <verify>grep -c "CurrencyDisplay\|CurrencyInline" app/(dashboard)/warehouse/[id]/page.tsx shows 1+ match</verify>
  <done>Warehouse detail page uses CurrencyDisplay for financial displays</done>
</task>

<task type="auto">
  <name>Task 2: Update Item detail page</name>
  <files>app/(dashboard)/item/[id]/page.tsx</files>
  <action>
**Item Detail Page (`app/(dashboard)/item/[id]/page.tsx`):**

1. **Import CurrencyDisplay**:
```typescript
import { CurrencyDisplay } from "@/components/ui/currency-display";
```

2. **Update WAC display section**:
   - Item has `wac_amount`, `wac_currency`, `wac_exchange_rate`, `wac_amount_eusd`
   - Use CurrencyDisplay for the primary WAC display

3. **Stock by warehouse table**:
   - If showing value per warehouse, use CurrencyDisplay or CurrencyInline
   - May need size="sm" for table cells

4. **Transaction history values**:
   - If transaction values are shown, update to two-line format
  </action>
  <verify>grep -c "CurrencyDisplay" app/(dashboard)/item/[id]/page.tsx shows 1+ match</verify>
  <done>Item detail page uses CurrencyDisplay for WAC and financial displays</done>
</task>

<task type="auto">
  <name>Task 3: Update QMRL detail page and verify completeness</name>
  <files>app/(dashboard)/qmrl/[id]/page.tsx</files>
  <action>
**QMRL Detail Page (`app/(dashboard)/qmrl/[id]/page.tsx`):**

1. **Read the file** to understand if it displays any financial amounts
2. QMRL itself doesn't have financial amounts, but it may show:
   - Linked QMHQ summary with amounts
   - If it shows QMHQ amounts, update to CurrencyDisplay

3. **If no financial displays exist**, note this in the summary

**Final Verification Pass:**

1. **Run type-check**:
```bash
npm run type-check
```

2. **Run lint**:
```bash
npm run lint
```

3. **Verify consistency** by grepping for any remaining `formatCurrency` usage that should use CurrencyDisplay:
```bash
grep -r "formatCurrency" app/(dashboard) --include="*.tsx" | grep -v "node_modules"
```

Note: Some `formatCurrency` usage is appropriate (form summaries, non-display contexts). The goal is consistency in user-facing displays.
  </action>
  <verify>npm run type-check passes; npm run lint passes; QMRL page reviewed for financial displays</verify>
  <done>QMRL detail page updated if needed; all pages verified for consistency</done>
</task>

</tasks>

<verification>
- [ ] Warehouse detail shows WAC in two-line format
- [ ] Item detail shows WAC in two-line format
- [ ] QMRL detail reviewed and updated if applicable
- [ ] npm run type-check passes
- [ ] npm run lint passes
- [ ] Manual review confirms consistent currency display across all entity views
</verification>

<success_criteria>
All detail pages across the application use consistent two-line currency format for financial displays, completing Phase 14 currency standardization.
</success_criteria>

<output>
After completion, create `.planning/phases/14-currency-number-input-standardization/14-07-SUMMARY.md`
</output>
