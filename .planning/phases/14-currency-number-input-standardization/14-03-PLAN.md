---
phase: 14-currency-number-input-standardization
plan: 03
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - app/(dashboard)/inventory/stock-in/page.tsx
  - app/(dashboard)/inventory/stock-out/page.tsx
  - app/(dashboard)/qmhq/new/[route]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Typing a number and clicking away preserves the exact typed value"
    - "Empty number inputs show blank (not '0' or '0.00')"
    - "Amount fields block extra decimals beyond 2 while typing"
    - "Exchange rate fields block extra decimals beyond 4 while typing"
    - "Quantity fields block decimal point entirely"
  artifacts:
    - path: "app/(dashboard)/inventory/stock-in/page.tsx"
      provides: "Stock-in form with standardized number inputs"
      contains: "handleAmountKeyDown|handleQuantityKeyDown|handleExchangeRateKeyDown"
    - path: "app/(dashboard)/inventory/stock-out/page.tsx"
      provides: "Stock-out form with standardized number inputs"
      contains: "handleQuantityKeyDown"
    - path: "app/(dashboard)/qmhq/new/[route]/page.tsx"
      provides: "QMHQ route form with standardized number inputs"
      contains: "handleAmountKeyDown|handleQuantityKeyDown|handleExchangeRateKeyDown"
  key_links:
    - from: "app/(dashboard)/inventory/stock-in/page.tsx"
      to: "lib/utils/number-input.ts"
      via: "import keydown handlers"
      pattern: "import.*handleAmountKeyDown.*from"
---

<objective>
Apply standardized number input behavior to inventory and QMHQ forms

Purpose: Ensure stock-in, stock-out, and QMHQ route forms preserve user-typed values without auto-formatting on blur, using the keydown handlers from Plan 01.

Output: Updated form pages with consistent number input behavior across all numeric fields
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-currency-number-input-standardization/14-CONTEXT.md
@.planning/phases/14-currency-number-input-standardization/14-01-SUMMARY.md
@lib/utils/number-input.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Stock-In form number inputs</name>
  <files>app/(dashboard)/inventory/stock-in/page.tsx</files>
  <action>
Update the stock-in page to use centralized keydown handlers:

1. **Import handlers** at top of file:
```typescript
import {
  handleQuantityKeyDown,
  handleAmountKeyDown,
  handleExchangeRateKeyDown
} from "@/lib/utils";
```

2. **Update Quantity inputs** (manual mode and invoice line items):
   - Change `onKeyDown` to use `handleQuantityKeyDown`
   - Keep `type="text"` with `inputMode="numeric"` (better for mobile, prevents browser number quirks)
   - Remove the inline `onKeyDown` that only blocked `-`, `e`, `E`

3. **Update Unit Cost input** (manual mode):
   - Change `onKeyDown` to use `handleAmountKeyDown`
   - Keep value as string state (already is `manualUnitCost`)

4. **Update Exchange Rate input** (manual mode):
   - Change `onKeyDown` to use `handleExchangeRateKeyDown`
   - Keep value as string state (already is `exchangeRate`)

5. **For invoice line items** (quantity and unit_cost inputs in the mapping):
   - Apply same keydown handlers
   - These use number state, so the handleUpdate functions need to keep string handling

Key changes:
- Replace inline `onKeyDown={(e) => { if (e.key === "-" || e.key === "e" || e.key === "E") { e.preventDefault(); } }}` with the appropriate centralized handler
- Input type can stay as `type="number"` but keydown handlers provide additional validation
  </action>
  <verify>grep -c "handleQuantityKeyDown\|handleAmountKeyDown\|handleExchangeRateKeyDown" app/(dashboard)/inventory/stock-in/page.tsx shows 3+ matches</verify>
  <done>Stock-in form uses centralized number input handlers</done>
</task>

<task type="auto">
  <name>Task 2: Update Stock-Out form number inputs</name>
  <files>app/(dashboard)/inventory/stock-out/page.tsx</files>
  <action>
First read the current stock-out page to understand its structure, then update:

1. **Import handlers** at top of file:
```typescript
import { handleQuantityKeyDown } from "@/lib/utils";
```

2. **Update Quantity input**:
   - Replace any inline `onKeyDown` with `handleQuantityKeyDown`
   - Stock-out only has quantity (integer), no amounts or exchange rates

3. **Ensure empty placeholder behavior**:
   - Quantity should show empty when value is empty string
   - No "0" default display
  </action>
  <verify>grep -c "handleQuantityKeyDown" app/(dashboard)/inventory/stock-out/page.tsx shows 1+ matches</verify>
  <done>Stock-out form uses centralized quantity input handler</done>
</task>

<task type="auto">
  <name>Task 3: Update QMHQ route form number inputs</name>
  <files>app/(dashboard)/qmhq/new/[route]/page.tsx</files>
  <action>
Update the QMHQ route details page (expense/po routes have amount+exchange rate, item route has quantity):

1. **Import handlers** at top of file:
```typescript
import {
  handleQuantityKeyDown,
  handleAmountKeyDown,
  handleExchangeRateKeyDown
} from "@/lib/utils";
```

2. **Item route - Quantity inputs** (selectedItems mapping):
   - Apply `handleQuantityKeyDown` to quantity input
   - Quantity is already string state (`quantity: string`)

3. **Expense/PO route - Amount input**:
   - Apply `handleAmountKeyDown` to amount input
   - Amount is already string state (`amount`)

4. **Expense/PO route - Exchange Rate input**:
   - Apply `handleExchangeRateKeyDown` to exchange rate input
   - Exchange rate is already string state (`exchangeRate`)

5. **Ensure empty placeholder behavior**:
   - Remove any `placeholder="0"` or `placeholder="0.00"`
   - Use empty placeholder or descriptive text like "Enter amount"
  </action>
  <verify>grep -c "handleQuantityKeyDown\|handleAmountKeyDown\|handleExchangeRateKeyDown" app/(dashboard)/qmhq/new/[route]/page.tsx shows 3+ matches</verify>
  <done>QMHQ route form uses centralized number input handlers</done>
</task>

</tasks>

<verification>
- [ ] Stock-in page imports and uses handleQuantityKeyDown, handleAmountKeyDown, handleExchangeRateKeyDown
- [ ] Stock-out page imports and uses handleQuantityKeyDown
- [ ] QMHQ route page imports and uses all three handlers as appropriate
- [ ] Typing values and clicking away preserves exact typed value
- [ ] Empty inputs show blank (no "0" or "0.00")
- [ ] npm run type-check passes
</verification>

<success_criteria>
Inventory (stock-in, stock-out) and QMHQ route forms have consistent number input behavior that blocks invalid characters while typing and preserves user-typed values.
</success_criteria>

<output>
After completion, create `.planning/phases/14-currency-number-input-standardization/14-03-SUMMARY.md`
</output>
