---
phase: 14-currency-number-input-standardization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/utils/number-input.ts
  - lib/utils/index.ts
autonomous: true

must_haves:
  truths:
    - "Number input utilities block invalid characters during typing"
    - "Amount handler blocks negative, e, E, + and limits to 2 decimals"
    - "Exchange rate handler blocks negative, e, E, + and limits to 4 decimals"
    - "Quantity handler blocks negative, e, E, +, and decimal point entirely"
    - "Validation helpers return boolean for empty, amount, rate, and quantity"
  artifacts:
    - path: "lib/utils/number-input.ts"
      provides: "Number input handlers and validators"
      exports: ["handleAmountKeyDown", "handleExchangeRateKeyDown", "handleQuantityKeyDown", "validateAmount", "validateExchangeRate", "validateQuantity", "parseAmount", "parseExchangeRate", "parseQuantity"]
  key_links:
    - from: "lib/utils/number-input.ts"
      to: "lib/utils/index.ts"
      via: "re-export"
      pattern: "export.*from.*number-input"
---

<objective>
Create reusable number input utilities for controlled inputs with keydown validation

Purpose: Centralize input validation logic to ensure consistent behavior across all forms (amounts format to 2 decimals, exchange rates to 4 decimals, quantities are integers only) without auto-formatting on blur.

Output: New utility file with keydown handlers and validation helpers exported from lib/utils/index.ts
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-currency-number-input-standardization/14-CONTEXT.md
@.planning/phases/14-currency-number-input-standardization/14-RESEARCH.md
@lib/utils/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create number input utility module</name>
  <files>lib/utils/number-input.ts</files>
  <action>
Create new file `lib/utils/number-input.ts` with the following exports:

1. **Keydown Handlers** (all block -, e, E, +):
   - `handleAmountKeyDown(e: React.KeyboardEvent<HTMLInputElement>)`: Block invalid chars. Block extra decimals if already has 2 decimal places typed.
   - `handleExchangeRateKeyDown(e: React.KeyboardEvent<HTMLInputElement>)`: Block invalid chars. Block extra decimals if already has 4 decimal places typed.
   - `handleQuantityKeyDown(e: React.KeyboardEvent<HTMLInputElement>)`: Block invalid chars AND block decimal point entirely (integers only).

2. **Validation Helpers** (for form submit):
   - `validateAmount(value: string): boolean` - Returns true if valid positive number or empty string
   - `validateExchangeRate(value: string): boolean` - Returns true if valid positive number > 0 or empty string
   - `validateQuantity(value: string): boolean` - Returns true if valid positive integer or empty string

3. **Parse Helpers** (for form submit - formats to correct decimals):
   - `parseAmount(value: string): number` - Returns number rounded to 2 decimals, or 0 if invalid
   - `parseExchangeRate(value: string): number` - Returns number rounded to 4 decimals, or 1 if invalid/empty
   - `parseQuantity(value: string): number` - Returns integer, or 0 if invalid

Implementation notes:
- Keydown handlers check current input value to count decimal places
- Use `e.currentTarget.value` to get current input value
- Block key if adding it would exceed decimal limit
- Allow navigation keys (arrow, backspace, delete, tab, etc.)
- Allow Ctrl/Cmd combinations (copy, paste, select all)
  </action>
  <verify>File exists at lib/utils/number-input.ts with all exports</verify>
  <done>All keydown handlers and validators are implemented and exported</done>
</task>

<task type="auto">
  <name>Task 2: Re-export from lib/utils/index.ts</name>
  <files>lib/utils/index.ts</files>
  <action>
Add re-export statement at the end of lib/utils/index.ts:

```typescript
// Number input utilities
export {
  handleAmountKeyDown,
  handleExchangeRateKeyDown,
  handleQuantityKeyDown,
  validateAmount,
  validateExchangeRate,
  validateQuantity,
  parseAmount,
  parseExchangeRate,
  parseQuantity,
} from "./number-input";
```

This allows importing from "@/lib/utils" directly.
  </action>
  <verify>grep "number-input" lib/utils/index.ts shows the export</verify>
  <done>Number input utilities are re-exported from lib/utils/index.ts</done>
</task>

<task type="auto">
  <name>Task 3: Verify TypeScript compilation</name>
  <files>lib/utils/number-input.ts, lib/utils/index.ts</files>
  <action>
Run TypeScript check to ensure no compilation errors:
```bash
npm run type-check
```

If errors occur, fix them in the utility file.
  </action>
  <verify>npm run type-check passes without errors</verify>
  <done>TypeScript compilation succeeds with new utilities</done>
</task>

</tasks>

<verification>
- [ ] lib/utils/number-input.ts exists with all 9 exports
- [ ] lib/utils/index.ts re-exports all number input utilities
- [ ] npm run type-check passes
- [ ] Keydown handlers have correct logic for decimal limiting
</verification>

<success_criteria>
Number input utilities are available for import from "@/lib/utils" and ready for use in form components.
</success_criteria>

<output>
After completion, create `.planning/phases/14-currency-number-input-standardization/14-01-SUMMARY.md`
</output>
