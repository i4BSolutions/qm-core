---
phase: 36-ui-component-standardization
plan: 03
type: execute
wave: 2
depends_on: ["36-01", "36-02"]
files_modified:
  - app/(dashboard)/qmrl/page.tsx
  - app/(dashboard)/po/page.tsx
  - app/(dashboard)/item/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "QMRL list page uses PageHeader, FilterBar, and CardViewGrid composites instead of inline JSX for header, filters, and kanban grid"
    - "PO list page uses PageHeader and FilterBar composites instead of inline JSX for header and filters"
    - "Item detail page uses DetailPageLayout composite instead of inline JSX for back button, header, and content structure"
    - "All 3 pilot pages render identically to their pre-migration appearance (no visual regression)"
    - "All 3 pilot pages maintain full existing functionality (search, filter, pagination, navigation)"
  artifacts:
    - path: "app/(dashboard)/qmrl/page.tsx"
      provides: "QMRL list page using composite components"
      contains: "import { PageHeader, FilterBar, CardViewGrid }"
    - path: "app/(dashboard)/po/page.tsx"
      provides: "PO list page using composite components"
      contains: "import { PageHeader, FilterBar }"
    - path: "app/(dashboard)/item/[id]/page.tsx"
      provides: "Item detail page using composite components"
      contains: "import { DetailPageLayout }"
  key_links:
    - from: "app/(dashboard)/qmrl/page.tsx"
      to: "components/composite/index.ts"
      via: "import"
      pattern: "from \"@/components/composite\""
    - from: "app/(dashboard)/po/page.tsx"
      to: "components/composite/index.ts"
      via: "import"
      pattern: "from \"@/components/composite\""
    - from: "app/(dashboard)/item/[id]/page.tsx"
      to: "components/composite/index.ts"
      via: "import"
      pattern: "from \"@/components/composite\""
---

<objective>
Migrate 3 pilot pages (QMRL list, PO list, Item detail) to use the new composite components, validating that the composites work correctly in real page contexts without visual regression.

Purpose: This validates the composite components against real pages before Phase 40 rolls them out to all 54+ pages. If a composite doesn't fit, we fix it here rather than discovering issues during mass migration.

Output: 3 updated page files that import from `@/components/composite` instead of using inline JSX for headers, filters, and layout structure.
</objective>

<execution_context>
@/home/yaungni/.claude/get-shit-done/workflows/execute-plan.md
@/home/yaungni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/36-ui-component-standardization/36-RESEARCH.md

Must read summaries from Wave 1 plans:
@.planning/phases/36-ui-component-standardization/36-01-SUMMARY.md
@.planning/phases/36-ui-component-standardization/36-02-SUMMARY.md

Reference current page implementations (read before modifying):
@app/(dashboard)/qmrl/page.tsx
@app/(dashboard)/po/page.tsx
@app/(dashboard)/item/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate QMRL list and PO list pages to composites</name>
  <files>
    app/(dashboard)/qmrl/page.tsx
    app/(dashboard)/po/page.tsx
  </files>
  <action>
Read each file fully before modifying. The goal is SURGICAL replacement of inline JSX with composite components. Do NOT change data fetching, filtering, pagination, or business logic. Only replace the JSX rendering sections.

**QMRL list page (`app/(dashboard)/qmrl/page.tsx`):**

1. Add import: `import { PageHeader, FilterBar, CardViewGrid } from "@/components/composite";`
2. Remove imports that are no longer directly used (Search icon from lucide-react will be used by FilterBar internally, but check if it's still used elsewhere in the file before removing).

3. Replace the Page Header section (the `div` with class "relative flex items-start justify-between" containing the badge, h1, description, and New Request button — approximately lines 248-276) with:
```tsx
<PageHeader
  title="Request Letters"
  description={`${totalItems} request${totalItems !== 1 ? "s" : ""} found${totalItems !== qmrls.length ? ` (of ${qmrls.length} total)` : ""}`}
  badge={
    <div className="flex items-center gap-2 px-3 py-1 rounded bg-amber-500/10 border border-amber-500/20">
      <Radio className="h-4 w-4 text-amber-500" />
      <span className="text-xs font-semibold uppercase tracking-widest text-amber-500">
        Operations
      </span>
    </div>
  }
  actions={
    <Link href="/qmrl/new">
      <Button className="group relative overflow-hidden">
        <span className="relative z-10 flex items-center gap-2">
          <Plus className="h-4 w-4 transition-transform group-hover:rotate-90" />
          New Request
        </span>
      </Button>
    </Link>
  }
/>
```

4. Replace the Filters Bar section (the `div` with class "command-panel" containing search input and select dropdowns — approximately lines 279-321) with:
```tsx
<FilterBar>
  <FilterBar.Search
    value={searchQuery}
    onChange={setSearchQuery}
    placeholder="Search by title, ID, or description..."
  />
  <FilterBar.Select
    value={categoryFilter}
    onChange={setCategoryFilter}
    options={[
      { value: "all", label: "All Categories" },
      ...categories.map(cat => ({ value: cat.id, label: cat.name })),
    ]}
    placeholder="Category"
    icon={<Tag className="h-4 w-4 text-slate-400" />}
    width="w-[160px]"
  />
  <FilterBar.Select
    value={assignedFilter}
    onChange={setAssignedFilter}
    options={[
      { value: "all", label: "All Assignees" },
      ...users.map(u => ({ value: u.id, label: u.full_name })),
    ]}
    placeholder="Assignee"
    icon={<User className="h-4 w-4 text-slate-400" />}
    width="w-[160px]"
  />
</FilterBar>
```

5. Replace the Status Board kanban grid (the `div` with class "grid gap-6 lg:grid-cols-3" containing the 3 status columns — approximately lines 324-436) with:
```tsx
<CardViewGrid
  items={paginatedQmrls}
  groups={statusGroups.map(g => ({ key: g.key, label: g.label, dotClass: g.dotClass }))}
  groupBy={(qmrl) => qmrl.status?.status_group || "to_do"}
  emptyMessage="No requests"
  renderCard={(qmrl, index) => (
    <Link key={qmrl.id} href={`/qmrl/${qmrl.id}`} className="block mb-2">
      {/* Keep the entire tactical-card JSX as-is — this is card content, not layout */}
      <div className="tactical-card corner-accents p-4 animate-slide-up cursor-pointer" style={{ animationDelay: `${index * 50}ms` }}>
        {/* ... existing card content unchanged ... */}
      </div>
    </Link>
  )}
/>
```
IMPORTANT: Keep the entire card content JSX inside renderCard exactly as it exists today. The card interior (scan-overlay, header row, title, category badge, meta row, status badge) is domain-specific and should NOT be abstracted into the composite.

6. Keep the existing loading skeleton, error banner, and pagination sections unchanged.

**PO list page (`app/(dashboard)/po/page.tsx`):**

1. Add import: `import { PageHeader, FilterBar } from "@/components/composite";`

2. Replace the Page Header section (approximately lines 270-324) with:
```tsx
<PageHeader
  title="Purchase Orders"
  description={`${totalItems} PO${totalItems !== 1 ? "s" : ""} found${totalItems !== pos.length ? ` (of ${pos.length} total)` : ""}`}
  badge={
    <div className="flex items-center gap-2 px-3 py-1 rounded bg-purple-500/10 border border-purple-500/20">
      <Radio className="h-4 w-4 text-purple-500" />
      <span className="text-xs font-semibold uppercase tracking-widest text-purple-500">
        Procurement
      </span>
    </div>
  }
  actions={
    <div className="flex items-center gap-2">
      {/* View Toggle — keep inline, domain-specific */}
      <div className="flex items-center border border-slate-700 rounded-lg overflow-hidden">
        <button onClick={() => setViewMode("card")} className={`p-2 transition-colors ${viewMode === "card" ? "bg-amber-500/20 text-amber-400" : "bg-slate-800/50 text-slate-400 hover:text-slate-200"}`}>
          <LayoutGrid className="h-4 w-4" />
        </button>
        <button onClick={() => setViewMode("list")} className={`p-2 transition-colors ${viewMode === "list" ? "bg-amber-500/20 text-amber-400" : "bg-slate-800/50 text-slate-400 hover:text-slate-200"}`}>
          <List className="h-4 w-4" />
        </button>
      </div>
      <Link href="/po/new">
        <Button className="group relative overflow-hidden">
          <span className="relative z-10 flex items-center gap-2">
            <Plus className="h-4 w-4 transition-transform group-hover:rotate-90" />
            New PO
          </span>
        </Button>
      </Link>
    </div>
  }
/>
```

3. Replace the Filters Bar section (approximately lines 327-386) with:
```tsx
<FilterBar>
  <FilterBar.Search
    value={searchQuery}
    onChange={setSearchQuery}
    placeholder="Search by PO#, supplier, QMHQ..."
  />
  <FilterBar.Select
    value={statusFilter}
    onChange={setStatusFilter}
    options={[
      { value: "all", label: "All Statuses" },
      ...Object.entries(PO_STATUS_CONFIG).map(([key, config]) => ({
        value: key,
        label: config.label,
      })),
    ]}
    placeholder="Status"
  />
  <FilterBar.Select
    value={supplierFilter}
    onChange={setSupplierFilter}
    options={[
      { value: "all", label: "All Suppliers" },
      ...suppliers.map(s => ({
        value: s.id,
        label: s.company_name || s.name,
      })),
    ]}
    placeholder="Supplier"
  />
</FilterBar>
```

Note: The PO status filter currently has colored dots next to status names in the SelectItem. The FilterBar.Select sub-component uses plain text labels. This is an acceptable simplification for Phase 36 — the status dots are a nice-to-have that can be added as an optional `renderOption` prop in Phase 40 if needed.

4. Keep the card view (with CardViewGrid NOT applied to PO page yet — the PO page has card AND list view toggle which adds complexity). The PO card view section can be migrated to CardViewGrid in Phase 40 when we also handle the list/card toggle pattern. For now, only header and filter bar are migrated.

5. Keep the list view table, loading skeleton, error banner, and pagination sections unchanged.

**For both pages:** After editing, verify that no import is unused (remove imports replaced by composites), and that the JSX structure is valid.
  </action>
  <verify>
Run `npx tsc --noEmit` — both files must compile. Run `npm run build` to verify no build errors. If build fails, fix the issues.
  </verify>
  <done>
QMRL list page uses PageHeader, FilterBar, and CardViewGrid composites. PO list page uses PageHeader and FilterBar composites. Both compile and build successfully. No functionality or visual regression (same data fetching, filtering, pagination logic).
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate Item detail page to DetailPageLayout composite</name>
  <files>
    app/(dashboard)/item/[id]/page.tsx
  </files>
  <action>
Read the full file before modifying. Replace the outer layout structure with DetailPageLayout while keeping all domain-specific content.

1. Add import: `import { DetailPageLayout } from "@/components/composite";`

2. Replace the outer structure of the main return (lines 370-717 approximately). Currently it's:
```
<div className="space-y-6 relative">
  <div className="fixed inset-0 pointer-events-none grid-overlay opacity-30" />
  <div className="relative flex items-start justify-between animate-fade-in">
    <div className="flex items-start gap-4">
      <Link href="/item"><Button variant="ghost" size="icon" ...><ArrowLeft /></Button></Link>
      {/* item photo + title + badges */}
    </div>
    <div className="flex items-center gap-2">
      {/* Stock In / Stock Out buttons */}
    </div>
  </div>
  {/* WAC Panel */}
  {/* Tabs */}
</div>
```

Replace with:
```tsx
<DetailPageLayout
  backHref="/item"
  header={
    <>
      {/* Item Photo */}
      <div className="relative w-16 h-16 rounded-lg overflow-hidden border border-slate-700 bg-slate-800/50 flex items-center justify-center">
        {item.photo_url ? (
          <Image src={item.photo_url} alt={item.name} fill className="object-cover" sizes="64px" />
        ) : (
          <ImageIcon className="h-6 w-6 text-slate-500" />
        )}
      </div>
      <div>
        {item.sku && (
          <div className="request-id-badge mb-2">
            <code className="text-sm">{item.sku}</code>
          </div>
        )}
        <h1 className="text-2xl font-bold tracking-tight text-slate-200">{item.name}</h1>
        <div className="flex items-center gap-3 mt-2">
          {/* ... category badge and unit ... */}
        </div>
      </div>
    </>
  }
  actions={
    <>
      <Link href="/inventory/stock-in">
        <Button variant="outline" className="border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/10">
          <ArrowDownToLine className="mr-2 h-4 w-4" />
          Stock In
        </Button>
      </Link>
      <Link href="/inventory/stock-out">
        <Button variant="outline" className="border-red-500/30 text-red-400 hover:bg-red-500/10">
          <ArrowUpFromLine className="mr-2 h-4 w-4" />
          Stock Out
        </Button>
      </Link>
    </>
  }
  kpiPanel={
    <div className="command-panel corner-accents animate-slide-up" style={{ animationDelay: "50ms" }}>
      {/* ... existing WAC panel grid with 4 KPI cards ... */}
    </div>
  }
>
  {/* Tabs section — keep entirely as-is */}
  <Tabs value={activeTab} onValueChange={setActiveTab} ...>
    {/* ... all tab content unchanged ... */}
  </Tabs>
</DetailPageLayout>
```

3. Remove the now-redundant imports:
   - `ArrowLeft` from lucide-react (now used inside DetailPageLayout internally)
   - Check if Link is still used elsewhere in the file (it IS used in tab content, so keep it)

4. CRITICAL: Keep ALL domain content inside the slots exactly as-is. The item photo, SKU badge, category badge, WAC panel, and all tab content must remain unchanged. Only the outer structural shell (back button, flex layout, grid overlay) is replaced by DetailPageLayout.

5. The loading state and not-found state (lines 341-368) should remain OUTSIDE DetailPageLayout — they return early before the main content.
  </action>
  <verify>
Run `npx tsc --noEmit` — file must compile. Run `npm run build` — must succeed. Check that the import from "@/components/composite" resolves.
  </verify>
  <done>
Item detail page uses DetailPageLayout composite for its outer structure. Back button, header layout, and grid overlay are provided by the composite. All domain content (photo, WAC panel, tabs) passed via slots. Compiles and builds successfully.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes for all 3 modified files
2. `npm run build` succeeds without errors
3. QMRL page imports from "@/components/composite" (PageHeader, FilterBar, CardViewGrid)
4. PO page imports from "@/components/composite" (PageHeader, FilterBar)
5. Item detail page imports from "@/components/composite" (DetailPageLayout)
6. No duplicate JSX — header/filter sections replaced, not duplicated
7. All data fetching, filtering, pagination logic unchanged in each file
8. Card content (tactical-card interiors) unchanged — only wrapper/structure replaced
</verification>

<success_criteria>
- 3 pilot pages successfully migrated to use composite components
- All pages compile and build without errors
- No visual regression — same spacing, colors, typography as before migration
- No functionality regression — search, filter, pagination, navigation all work
- Composite components proven to work in real page contexts
- Migration pattern established for Phase 40 rollout to remaining pages
</success_criteria>

<output>
After completion, create `.planning/phases/36-ui-component-standardization/36-03-SUMMARY.md`
</output>
