---
phase: 24-responsive-typography
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tailwind.config.ts
  - lib/utils/format-compact.ts
  - lib/utils/index.ts
autonomous: true

must_haves:
  truths:
    - "Fluid font size classes are available in Tailwind (text-fluid-amount-*)"
    - "formatCompactCurrency returns abbreviated values with K/M/B notation"
    - "Abbreviation respects context thresholds (card: 1M, table: 1B, detail: never)"
  artifacts:
    - path: "tailwind.config.ts"
      provides: "Fluid font size utilities"
      contains: "fluid-amount"
    - path: "lib/utils/format-compact.ts"
      provides: "Compact number formatting with K/M/B"
      exports: ["formatCompactNumber", "formatCompactCurrency", "ABBREVIATION_THRESHOLDS"]
  key_links:
    - from: "lib/utils/index.ts"
      to: "lib/utils/format-compact.ts"
      via: "re-export"
      pattern: "export.*from.*format-compact"
---

<objective>
Add fluid typography foundation and compact number formatting utilities.

Purpose: Provide CSS utilities for responsive font scaling and JavaScript utilities for K/M/B abbreviation that CurrencyDisplay will consume.

Output: Tailwind config with fluid font sizes, formatCompactCurrency utility ready for use.
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-responsive-typography/24-CONTEXT.md
@.planning/phases/24-responsive-typography/24-RESEARCH.md
@tailwind.config.ts
@lib/utils/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add fluid font size utilities to Tailwind config</name>
  <files>tailwind.config.ts</files>
  <action>
Add fluid font size utilities to the fontSize section in theme.extend:

```typescript
fontSize: {
  // Existing display sizes...

  // Fluid amount sizes - scale smoothly with viewport
  // Formula: clamp(min, preferred, max)
  // Min 12px (0.75rem) for accessibility, scales with viewport
  'fluid-amount-sm': ['clamp(0.75rem, 0.7rem + 0.25vw, 0.875rem)', { lineHeight: '1.25' }],
  'fluid-amount-base': ['clamp(0.875rem, 0.8rem + 0.375vw, 1rem)', { lineHeight: '1.25' }],
  'fluid-amount-lg': ['clamp(1rem, 0.9rem + 0.5vw, 1.25rem)', { lineHeight: '1.25' }],
  'fluid-amount-xl': ['clamp(1.125rem, 1rem + 0.625vw, 1.5rem)', { lineHeight: '1.2' }],
}
```

Per user decision: fluid scaling using CSS clamp() - font shrinks smoothly as number grows or container shrinks. Minimum 12px (0.75rem) per accessibility best practices.
  </action>
  <verify>Run `npm run build` - should complete without errors. Grep tailwind.config.ts for "fluid-amount".</verify>
  <done>Four fluid font size utilities available: text-fluid-amount-sm, text-fluid-amount-base, text-fluid-amount-lg, text-fluid-amount-xl</done>
</task>

<task type="auto">
  <name>Task 2: Create formatCompactCurrency utility</name>
  <files>lib/utils/format-compact.ts, lib/utils/index.ts</files>
  <action>
Create lib/utils/format-compact.ts with:

1. ABBREVIATION_THRESHOLDS constant:
   - card: 1_000_000 (abbreviate at 1M+ on cards)
   - table: 1_000_000_000 (abbreviate at 1B+ in tables)
   - detail: Infinity (never abbreviate on detail pages)

2. formatCompactNumber function:
   - Uses Intl.NumberFormat with notation: "compact"
   - maximumFractionDigits: 1 for precision (per pitfall #3 from research)
   - Handles negative numbers correctly (preserves minus sign)

3. formatCompactCurrency function:
   - Parameters: value, currency, threshold (default 1M), decimals (default 2)
   - Returns: { display: string, isAbbreviated: boolean, fullValue: string }
   - If abs(value) >= threshold: return abbreviated with K/M/B
   - Otherwise: return full formatted value
   - fullValue always contains the complete formatted number for tooltip

4. DisplayContext type export for type safety

Per user decisions:
- K/M/B abbreviations (not ellipsis)
- Context-dependent thresholds (cards abbreviate earlier)
- Tooltip shows only the truncated value (fullValue is for single currency line)

Add export to lib/utils/index.ts:
```typescript
export {
  formatCompactNumber,
  formatCompactCurrency,
  ABBREVIATION_THRESHOLDS,
  type DisplayContext,
} from "./format-compact";
```
  </action>
  <verify>
Create a quick test in terminal:
```bash
npx tsx -e "
const { formatCompactCurrency } = require('./lib/utils/format-compact');
console.log(formatCompactCurrency(1234567, 'MMK', 1000000));
console.log(formatCompactCurrency(999999, 'MMK', 1000000));
console.log(formatCompactCurrency(-5000000, 'USD', 1000000));
console.log(formatCompactCurrency(0, 'MMK', 1000000));
"
```
Expected output shows abbreviated and non-abbreviated versions correctly.
  </verify>
  <done>formatCompactCurrency correctly abbreviates large numbers to K/M/B, preserves negative sign, and returns isAbbreviated flag for tooltip display</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Tailwind config contains fluid-amount font sizes
3. formatCompactCurrency utility works with various inputs:
   - Large positive numbers (1M+) abbreviate to "1.2M MMK"
   - Small numbers stay full "123,456.00 MMK"
   - Negative numbers show "-1.2M MMK"
   - Zero shows "0.00 MMK"
</verification>

<success_criteria>
- Fluid font size utilities (text-fluid-amount-*) available in Tailwind
- formatCompactCurrency properly abbreviates large numbers with K/M/B notation
- Context-dependent thresholds exported for use by CurrencyDisplay
- All utilities exported from lib/utils/index.ts
</success_criteria>

<output>
After completion, create `.planning/phases/24-responsive-typography/24-01-SUMMARY.md`
</output>
