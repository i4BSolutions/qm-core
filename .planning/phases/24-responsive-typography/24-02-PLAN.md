---
phase: 24-responsive-typography
plan: 02
type: execute
wave: 2
depends_on: [24-01]
files_modified:
  - components/ui/currency-display.tsx
  - components/ui/currency-skeleton.tsx
  - components/po/po-card.tsx
  - components/invoice/invoice-card.tsx
autonomous: true

must_haves:
  truths:
    - "CurrencyDisplay shows K/M/B abbreviation for large amounts on cards"
    - "Abbreviated amounts show tooltip with full value on hover (desktop only)"
    - "Negative amounts display with minus prefix and red text color"
    - "Zero amounts display as '0.00 CURRENCY' with normal styling (not dash)"
    - "Both primary and EUSD lines scale proportionally with fluid prop"
    - "CurrencySkeleton provides loading placeholder matching expected amount width"
  artifacts:
    - path: "components/ui/currency-display.tsx"
      provides: "Enhanced CurrencyDisplay with fluid, context, abbreviation"
      contains: "context?: 'card' | 'table' | 'detail'"
    - path: "components/ui/currency-skeleton.tsx"
      provides: "Loading skeleton for currency amounts"
      exports: ["CurrencySkeleton"]
    - path: "components/po/po-card.tsx"
      provides: "PO card with responsive amounts"
      contains: "context=\"card\""
    - path: "components/invoice/invoice-card.tsx"
      provides: "Invoice card with responsive amounts"
      contains: "context=\"card\""
  key_links:
    - from: "components/ui/currency-display.tsx"
      to: "lib/utils/format-compact.ts"
      via: "import formatCompactCurrency"
      pattern: "import.*formatCompactCurrency"
    - from: "components/ui/currency-display.tsx"
      to: "components/ui/tooltip.tsx"
      via: "Radix Tooltip for abbreviated values"
      pattern: "Tooltip.*TooltipContent"
---

<objective>
Enhance CurrencyDisplay with fluid typography and K/M/B abbreviation, create CurrencySkeleton, and update card components.

Purpose: Make amount displays responsive across viewport sizes, abbreviate large numbers with tooltips, and provide proper loading states.

Output: Enhanced CurrencyDisplay component with fluid sizing and abbreviation, CurrencySkeleton for loading, cards updated with context="card".
</objective>

<execution_context>
@/Users/thihaaung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thihaaung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-responsive-typography/24-CONTEXT.md
@.planning/phases/24-responsive-typography/24-RESEARCH.md
@.planning/phases/24-responsive-typography/24-01-SUMMARY.md
@components/ui/currency-display.tsx
@components/ui/skeleton.tsx
@components/ui/tooltip.tsx
@components/po/po-card.tsx
@components/invoice/invoice-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance CurrencyDisplay component</name>
  <files>components/ui/currency-display.tsx</files>
  <action>
Enhance CurrencyDisplay with new props and behavior:

1. Add new props to CurrencyDisplayProps:
   - `context?: "card" | "table" | "detail"` - determines abbreviation threshold (default: "detail")
   - `fluid?: boolean` - enables fluid font scaling (default: false for backward compatibility)

2. Import dependencies:
   - Import formatCompactCurrency, ABBREVIATION_THRESHOLDS from "@/lib/utils/format-compact"
   - Import Tooltip, TooltipTrigger, TooltipContent from "@/components/ui/tooltip"

3. Update size styling to support fluid:
   - Non-fluid: Keep existing fixed sizes (text-sm, text-base, text-lg)
   - Fluid: Use text-fluid-amount-* classes
   - EUSD line scales proportionally (when primary is fluid-base, secondary is fluid-sm)

4. Format both amounts using formatCompactCurrency:
   - Get threshold from ABBREVIATION_THRESHOLDS[context]
   - Format primary amount with context threshold
   - Format EUSD with same threshold (both abbreviate together per user decision)

5. Handle negative amounts:
   - If displayAmount < 0: add text-red-400 to primary, text-red-400/70 to secondary
   - formatCompactCurrency already preserves minus sign

6. Handle zero amounts:
   - Per user decision: display as "0.00 CURRENCY" with normal styling (not dash, not muted)
   - Update isEmpty check: only null/undefined triggers showDashForEmpty, NOT zero

7. Add tooltip wrapper when abbreviated:
   - If primary.isAbbreviated is true, wrap content in Tooltip
   - TooltipContent shows primary.fullValue only (not both currencies per user decision)
   - Add `className="hidden md:block"` to TooltipContent (desktop only per user decision)
   - Add cursor-help class to trigger

8. Keep existing CurrencyInline component unchanged (it's for different use case)

Per user decisions:
- Fluid scaling using CSS clamp()
- EUSD line scales in proportion to primary (not independently)
- K/M/B abbreviations (not ellipsis)
- Context-dependent thresholds
- Hover tooltip desktop only
- Tooltip shows only the truncated value
- Negative amounts: minus sign + red text
- Zero amounts: "0.00" with currency symbol, normal styling
- Keep two-line stacked format
  </action>
  <verify>
Run `npm run build` - no TypeScript errors.
Verify component renders correctly with various test values by checking the component code structure.
  </verify>
  <done>CurrencyDisplay supports fluid sizing, context-based abbreviation, tooltips for abbreviated values, red styling for negative amounts, and proper zero display</done>
</task>

<task type="auto">
  <name>Task 2: Create CurrencySkeleton component</name>
  <files>components/ui/currency-skeleton.tsx</files>
  <action>
Create CurrencySkeleton component for loading states:

1. Import Skeleton from "@/components/ui/skeleton" and cn from "@/lib/utils"

2. Define CurrencySkeletonProps:
   - size?: "sm" | "md" | "lg" (default: "md")
   - align?: "left" | "right" (default: "left")
   - className?: string

3. Define size-based dimensions matching CurrencyDisplay proportions:
   - sm: primary h-4 w-24, secondary h-3 w-20
   - md: primary h-5 w-28, secondary h-4 w-24
   - lg: primary h-6 w-32, secondary h-4 w-28

4. Render two-line skeleton matching CurrencyDisplay format:
   ```tsx
   <div className={cn("flex flex-col gap-1", align === "right" && "items-end", className)}>
     <Skeleton className={sizeMap[size].primary} />
     <Skeleton className={sizeMap[size].secondary} />
   </div>
   ```

Per user decision: Loading states use skeleton placeholder matching expected amount width.
  </action>
  <verify>Verify the file exists and exports CurrencySkeleton correctly.</verify>
  <done>CurrencySkeleton provides two-line loading placeholder with size variants matching CurrencyDisplay</done>
</task>

<task type="auto">
  <name>Task 3: Update card components with fluid and context props</name>
  <files>components/po/po-card.tsx, components/invoice/invoice-card.tsx</files>
  <action>
Update PO and Invoice card components to use new CurrencyDisplay props:

1. In po-card.tsx, update CurrencyDisplay usage:
   ```tsx
   <CurrencyDisplay
     amount={po.total_amount}
     currency={po.currency || "MMK"}
     amountEusd={po.total_amount_eusd}
     size="sm"
     align="right"
     context="card"    // ADD: cards abbreviate at 1M+
     fluid             // ADD: enable fluid font scaling
   />
   ```

2. In invoice-card.tsx, update CurrencyDisplay usage:
   ```tsx
   <CurrencyDisplay
     amount={invoice.total_amount}
     currency={invoice.currency || "MMK"}
     amountEusd={invoice.total_amount_eusd}
     size="sm"
     align="right"
     context="card"    // ADD: cards abbreviate at 1M+
     fluid             // ADD: enable fluid font scaling
   />
   ```

Per user decisions:
- Apply fluid scaling everywhere (cards, summary sections, tables, detail pages)
- Cards abbreviate earlier (at 1M+)
  </action>
  <verify>
Run `npm run build` - no errors.
Grep for 'context="card"' in both card files to confirm usage.
  </verify>
  <done>PO and Invoice cards use fluid sizing and card context for responsive amount display</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. CurrencyDisplay component has context and fluid props
3. CurrencySkeleton component exists and exports correctly
4. PO card and Invoice card use context="card" and fluid props
5. Manual test: amounts on cards should show K/M/B abbreviation for 1M+ values
6. Manual test: hover on abbreviated amount shows full value tooltip (desktop)
7. Manual test: negative amounts display in red
8. Manual test: zero amounts display as "0.00 CURRENCY" (not dash)
</verification>

<success_criteria>
- CurrencyDisplay supports fluid font scaling with text-fluid-amount-* classes
- Large amounts (1M+ on cards) show K/M/B abbreviation with tooltip
- Negative amounts display with red color
- Zero amounts display normally (not as dash)
- Both primary and EUSD lines scale together proportionally
- Cards use context="card" for earlier abbreviation
- CurrencySkeleton available for loading states
</success_criteria>

<output>
After completion, create `.planning/phases/24-responsive-typography/24-02-SUMMARY.md`
</output>
