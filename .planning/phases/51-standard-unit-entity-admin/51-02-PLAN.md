---
phase: 51-standard-unit-entity-admin
plan: 02
type: execute
wave: 2
depends_on: ["51-01"]
files_modified:
  - app/(dashboard)/admin/standard-units/page.tsx
  - app/(dashboard)/admin/standard-units/unit-dialog.tsx
  - components/layout/sidebar.tsx
  - components/forms/inline-create-select.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can view all standard units in a data table at /admin/standard-units"
    - "Admin can create a new standard unit via dialog with name field"
    - "Admin can edit an existing standard unit name and display_order"
    - "Admin can delete a standard unit (hard delete, blocked if items reference it)"
    - "Item usage count column shows 0 for all units (FK not yet added)"
    - "Standard Units link appears in sidebar Admin section"
    - "InlineCreateSelect supports createType 'standard_unit' for Phase 52 readiness"
  artifacts:
    - path: "app/(dashboard)/admin/standard-units/page.tsx"
      provides: "Standard unit admin list page"
      contains: "StandardUnitsPage"
    - path: "app/(dashboard)/admin/standard-units/unit-dialog.tsx"
      provides: "Create/Edit dialog for standard units"
      contains: "UnitDialog"
    - path: "components/layout/sidebar.tsx"
      provides: "Sidebar with Standard Units nav entry"
      contains: "Standard Units"
    - path: "components/forms/inline-create-select.tsx"
      provides: "Extended inline creation supporting standard_unit type"
      contains: "standard_unit"
  key_links:
    - from: "app/(dashboard)/admin/standard-units/page.tsx"
      to: "app/(dashboard)/admin/standard-units/unit-dialog.tsx"
      via: "UnitDialog import and usage"
      pattern: "import.*UnitDialog"
    - from: "app/(dashboard)/admin/standard-units/page.tsx"
      to: "standard_units table"
      via: "Supabase client query"
      pattern: "from.*standard_units"
    - from: "components/forms/inline-create-select.tsx"
      to: "standard_units table"
      via: "Supabase client insert"
      pattern: "from.*standard_units"
---

<objective>
Build the admin management page for standard units following the exact same DataTable + Dialog pattern as /admin/categories, add sidebar navigation, and extend inline-create-select for standard_unit type.

Purpose: Admin can fully manage standard units (CRUD) and the inline creation component is ready for Phase 52.
Output: Admin page, dialog component, sidebar entry, extended inline creation.
</objective>

<execution_context>
@/home/yaungni/.claude/get-shit-done/workflows/execute-plan.md
@/home/yaungni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/51-standard-unit-entity-admin/51-01-SUMMARY.md
@app/(dashboard)/admin/categories/page.tsx
@app/(dashboard)/admin/categories/category-dialog.tsx
@components/layout/sidebar.tsx
@components/forms/inline-create-select.tsx
@types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create standard units admin page and dialog</name>
  <files>
    app/(dashboard)/admin/standard-units/page.tsx
    app/(dashboard)/admin/standard-units/unit-dialog.tsx
  </files>
  <action>
**Follow the EXACT same component structure as /admin/categories** (page.tsx + category-dialog.tsx).

**unit-dialog.tsx:**
Create `UnitDialog` component with props: `{ open, onClose, unit }` where unit is `StandardUnit | null`.

Dialog form fields:
- Name (required, text input, placeholder "e.g., kg, pcs, box")
- Display Order (number input, auto-managed)

On create: INSERT into `standard_units` table with `name` and `display_order`
On edit: UPDATE the record by id
Use the same toast notification pattern as CategoryDialog.
No color picker (unlike categories). No entity_type field (standard units are global).
Dialog title: "Add Standard Unit" / "Edit Standard Unit"
Dialog description: "Add a new unit of measurement." / "Update the unit details."

When editing, pre-populate with existing values via useEffect (same pattern as CategoryDialog).

**page.tsx:**
Create `StandardUnitsPage` with DataTable listing all standard units.

Fetch: Query `standard_units` table ordered by `display_order`. No `is_active` filter (hard delete, not soft delete).

Table columns:
1. **Name** - font-medium text-slate-200
2. **Item Count** - Show count of items using this unit. For now (Phase 52 has not added FK), query items table with `standard_unit_id` column. Since the column doesn't exist yet, show "0" for all rows with a tooltip "Available after item assignment". Use slate-400 styling.
3. **Display Order** - font-mono text-slate-400
4. **Actions** - DropdownMenu with Edit and Delete (same pattern as categories)

Permission checks: Use `can("create", "categories")` / `can("update", "categories")` / `can("delete", "categories")` as admin proxy (same pattern as categories page since standard_units is admin-only).

Delete handler: Use actual hard DELETE (not soft delete update). Handle error when deletion is blocked by FK constraint - show "Cannot delete: unit is in use" toast.

```typescript
const handleDelete = async (id: string) => {
  const supabase = createClient();
  const { error } = await supabase
    .from("standard_units")
    .delete()
    .eq("id", id);

  if (error) {
    const isReferenceError = error.message?.includes("violates foreign key") || error.message?.includes("Cannot delete");
    toast({
      title: isReferenceError ? "Cannot Delete" : "Error",
      description: isReferenceError
        ? "This unit is in use by items and cannot be deleted."
        : "Failed to delete unit.",
      variant: "destructive",
    });
  } else {
    toast({ title: "Success", description: "Unit deleted.", variant: "success" });
    fetchData();
  }
};
```

PageHeader: Title "Standard Units", description "Manage units of measurement for items", with violet Admin badge (same as categories).

Stats section: Single card showing total unit count (simpler than categories since no entity_type grouping).

No filter tabs (unlike categories which filter by entity_type).

Import `StandardUnit` from `@/types/database`.
  </action>
  <verify>
Run `npm run type-check` to verify compilation. Check that the page renders with DataTable, Dialog opens for create/edit, delete uses hard DELETE.
  </verify>
  <done>
Admin can view, create, edit, and delete standard units at /admin/standard-units. DataTable shows name, item count (always 0), and display order. Dialog allows name and display_order input.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add sidebar nav entry and extend inline-create-select</name>
  <files>
    components/layout/sidebar.tsx
    components/forms/inline-create-select.tsx
  </files>
  <action>
**1. Update sidebar.tsx:**
Add "Standard Units" entry to the admin navigation children array, positioned BEFORE "Settings":

In the `adminNavigation` array, find the Admin children array and add:
```typescript
{ label: "Standard Units", href: "/admin/standard-units" },
```

Place it after "Statuses" and before "Flow Tracking" for logical grouping:
```
Users, Departments, Suppliers, Contacts, Categories, Statuses, Standard Units, Flow Tracking, Settings
```

**2. Extend inline-create-select.tsx:**

Update the `createType` prop type to include `"standard_unit"`:
```typescript
createType: "category" | "status" | "standard_unit";
```

Add a new branch in the `handleCreate` function for standard_unit creation:
```typescript
} else if (createType === "standard_unit") {
  // Get max display_order for auto-append
  const { data: maxOrderData } = await supabase
    .from("standard_units")
    .select("display_order")
    .order("display_order", { ascending: false })
    .limit(1)
    .single();

  const nextOrder = (maxOrderData?.display_order ?? 0) + 1;

  const { data, error } = await supabase
    .from("standard_units")
    .insert({
      name: newName.trim(),
      display_order: nextOrder,
    })
    .select()
    .single();

  if (error) throw error;

  onOptionsChange([...options, data as unknown as T]);
  onValueChange(data.id);

  toast({
    title: "Success",
    description: `Unit "${newName}" created and selected`,
    variant: "success",
  });
}
```

For the inline creation form section, when `createType === "standard_unit"`:
- Show only the Name input (no color picker, no status group selector)
- The creation label should read "Create New Unit"
- The search placeholder should say "Search unit..."
- The hint text should say 'Click [+] button to create new unit'

To implement this cleanly:
- In the inline form rendering, conditionally hide the color picker when `createType === "standard_unit"`
- Update the display label: `createType === "category" ? "Category" : createType === "status" ? "Status" : "Unit"`
- The `entityType` prop is not needed for standard_unit creation (standard units are global, not per entity_type). Make `entityType` optional in the interface when createType is standard_unit.

Since entityType is currently used for category/status creation, keep it required in those cases but make it optional at the type level (it's only used in the insert for categories and statuses, not for standard_units). The simplest approach: keep `entityType` as-is in the interface but document it's unused for standard_unit.
  </action>
  <verify>
Run `npm run type-check` to verify compilation. Check that sidebar includes "Standard Units" link. Check that InlineCreateSelect accepts createType: "standard_unit" without TypeScript errors.
  </verify>
  <done>
Sidebar shows "Standard Units" under Admin section. InlineCreateSelect supports createType "standard_unit" with name-only inline form, auto display_order, and database insertion. Component is ready for Phase 52 to wire into item forms.
  </done>
</task>

</tasks>

<verification>
1. `npm run type-check` passes with no new errors
2. /admin/standard-units page exists and renders DataTable
3. UnitDialog opens for create and edit operations
4. Delete performs hard DELETE with FK protection error handling
5. Sidebar includes "Standard Units" link under Admin
6. InlineCreateSelect createType accepts "standard_unit"
7. Inline form for standard_unit shows only name input (no color picker)
8. Item count column shows 0 for all units
</verification>

<success_criteria>
- Admin can fully manage standard units (CRUD) via /admin/standard-units
- Sidebar navigation includes Standard Units link
- InlineCreateSelect is extended for Phase 52 consumption
- All TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/51-standard-unit-entity-admin/51-02-SUMMARY.md`
</output>
