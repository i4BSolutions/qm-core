---
phase: 53-standard-unit-display-refactor
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/20260216300000_drop_system_config.sql
  - components/ui/standard-unit-display.tsx
  - lib/hooks/use-standard-unit-name.ts
  - lib/hooks/index.ts
  - app/(dashboard)/admin/settings/page.tsx
  - components/layout/sidebar.tsx
  - types/database.ts
autonomous: true

must_haves:
  truths:
    - "StandardUnitDisplay component accepts unitName as a prop instead of fetching from system_config"
    - "useStandardUnitName hook is deleted and no code references it"
    - "system_config table is dropped from the database"
    - "Admin settings page is removed and sidebar link is gone"
    - "SystemConfig type is removed from types/database.ts"
  artifacts:
    - path: "supabase/migrations/20260216300000_drop_system_config.sql"
      provides: "Migration to drop system_config table, RLS policies, triggers, and indexes"
      contains: "DROP TABLE"
    - path: "components/ui/standard-unit-display.tsx"
      provides: "Presentational StandardUnitDisplay component with unitName prop"
      exports: ["StandardUnitDisplay", "StandardUnitDisplayProps"]
  key_links:
    - from: "components/ui/standard-unit-display.tsx"
      to: "none"
      via: "No more hook dependency -- pure presentational"
      pattern: "unitName.*string"
---

<objective>
Remove the global standard unit name infrastructure (system_config table, useStandardUnitName hook, admin settings page) and refactor StandardUnitDisplay to be a pure presentational component that accepts unitName as a prop. This is the foundation for all subsequent plans that wire per-item unit names.

Purpose: Eliminate the global config dependency so per-item standard unit names can flow through the system.
Output: Presentational StandardUnitDisplay component, database migration, cleanup of all global config artifacts.
</objective>

<execution_context>
@/home/yaungni/.claude/get-shit-done/workflows/execute-plan.md
@/home/yaungni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@components/ui/standard-unit-display.tsx
@lib/hooks/use-standard-unit-name.ts
@lib/hooks/index.ts
@app/(dashboard)/admin/settings/page.tsx
@components/layout/sidebar.tsx
@types/database.ts
@supabase/migrations/20260214210000_system_config.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Drop system_config table and remove admin settings page + sidebar link</name>
  <files>
    supabase/migrations/20260216300000_drop_system_config.sql
    app/(dashboard)/admin/settings/page.tsx
    components/layout/sidebar.tsx
  </files>
  <action>
1. Create migration `supabase/migrations/20260216300000_drop_system_config.sql`:
   - DROP POLICY system_config_select ON public.system_config
   - DROP POLICY system_config_insert ON public.system_config
   - DROP POLICY system_config_update ON public.system_config
   - DROP POLICY system_config_delete ON public.system_config
   - DROP TRIGGER trg_system_config_updated_at ON public.system_config
   - DROP INDEX IF EXISTS idx_system_config_key
   - DROP TABLE public.system_config
   - Add header comment: "Drop system_config table - standard unit names now come from per-item standard_units table"

2. Delete the admin settings page entirely. Remove the file `app/(dashboard)/admin/settings/page.tsx` (delete the file -- do NOT leave a placeholder).

3. In `components/layout/sidebar.tsx`:
   - Remove the sidebar entry `{ label: "Settings", href: "/admin/settings" }` from the Admin children array
   - If `Settings` from lucide-react was imported ONLY for this nav entry and is no longer used as the Admin section icon, remove the import. Check carefully -- it's used as the Admin section icon on line ~90, so likely still needed.
  </action>
  <verify>
    - `ls supabase/migrations/20260216300000_drop_system_config.sql` exists
    - `! test -f app/(dashboard)/admin/settings/page.tsx` (file deleted)
    - `grep -c "Settings.*href.*admin/settings" components/layout/sidebar.tsx` returns 0
  </verify>
  <done>system_config table will be dropped on next migration run, admin settings page is gone, sidebar has no settings link</done>
</task>

<task type="auto">
  <name>Task 2: Refactor StandardUnitDisplay to presentational and remove useStandardUnitName hook</name>
  <files>
    components/ui/standard-unit-display.tsx
    lib/hooks/use-standard-unit-name.ts
    lib/hooks/index.ts
    types/database.ts
  </files>
  <action>
1. Refactor `components/ui/standard-unit-display.tsx`:
   - Remove import of `useStandardUnitName`
   - Add `unitName` to `StandardUnitDisplayProps` interface: `unitName?: string;` (optional -- when not provided, second line is hidden)
   - Remove the `useStandardUnitName()` hook call inside the component
   - Update `showSecondLine` logic: `const showSecondLine = unitName && unitName.trim() !== "";` (no more isLoading check)
   - The component should remain a client component ("use client") since it's used in client contexts
   - Keep all other logic unchanged: size variants, alignment, formatting, calculation

   Updated props interface should be:
   ```
   interface StandardUnitDisplayProps {
     quantity: number | null | undefined;
     conversionRate: number;
     unitName?: string;          // NEW: per-item unit name
     size?: "sm" | "md" | "lg";
     align?: "left" | "right";
     className?: string;
   }
   ```

2. Delete `lib/hooks/use-standard-unit-name.ts` entirely (delete the file).

3. Update `lib/hooks/index.ts`:
   - Remove the line `export { useStandardUnitName } from "./use-standard-unit-name";`

4. Update `types/database.ts`:
   - Remove the `system_config` table definition from the Tables interface (the entire `system_config: { Row: {...}, Insert: {...}, Update: {...}, Relationships: [...] }` block)
   - Remove the type alias `export type SystemConfig = Tables<"system_config">`
   - Keep all other types intact
  </action>
  <verify>
    - `npm run type-check` passes (this will show errors in consumer files that still reference the old hook -- that's expected and will be fixed in Plans 02/03)
    - Actually, type-check will fail because consumers still import the deleted hook. Instead verify:
    - `grep -r "useStandardUnitName" components/ui/standard-unit-display.tsx` returns 0 matches
    - `! test -f lib/hooks/use-standard-unit-name.ts` (file deleted)
    - `grep -c "useStandardUnitName" lib/hooks/index.ts` returns 0
    - `grep -c "system_config" types/database.ts` returns 0
    - `grep "unitName" components/ui/standard-unit-display.tsx` shows unitName in props
  </verify>
  <done>StandardUnitDisplay is a pure presentational component with unitName prop, useStandardUnitName hook is deleted, SystemConfig type is removed. NOTE: Downstream consumers will have broken imports until Plans 02/03 update them.</done>
</task>

</tasks>

<verification>
- Migration file exists and drops system_config table with all policies
- StandardUnitDisplay accepts unitName as a prop
- useStandardUnitName hook file is deleted
- lib/hooks/index.ts no longer exports useStandardUnitName
- Admin settings page is deleted
- Sidebar has no settings link
- SystemConfig type removed from types/database.ts
</verification>

<success_criteria>
- The global standard unit config infrastructure is completely removed
- StandardUnitDisplay is a pure presentational component that renders unitName from props
- No code references useStandardUnitName hook (except downstream consumers that will be fixed in Plans 02/03)
- Database migration is ready to drop system_config table
</success_criteria>

<output>
After completion, create `.planning/phases/53-standard-unit-display-refactor/53-01-SUMMARY.md`
</output>
