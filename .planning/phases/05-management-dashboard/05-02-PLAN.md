---
phase: 05-management-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - app/(dashboard)/dashboard/components/status-bar.tsx
  - app/(dashboard)/dashboard/components/kpi-card.tsx
  - app/(dashboard)/dashboard/components/alert-list.tsx
  - app/(dashboard)/dashboard/components/activity-timeline.tsx
  - app/(dashboard)/dashboard/components/stock-timeline.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "StatusBar shows stacked horizontal bar with to_do/in_progress/done segments"
    - "KPICard displays total count with status breakdown bar"
    - "AlertList shows low stock items sorted by severity with colored badges"
    - "ActivityTimeline displays recent audit entries in timeline format"
    - "StockTimeline displays stock movements with in/out indicators"
  artifacts:
    - path: "app/(dashboard)/dashboard/components/status-bar.tsx"
      provides: "Stacked horizontal bar visualization"
      exports: ["StatusBar"]
    - path: "app/(dashboard)/dashboard/components/kpi-card.tsx"
      provides: "KPI card with status breakdown"
      exports: ["KPICard"]
    - path: "app/(dashboard)/dashboard/components/alert-list.tsx"
      provides: "Low stock alerts section"
      exports: ["AlertList"]
    - path: "app/(dashboard)/dashboard/components/activity-timeline.tsx"
      provides: "Audit log timeline"
      exports: ["ActivityTimeline"]
    - path: "app/(dashboard)/dashboard/components/stock-timeline.tsx"
      provides: "Inventory movements timeline"
      exports: ["StockTimeline"]
  key_links:
    - from: "kpi-card.tsx"
      to: "status-bar.tsx"
      via: "component composition"
      pattern: "import.*StatusBar"
    - from: "alert-list.tsx"
      to: "/item/[id]"
      via: "Link navigation"
      pattern: "href=.*item/"
---

<objective>
Build the dashboard UI components: status bar visualization, KPI cards, alert list, and timeline components for activity and stock movements.

Purpose: Create reusable, Linear-style dashboard components that display aggregated data clearly.
Output: 5 client components in dashboard/components directory.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/05-management-dashboard/05-CONTEXT.md
@.planning/phases/05-management-dashboard/05-RESEARCH.md
@.planning/phases/05-management-dashboard/05-01-SUMMARY.md
@lib/actions/dashboard.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StatusBar and KPICard components</name>
  <files>app/(dashboard)/dashboard/components/status-bar.tsx, app/(dashboard)/dashboard/components/kpi-card.tsx</files>
  <action>
1. Create `app/(dashboard)/dashboard/components/status-bar.tsx`:
   - 'use client' directive
   - Props: toDo, inProgress, done (numbers), onSegmentClick callback (optional)
   - Calculate total and percentages (handle total = 0 case)
   - Render:
     - Total count as hero number (text-3xl font-bold font-mono text-white)
     - Stacked bar using Tailwind flexbox:
       - Container: flex h-3 w-full overflow-hidden rounded-full bg-slate-800
       - Segments: bg-slate-500 (to_do), bg-blue-500 (in_progress), bg-green-500 (done)
       - Each segment: style={{ width: `${percent}%` }}, cursor-pointer, hover:brightness-110
       - Zero-count segments: thin outlined bar (w-0.5 border-slate-700)
       - title attribute for tooltip: "To Do: 5 (25%)"
       - onClick calls onSegmentClick with segment key
     - Legend below bar: flex gap-4 text-xs text-slate-400
       - Each legend item: colored dot (h-2 w-2 rounded-full) + label
   - Use RESEARCH.md StatusBar example as reference

2. Create `app/(dashboard)/dashboard/components/kpi-card.tsx`:
   - 'use client' directive
   - Props:
     - title: string (e.g., "QMRL Requests")
     - stats: { status_group: string; count: number }[]
     - href: string (where to navigate on click)
     - icon: LucideIcon (optional)
   - Convert stats array to toDo/inProgress/done counts
   - Render Linear-style card:
     - Container: rounded-xl border border-slate-800 bg-slate-900/50 p-6 cursor-pointer hover:border-slate-700 transition
     - Header: flex justify-between, title + icon
     - Body: StatusBar component with counts
     - Clicking card navigates to href (wrap in Link or use router.push)
   - Clicking segment navigates to href with status_group filter: `${href}?status_group=${group}`
  </action>
  <verify>
npm run type-check - no TypeScript errors.
Visual inspection: StatusBar has 3-segment horizontal bar with legend.
  </verify>
  <done>
StatusBar renders stacked bar with clickable segments. KPICard wraps StatusBar with title and navigation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AlertList component</name>
  <files>app/(dashboard)/dashboard/components/alert-list.tsx</files>
  <action>
Create `app/(dashboard)/dashboard/components/alert-list.tsx`:
- 'use client' directive
- Props:
  ```typescript
  interface AlertListProps {
    alerts: Array<{
      item_id: string;
      item_name: string;
      item_sku: string;
      warehouse_id: string;
      warehouse_name: string;
      current_stock: number;
      severity: 'out_of_stock' | 'critical' | 'warning';
    }>;
  }
  ```
- Import Link from next/link, AlertTriangle/AlertCircle from lucide-react

- Render:
  - Section header: "Low Stock Alerts" with count badge
    - Badge color: red if any critical/out_of_stock, amber otherwise
  - Empty state: "All items well stocked" with green checkmark icon
  - Alert list (show top 5):
    - Each row: Link to /item/[item_id]
    - Row styling: flex items-center gap-3 p-3 rounded-lg hover:bg-slate-800/50
    - Severity badge:
      - out_of_stock: bg-red-500/20 text-red-400 border-red-500/30, label "Out of Stock"
      - critical: bg-red-500/20 text-red-400, label "Critical"
      - warning: bg-amber-500/20 text-amber-400, label "Low"
    - Item info: item_name (font-medium) + warehouse_name (text-slate-500)
    - Stock count: right-aligned, font-mono
  - "View all X items" link if alerts.length > 5
    - href: /inventory?filter=low_stock
  </action>
  <verify>
npm run type-check - no TypeScript errors.
Component handles empty array gracefully with empty state.
  </verify>
  <done>
AlertList displays low stock items with severity badges, links to item details, handles empty state.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create ActivityTimeline and StockTimeline components</name>
  <files>app/(dashboard)/dashboard/components/activity-timeline.tsx, app/(dashboard)/dashboard/components/stock-timeline.tsx</files>
  <action>
1. Create `app/(dashboard)/dashboard/components/activity-timeline.tsx`:
   - 'use client' directive
   - Props:
     ```typescript
     interface ActivityTimelineProps {
       entries: Array<{
         id: string;
         action: string;
         entity_type: string;
         changes_summary: string | null;
         changed_by_name: string | null;
         changed_at: string;
       }>;
     }
     ```
   - Import formatDistanceToNow from date-fns
   - Import icons: Plus, Pencil, Trash2, CheckCircle, XCircle, User from lucide-react

   - Action icon mapping:
     - create: Plus (text-green-400)
     - update: Pencil (text-blue-400)
     - delete: Trash2 (text-red-400)
     - status_change: CheckCircle (text-amber-400)
     - void/cancel: XCircle (text-red-400)
     - default: User (text-slate-400)

   - Render timeline style:
     - Container: relative border-l border-slate-700 ml-3
     - Each entry: mb-4 ml-6
     - Circle on line: absolute -left-3 h-6 w-6 rounded-full bg-slate-800 ring-4 ring-slate-900, icon inside
     - Content card: rounded-lg border border-slate-800 bg-slate-900/50 p-3
       - Header: action label + entity_type, right-aligned time (formatDistanceToNow ago)
       - Body: changes_summary or "by {changed_by_name}"
   - Empty state: "No recent activity"

2. Create `app/(dashboard)/dashboard/components/stock-timeline.tsx`:
   - 'use client' directive
   - Props:
     ```typescript
     interface StockTimelineProps {
       movements: Array<{
         id: string;
         movement_type: 'inventory_in' | 'inventory_out';
         item_name: string | null;
         quantity: number;
         warehouse_name: string;
         transaction_date: string;
         created_by_name: string;
       }>;
     }
     ```
   - Import ArrowUpCircle, ArrowDownCircle from lucide-react
   - Import formatDistanceToNow from date-fns

   - Icon mapping:
     - inventory_in: ArrowUpCircle (text-green-400)
     - inventory_out: ArrowDownCircle (text-red-400)

   - Same timeline structure as ActivityTimeline
   - Content: +/- quantity, item_name, warehouse_name
   - Empty state: "No recent stock movements"
  </action>
  <verify>
npm run type-check - no TypeScript errors.
Both components render timeline with icons and handle empty state.
  </verify>
  <done>
ActivityTimeline renders audit entries with action icons. StockTimeline renders movements with in/out indicators. Both use date-fns for relative time.
  </done>
</task>

</tasks>

<verification>
1. All 5 components compile without TypeScript errors
2. StatusBar calculates percentages correctly including edge cases
3. AlertList handles empty array and shows proper empty state
4. Timeline components use date-fns formatDistanceToNow
5. All components use 'use client' directive
</verification>

<success_criteria>
- npm run type-check passes
- StatusBar shows stacked horizontal bar with legend
- KPICard wraps StatusBar and provides navigation
- AlertList shows severity badges and links to items
- Both timeline components render with icons and relative times
- Empty states handled in AlertList and timelines
</success_criteria>

<output>
After completion, create `.planning/phases/05-management-dashboard/05-02-SUMMARY.md`
</output>
