---
phase: 56-list-view-standardization
plan: 03
type: execute
wave: 2
depends_on: ["56-01"]
files_modified:
  - app/(dashboard)/inventory/stock-out-requests/page.tsx
autonomous: true
requirements:
  - LIST-06
  - PAGE-02

must_haves:
  truths:
    - "Stock-out requests list view shows columns: SOR ID, Item, Requester, Reason, QMHQ Ref, Status"
    - "Stock-out requests page has a FilterBar toolbar with search, status filter, requester filter (with avatar+name), and card/list toggle"
    - "Stock-out requests page has Pagination component with URL-driven state"
    - "Requester filter narrows results by requester_id"
    - "Changing any filter resets page to 1"
    - "Below md breakpoint, auto-switches to card view"
    - "Row clicks use router.push (not window.location.href)"
  artifacts:
    - path: "app/(dashboard)/inventory/stock-out-requests/page.tsx"
      provides: "Stock-out requests page with standardized FilterBar, card/list toggle, URL pagination, requester filter, LIST-06 columns"
      min_lines: 300
  key_links:
    - from: "app/(dashboard)/inventory/stock-out-requests/page.tsx"
      to: "lib/hooks/use-pagination-params.ts"
      via: "import usePaginationParams"
      pattern: "usePaginationParams"
    - from: "app/(dashboard)/inventory/stock-out-requests/page.tsx"
      to: "components/ui/pagination.tsx"
      via: "Pagination component"
      pattern: "Pagination"
    - from: "app/(dashboard)/inventory/stock-out-requests/page.tsx"
      to: "components/ui/user-avatar.tsx"
      via: "UserAvatar in requester filter dropdown"
      pattern: "UserAvatar"
---

<objective>
Standardize the stock-out requests page with the same toolbar, pagination, and filter patterns established in Plans 01-02. This page currently has a unique UI (status tabs, separate search bar, no pagination, different toggle style) that needs to be brought in line with the other 5 list pages.

Purpose: Complete the standardization across all 6 list pages. Stock-out requests is the most different from the standard pattern (uses status tabs instead of dropdown, has no pagination, and has a non-standard toggle). Bringing it in line ensures PAGE-01 and PAGE-02 are fully satisfied.

Output: Standardized stock-out requests page with FilterBar toolbar, URL-driven pagination, requester filter with avatars, LIST-06 columns, and responsive behavior.
</objective>

<execution_context>
@/home/yaungni/.claude/get-shit-done/workflows/execute-plan.md
@/home/yaungni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/56-list-view-standardization/56-CONTEXT.md
@.planning/phases/56-list-view-standardization/56-RESEARCH.md
@.planning/phases/56-list-view-standardization/56-01-SUMMARY.md
@app/(dashboard)/inventory/stock-out-requests/page.tsx
@components/stock-out-requests/request-card.tsx
@lib/hooks/use-pagination-params.ts
@components/ui/pagination.tsx
@components/ui/user-avatar.tsx
@components/composite/filter-bar.tsx
@components/ui/tooltip.tsx
@components/ui/popover.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace status tabs and search with standardized FilterBar, add URL pagination and requester filter</name>
  <files>app/(dashboard)/inventory/stock-out-requests/page.tsx</files>
  <action>
Rewrite the stock-out requests page to match the standardized pattern. Keep the existing data fetching, RequestCard component usage, and card/list view content. Make these changes:

**1. Replace status tabs with FilterBar dropdown:**
- Remove the `STATUS_TABS` array and the status tabs `<div>` block
- Remove the separate search bar + view toggle `<div>` block
- Add a `FilterBar` component with:
  - `FilterBar.Search` (same search functionality, searching by request number or requester)
  - Status filter as a raw Shadcn `Select` (to show colored dots):
    ```tsx
    <Select value={statusFilter} onValueChange={handleStatusChange}>
      <SelectTrigger className="w-[160px] bg-slate-800/50 border-slate-700">
        <SelectValue placeholder="Status" />
      </SelectTrigger>
      <SelectContent>
        <SelectItem value="all">All Statuses</SelectItem>
        <SelectItem value="pending">Pending</SelectItem>
        <SelectItem value="approved">Approved</SelectItem>
        <SelectItem value="rejected">Rejected</SelectItem>
        <SelectItem value="cancelled">Cancelled</SelectItem>
      </SelectContent>
    </Select>
    ```
  - Requester filter (assigned person equivalent) with avatar+name:
    ```tsx
    <Select value={requesterFilter} onValueChange={handleRequesterChange}>
      <SelectTrigger className="w-[180px] bg-slate-800/50 border-slate-700">
        <SelectValue placeholder="Requester" />
      </SelectTrigger>
      <SelectContent>
        <SelectItem value="all">All Requesters</SelectItem>
        {users.map((u) => (
          <SelectItem key={u.id} value={u.id}>
            <div className="flex items-center gap-2">
              <UserAvatar fullName={u.full_name} size={20} />
              <span>{u.full_name}</span>
            </div>
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
    ```
  - Card/list toggle (same style as other pages, `ml-auto`)
- Import `FilterBar` from `@/components/composite`
- Import `UserAvatar` from `@/components/ui/user-avatar`
- Import `Select, SelectContent, SelectItem, SelectTrigger, SelectValue` from `@/components/ui/select`
- Import `Pagination` from `@/components/ui/pagination`
- Import `usePaginationParams` from `@/lib/hooks`

**2. Add users state and fetch for requester filter:**
- Add state: `const [users, setUsers] = useState<{id: string; full_name: string}[]>([]);`
- Add `requesterFilter` state: `const [requesterFilter, setRequesterFilter] = useState<string>("all");`
- Fetch users in the fetchRequests function:
  ```typescript
  const [requestsRes, usersRes] = await Promise.all([
    // existing stock_out_requests query...
    supabase.from("users").select("id, full_name").eq("is_active", true).order("full_name"),
  ]);
  ```
- Set users state from response

**3. Replace pagination state with `usePaginationParams(20)`:**
- Currently there is NO pagination at all on this page (fetches everything, no limit). Add it.
- Use `usePaginationParams(20)` for URL-driven pagination
- Add client-side pagination (slice filteredRequests):
  ```typescript
  const totalItems = filteredRequests.length;
  const totalPages = Math.ceil(totalItems / pageSize);
  const paginatedRequests = useMemo(() => {
    const start = (currentPage - 1) * pageSize;
    return filteredRequests.slice(start, start + pageSize);
  }, [filteredRequests, currentPage, pageSize]);
  ```
- Use `paginatedRequests` instead of `filteredRequests` for both card and list views
- Add `Pagination` component at the bottom (same pattern as other pages)

**4. Add filter change handlers that reset page:**
```typescript
const handleSearchChange = (value: string) => { setSearchQuery(value); setCurrentPage(1); };
const handleStatusChange = (value: string) => { setStatusFilter(value); setCurrentPage(1); };
const handleRequesterChange = (value: string) => { setRequesterFilter(value); setCurrentPage(1); };
```
Remove the old useEffect that resets page (if any -- currently there isn't one since there's no pagination).

**5. Add requester filter logic:**
```typescript
if (requesterFilter !== "all" && request.requester_id !== requesterFilter) return false;
```

**6. Update card view to use paginatedRequests:**
- The `groupedRequests` useMemo should group `paginatedRequests` (not `filteredRequests`)
- Keep existing `RequestCard` component usage

**7. Update list view columns to match LIST-06:**
Required: SOR ID, Item, Requester, Reason, QMHQ Ref, Status
Current: Request#, Requester, Reason, Items, Status, Created

Changes needed:
- Add QMHQ Ref column:
  ```tsx
  <td className="py-3 px-4">
    {request.qmhq ? (
      <code className="text-amber-400 text-sm">{request.qmhq.request_id}</code>
    ) : (
      <span className="text-slate-500">-</span>
    )}
  </td>
  ```
- "Items" column â†’ rename header to "Item" and keep the `N item(s)` pattern or show first item name
- Keep "Created" column (additional context, not contradicting LIST-06)
- Status badge: colored background + white text. Use a mapping for stock-out statuses:
  ```typescript
  const SOR_STATUS_COLORS: Record<string, string> = {
    pending: "#f59e0b",
    partially_approved: "#8b5cf6",
    approved: "#3b82f6",
    partially_executed: "#a855f7",
    executed: "#10b981",
    rejected: "#ef4444",
    cancelled: "#94a3b8",
  };
  ```
  Then: `<Badge className="text-xs text-white" style={{ backgroundColor: SOR_STATUS_COLORS[request.status] || "#94a3b8", border: "none" }}>{request.status}</Badge>`

**8. Replace `window.location.href` with `router.push` in list view row click:**
- Import `useRouter` from `next/navigation`
- `onClick={() => router.push(`/inventory/stock-out-requests/${request.id}`)}`

**9. Update list view table styling to match standard pattern:**
- Use `command-panel` wrapper (currently uses `bg-slate-900/50 border border-slate-800`)
- Use standard `<thead>` with `border-b border-slate-700` (currently uses `bg-slate-800/50 border-b border-slate-700`)
- Use standard row classes: `border-b border-slate-700/50 hover:bg-slate-800/30 transition-colors cursor-pointer`

**10. Add responsive behavior:**
- Auto-switch to card view below md breakpoint
- Filter collapse to Popover button on narrow screens
- Import Popover components and SlidersHorizontal

**11. Update the PageHeader:**
- Move toggle OUT of the separate search/toggle bar and INTO FilterBar
- Keep "New Request" button in PageHeader.actions (with permission check)
- Remove the old padding `p-8` wrapper (other pages don't have it -- check if the dashboard layout provides padding)

**12. Default view is card (per user decision):**
- `const [viewMode, setViewMode] = useState<"card" | "list">("card");` (already exists)

**13. Remove `statusCounts` useMemo** since status tabs are removed. The count badge is no longer needed in the toolbar. (The FilterBar status filter is simpler.)
  </action>
  <verify>
1. Run `npx tsc --noEmit` to confirm no TypeScript errors.
2. Run `npm run build` to verify the page builds.
3. Test at `/inventory/stock-out-requests`:
   - FilterBar toolbar replaces old status tabs and search bar
   - Status filter dropdown works (replaces tabs)
   - Requester filter shows avatar+name in dropdown
   - Card/list toggle works (default: card)
   - List view shows SOR ID, Item, Requester, Reason, QMHQ Ref, Status columns
   - URL-driven pagination works (?page=N&pageSize=N)
   - Pagination component appears at bottom
   - Filter changes reset page to 1
   - Row clicks use router.push (no full page reload)
   - Status badges have colored background + white text
   - Responsive: auto-switch to card below 768px, filters collapse
  </verify>
  <done>Stock-out requests page uses standardized FilterBar with search, status dropdown, requester filter (avatar+name), and card/list toggle. List view shows LIST-06 columns (SOR ID, Item, Requester, Reason, QMHQ Ref, Status). URL-driven pagination works. Responsive auto-switch and filter collapse implemented. All row clicks use router.push.</done>
</task>

<task type="auto">
  <name>Task 2: Final cross-page verification and build check</name>
  <files>app/(dashboard)/qmrl/page.tsx, app/(dashboard)/qmhq/page.tsx, app/(dashboard)/po/page.tsx, app/(dashboard)/invoice/page.tsx, app/(dashboard)/item/page.tsx, app/(dashboard)/inventory/stock-out-requests/page.tsx</files>
  <action>
Run a final verification across ALL 6 list pages to ensure consistency:

1. **TypeScript check:** `npx tsc --noEmit` must pass with zero errors.

2. **Build check:** `npm run build` must complete successfully.

3. **Verify each page imports `usePaginationParams`:**
   All 6 pages must import from `@/lib/hooks` or `@/lib/hooks/use-pagination-params`.

4. **Verify no `window.location.href` remains in any list page:**
   Search all 6 files for `window.location.href` -- it should not exist. All row navigation should use `router.push`.

5. **Verify no `useState` for `currentPage` or `pageSize` remains:**
   Search all 6 files -- pagination state should come from `usePaginationParams` only.

6. **Verify Pagination component is present on all 6 pages:**
   Each file should render `<Pagination ... />` at the bottom.

7. **Verify card/list toggle is inside FilterBar on all 6 pages:**
   Each file should have the toggle with `ml-auto` inside the FilterBar, NOT in PageHeader.actions.

8. **Verify responsive auto-switch useEffect exists on all 6 pages:**
   Each file should have `window.innerWidth < 768` check that sets viewMode to card.

If any of these checks fail, fix the issue in the relevant file. This task is a quality gate -- it should be quick if Plans 01-03 executed correctly.
  </action>
  <verify>
1. `npx tsc --noEmit` passes.
2. `npm run build` succeeds.
3. Grep all 6 page files for `usePaginationParams` -- all 6 must match.
4. Grep all 6 page files for `window.location.href` -- zero matches expected.
5. Grep all 6 page files for `useState.*currentPage` -- zero matches expected (usePaginationParams replaces it).
  </verify>
  <done>All 6 list pages pass TypeScript, build, and consistency checks. Every page uses usePaginationParams, Pagination component, router.push for navigation, FilterBar with toggle, and responsive behavior.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- `npm run build` completes successfully
- Stock-out requests page has standardized FilterBar (no more status tabs)
- Stock-out requests list view columns match LIST-06
- Stock-out requests page has Pagination component with URL params
- Requester filter narrows results correctly
- All 6 list pages are consistent: FilterBar toolbar, URL pagination, responsive behavior
- No `window.location.href` in any list page
- No `useState` for pagination in any list page
</verification>

<success_criteria>
- Stock-out requests page fully standardized with FilterBar, URL pagination, requester filter, LIST-06 columns
- All 6 list pages pass the cross-page consistency checks
- Build succeeds, TypeScript passes
- PAGE-01 (shared Pagination), PAGE-02 (assigned person filter on all applicable pages), PAGE-03 (filter resets page) are all satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/56-list-view-standardization/56-03-SUMMARY.md`
</output>
