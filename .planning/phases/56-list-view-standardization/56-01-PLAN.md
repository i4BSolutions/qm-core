---
phase: 56-list-view-standardization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/hooks/use-pagination-params.ts
  - lib/hooks/index.ts
  - app/(dashboard)/qmrl/page.tsx
autonomous: true
requirements:
  - LIST-01
  - PAGE-01
  - PAGE-03
  - AVTR-03

must_haves:
  truths:
    - "QMRL page has a card/list toggle; default is card view"
    - "QMRL list view shows columns: ID, Title, Status, Assigned Person (avatar only with tooltip), Request Date"
    - "Pagination on QMRL is URL-driven (?page=N&pageSize=N); back button navigates page history"
    - "Changing any filter on QMRL resets the URL page param to 1"
    - "User avatar chips appear next to assigned person in QMRL list view rows"
    - "Below md breakpoint, QMRL auto-switches to card view"
    - "Filters collapse to a Filters button on narrow screens"
  artifacts:
    - path: "lib/hooks/use-pagination-params.ts"
      provides: "URL-driven pagination hook reading/writing ?page=N&pageSize=N"
      exports: ["usePaginationParams"]
    - path: "lib/hooks/index.ts"
      provides: "Barrel export including usePaginationParams"
      contains: "usePaginationParams"
    - path: "app/(dashboard)/qmrl/page.tsx"
      provides: "QMRL list page with card/list toggle, list view table, URL pagination, assigned person filter with avatar, responsive behavior"
      min_lines: 300
  key_links:
    - from: "app/(dashboard)/qmrl/page.tsx"
      to: "lib/hooks/use-pagination-params.ts"
      via: "import and call usePaginationParams(20)"
      pattern: "usePaginationParams"
    - from: "app/(dashboard)/qmrl/page.tsx"
      to: "components/ui/user-avatar.tsx"
      via: "UserAvatar in list view assigned column"
      pattern: "UserAvatar"
    - from: "app/(dashboard)/qmrl/page.tsx"
      to: "components/ui/pagination.tsx"
      via: "Pagination component wired to URL params"
      pattern: "Pagination"
---

<objective>
Create the shared URL-driven pagination hook and transform the QMRL page into the reference implementation for Phase 56's standardized list view pattern.

Purpose: QMRL is the first page to receive the full standardization treatment (card/list toggle, URL-driven pagination, assigned person filter with avatar, responsive collapse). It becomes the template that Plans 02 and 03 replicate on other pages.

Output: `usePaginationParams` hook in `lib/hooks/`, updated QMRL page with list view, card/list toggle in toolbar, URL-driven pagination, responsive auto-switch and filter collapse.
</objective>

<execution_context>
@/home/yaungni/.claude/get-shit-done/workflows/execute-plan.md
@/home/yaungni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/56-list-view-standardization/56-CONTEXT.md
@.planning/phases/56-list-view-standardization/56-RESEARCH.md
@lib/hooks/index.ts
@lib/hooks/use-pagination-params.ts
@app/(dashboard)/qmrl/page.tsx
@components/ui/pagination.tsx
@components/ui/user-avatar.tsx
@components/composite/filter-bar.tsx
@components/ui/tooltip.tsx
@components/ui/badge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create usePaginationParams hook and export from barrel</name>
  <files>lib/hooks/use-pagination-params.ts, lib/hooks/index.ts</files>
  <action>
Create `lib/hooks/use-pagination-params.ts` with:

```typescript
"use client";

import { useCallback } from "react";
import { useRouter, useSearchParams } from "next/navigation";

interface PaginationParams {
  page: number;
  pageSize: number;
  setPage: (page: number) => void;
  setPageSize: (size: number) => void;
}

export function usePaginationParams(defaultPageSize = 20): PaginationParams {
  const router = useRouter();
  const searchParams = useSearchParams();

  const page = Math.max(1, parseInt(searchParams.get("page") || "1", 10));
  const pageSize = parseInt(
    searchParams.get("pageSize") || String(defaultPageSize),
    10
  );

  const updateParams = useCallback(
    (updates: Record<string, string>) => {
      const params = new URLSearchParams(searchParams.toString());
      Object.entries(updates).forEach(([key, value]) => {
        params.set(key, value);
      });
      router.push(`?${params.toString()}`, { scroll: false });
    },
    [router, searchParams]
  );

  const setPage = useCallback(
    (p: number) => updateParams({ page: String(p) }),
    [updateParams]
  );

  const setPageSize = useCallback(
    (size: number) => updateParams({ page: "1", pageSize: String(size) }),
    [updateParams]
  );

  return { page, pageSize, setPage, setPageSize };
}
```

Then update `lib/hooks/index.ts` to add the new export:
```typescript
export { usePaginationParams } from "./use-pagination-params";
```

This hook reads `?page=N&pageSize=N` from the URL, returns current values, and exposes setters that push URL updates via `router.push`. `setPageSize` automatically resets to page 1. Default page size is 20 (matching existing QMRL default).
  </action>
  <verify>Run `npx tsc --noEmit` to confirm no TypeScript errors. Verify the hook file exists and exports `usePaginationParams`. Verify `lib/hooks/index.ts` exports the new hook.</verify>
  <done>The `usePaginationParams` hook exists at `lib/hooks/use-pagination-params.ts`, is exported from the hooks barrel file, and compiles without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Add list view, card/list toggle, URL pagination, and responsive behavior to QMRL page</name>
  <files>app/(dashboard)/qmrl/page.tsx</files>
  <action>
Rewrite `app/(dashboard)/qmrl/page.tsx` to add the standardized list view pattern. Keep ALL existing card view code and data fetching logic. Add the following changes:

**1. Replace pagination state with URL-driven hook:**
- Remove `useState` for `currentPage` and `pageSize`
- Remove the `handlePageSizeChange` function
- Remove the `useEffect` that resets page on filter change
- Import and use `usePaginationParams` from `@/lib/hooks`:
  ```typescript
  const { page: currentPage, pageSize, setPage: setCurrentPage, setPageSize } = usePaginationParams(20);
  ```
- Wire `Pagination` component to: `onPageChange={setCurrentPage}` and `onPageSizeChange={setPageSize}`
- On each filter change handler, call `setCurrentPage(1)` to reset URL page to 1. Wrap filter setters:
  ```typescript
  const handleSearchChange = (value: string) => { setSearchQuery(value); setCurrentPage(1); };
  const handleCategoryChange = (value: string) => { setCategoryFilter(value); setCurrentPage(1); };
  const handleAssignedChange = (value: string) => { setAssignedFilter(value); setCurrentPage(1); };
  ```

**2. Add viewMode state and card/list toggle:**
- Add `const [viewMode, setViewMode] = useState<"card" | "list">("card");` (default card per user decision, no persistence)
- Move the toggle INTO the `FilterBar` as the last child using `ml-auto`:
  ```tsx
  <div className="ml-auto flex items-center border border-slate-700 rounded-lg overflow-hidden">
    <button onClick={() => setViewMode("card")}
      className={viewMode === "card" ? "p-2 bg-amber-500/20 text-amber-400" : "p-2 bg-slate-800/50 text-slate-400 hover:text-slate-200"}>
      <LayoutGrid className="h-4 w-4" />
    </button>
    <button onClick={() => setViewMode("list")}
      className={viewMode === "list" ? "p-2 bg-amber-500/20 text-amber-400" : "p-2 bg-slate-800/50 text-slate-400 hover:text-slate-200"}>
      <List className="h-4 w-4" />
    </button>
  </div>
  ```
- Import `LayoutGrid, List` from `lucide-react`
- Import `useRouter` from `next/navigation` for row clicks

**3. Add responsive auto-switch to card view below md breakpoint:**
```typescript
useEffect(() => {
  const checkBreakpoint = () => {
    if (window.innerWidth < 768) setViewMode("card");
  };
  checkBreakpoint();
  window.addEventListener("resize", checkBreakpoint);
  return () => window.removeEventListener("resize", checkBreakpoint);
}, []);
```

**4. Add responsive filter collapse:**
- Wrap the filter dropdowns (Assigned Person and Category selects) in `<div className="hidden md:flex items-center gap-4">...</div>`
- Add a mobile-only Filters button that opens a Popover:
  ```tsx
  <div className="flex md:hidden">
    <Popover>
      <PopoverTrigger asChild>
        <Button variant="outline" size="sm" className="border-slate-700">
          <SlidersHorizontal className="h-4 w-4 mr-2" />
          Filters {activeFilterCount > 0 && `(${activeFilterCount})`}
        </Button>
      </PopoverTrigger>
      <PopoverContent className="w-64 space-y-3" align="start">
        {/* Assigned Person select and Category select rendered here for mobile */}
      </PopoverContent>
    </Popover>
  </div>
  ```
- Compute `activeFilterCount` from non-"all" filter values
- Import `Popover, PopoverTrigger, PopoverContent` from `@/components/ui/popover`
- Import `SlidersHorizontal` from `lucide-react`

**5. Upgrade assigned person filter to use avatar + name:**
- Replace the `FilterBar.Select` for assignee with a raw Shadcn `Select` (because FilterBar.Select only supports string labels, not JSX):
  ```tsx
  <Select value={assignedFilter} onValueChange={handleAssignedChange}>
    <SelectTrigger className="w-[180px] bg-slate-800/50 border-slate-700">
      <SelectValue placeholder="Assignee" />
    </SelectTrigger>
    <SelectContent>
      <SelectItem value="all">All Assignees</SelectItem>
      {users.map((u) => (
        <SelectItem key={u.id} value={u.id}>
          <div className="flex items-center gap-2">
            <UserAvatar fullName={u.full_name} size={20} />
            <span>{u.full_name}</span>
          </div>
        </SelectItem>
      ))}
    </SelectContent>
  </Select>
  ```
- Import `Select, SelectContent, SelectItem, SelectTrigger, SelectValue` from `@/components/ui/select`

**6. Build the list view table (shown when viewMode === "list"):**
- Wrap in `{viewMode === "list" && (...)}` conditional
- Show card view in `{viewMode === "card" && (...)}` conditional (existing CardViewGrid code)
- Columns per LIST-01: ID, Title, Status, Assigned Person, Request Date
- Use `router.push()` for row clicks (NOT `window.location.href`)
- Status badge: colored BACKGROUND + white text (per user decision):
  ```tsx
  <Badge className="text-xs text-white" style={{ backgroundColor: qmrl.status.color || "#94a3b8", border: "none" }}>
    {qmrl.status.name}
  </Badge>
  ```
- Assigned person: avatar only + Tooltip for name:
  ```tsx
  <Tooltip>
    <TooltipTrigger asChild>
      <span className="inline-flex cursor-default">
        <UserAvatar fullName={qmrl.assigned_user.full_name} size={28} />
      </span>
    </TooltipTrigger>
    <TooltipContent>{qmrl.assigned_user.full_name}</TooltipContent>
  </Tooltip>
  ```
- Wrap avatar cells with `TooltipProvider` at an appropriate scope
- Title cell: `truncate block max-w-xs` for text overflow with ellipsis
- Table structure matches existing codebase pattern:
  ```html
  <div className="command-panel">
    <div className="overflow-x-auto">
      <table className="w-full">
        <thead><tr className="border-b border-slate-700">...</tr></thead>
        <tbody>...</tbody>
      </table>
    </div>
  </div>
  ```
- Row: `className="border-b border-slate-700/50 hover:bg-slate-800/30 transition-colors cursor-pointer"`
- Empty state: colspan row with "No requests found"

**7. Toolbar order (per user decision):**
Per the locked decision, filter order follows: Search | Status | Assigned Person | Category | ... | Toggle. Since QMRL has no status filter dropdown (it uses Kanban columns for status grouping), the QMRL toolbar is:
Search | Assigned Person | Category | [toggle]

The toggle is inside FilterBar, pushed right with `ml-auto`.
  </action>
  <verify>
1. Run `npx tsc --noEmit` to confirm no TypeScript errors.
2. Run `npm run build` to verify the page builds without errors.
3. Open `http://localhost:3000/qmrl` and confirm:
   - Default view is card (Kanban)
   - Toggle switches to list view with correct columns
   - URL shows `?page=1&pageSize=20` (or no params for defaults)
   - Clicking page 2 updates URL to `?page=2`
   - Back button returns to previous page
   - Changing a filter resets to page 1
   - Assigned person filter shows avatar + name in dropdown
   - List view shows avatar-only in Assigned column with tooltip on hover
   - Status badges in list view have colored background + white text
   - Below 768px width, page switches to card view
   - Filters collapse to button on narrow screens
  </verify>
  <done>QMRL page shows card/list toggle defaulting to card view. List view has ID, Title, Status (colored badge), Assigned Person (avatar with tooltip), and Request Date columns. Pagination is URL-driven. Filters reset page to 1. Responsive auto-switch and filter collapse work. All row clicks use router.push.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- `npm run build` completes successfully
- QMRL page at `/qmrl` shows card view by default with card/list toggle in toolbar
- List view shows 5 columns: ID, Title, Status, Assigned, Date
- URL params update on page change (`?page=2`)
- Back button navigates correctly between pages
- Status badges in list view use colored background + white text
- Avatar tooltip shows full name on hover
- Page resets to 1 when any filter changes
- Below md breakpoint, auto-switches to card view
- Filter dropdowns collapse to button on narrow screens
</verification>

<success_criteria>
- `usePaginationParams` hook exists and is exported from hooks barrel
- QMRL page has card/list toggle (default: card) inside the FilterBar toolbar
- QMRL list view shows correct 5 columns with proper styling
- URL-driven pagination works end-to-end (bookmarkable, back button)
- Assigned person filter shows avatar + name per option
- Assigned person column shows avatar-only with tooltip
- Page resets to 1 on any filter change
- Responsive behavior: auto-switch to card below 768px, filters collapse to button
</success_criteria>

<output>
After completion, create `.planning/phases/56-list-view-standardization/56-01-SUMMARY.md`
</output>
