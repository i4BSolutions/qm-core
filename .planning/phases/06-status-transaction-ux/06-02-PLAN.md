---
phase: 06-status-transaction-ux
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/qmhq/transaction-view-modal.tsx
  - app/(dashboard)/qmhq/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can click View button on transaction row to open modal"
    - "Modal displays transaction type as title (Money In or Money Out)"
    - "Modal shows amount, currency, exchange rate, EUSD, date, notes"
    - "Modal is view-only with no editable fields"
    - "Modal closes via X button or clicking outside"
  artifacts:
    - path: "components/qmhq/transaction-view-modal.tsx"
      provides: "View-only transaction detail modal"
      exports: ["TransactionViewModal"]
  key_links:
    - from: "app/(dashboard)/qmhq/[id]/page.tsx"
      to: "components/qmhq/transaction-view-modal.tsx"
      via: "import and render with transaction data"
      pattern: "TransactionViewModal"
---

<objective>
Build view-only transaction detail modal for QMHQ financial transactions.

Purpose: Users can view full transaction details without navigating away, with clear read-only presentation for audit integrity.
Output: TransactionViewModal component integrated into QMHQ detail page transactions tab.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-status-transaction-ux/06-CONTEXT.md
@.planning/phases/06-status-transaction-ux/06-RESEARCH.md

@components/ui/dialog.tsx
@components/ui/label.tsx
@components/qmhq/transaction-dialog.tsx
@app/(dashboard)/qmhq/[id]/page.tsx
@lib/utils.ts
@types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TransactionViewModal component</name>
  <files>
    components/qmhq/transaction-view-modal.tsx
  </files>
  <action>
Create a view-only modal for displaying transaction details in the existing `components/qmhq/` directory:

**TransactionViewModal** Props:
```typescript
interface TransactionViewModalProps {
  transaction: FinancialTransaction & {
    created_by_user?: { full_name: string } | null;
  } | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
}
```

**Modal Structure:**
- Use Dialog from `@/components/ui/dialog`
- DialogContent with `className="sm:max-w-[500px]"` (medium width per CONTEXT.md)
- DialogHeader with DialogTitle showing transaction type:
  - "Money In" for `transaction_type === 'money_in'`
  - "Money Out" for `transaction_type === 'money_out'`

**Display Fields (all read-only, no inputs):**
1. **Amount** (prominent display):
   - Large text: `formatCurrency(transaction.amount) {transaction.currency}`
   - Smaller subtitle: `formatCurrency(transaction.amount_eusd) EUSD`
   - Use color coding: emerald for money_in, amber for money_out

2. **Exchange Rate**:
   - Label: "Exchange Rate"
   - Value: `transaction.exchange_rate.toFixed(4)` in monospace font

3. **Transaction Date**:
   - Label: "Date"
   - Value: Format using `format(new Date(transaction.transaction_date), 'dd/MM/yyyy')` from date-fns
   - This matches CONTEXT.md requirement: "Display format: DD/MM/YYYY"

4. **Transaction ID**:
   - Label: "Transaction ID"
   - Value: `transaction.transaction_id` in monospace font

5. **QMHQ Reference** (text only, no navigation link per CONTEXT.md):
   - Label: "QMHQ"
   - Value: `transaction.qmhq_id` as text

6. **Notes** (if present):
   - Label: "Notes"
   - Value: `transaction.notes` with `whitespace-pre-wrap`

7. **Created By** (if present):
   - Label: "Recorded By"
   - Value: `transaction.created_by_user?.full_name`

**Styling:**
- Match dark theme from existing dialogs (bg-slate-900, text-slate-200)
- Use Label component for field labels with `text-slate-400`
- Amount section has colored background matching transaction type
- DialogFooter with single "Close" button

**Import date-fns format function** for date formatting (already used in codebase).

Return null if transaction is null (safety check).
  </action>
  <verify>
- `npm run type-check` passes
- File exists: `components/qmhq/transaction-view-modal.tsx`
- Exports `TransactionViewModal`
  </verify>
  <done>
- TransactionViewModal renders all transaction fields in read-only format
- Modal matches dark theme styling
- Date format matches DD/MM/YYYY requirement
  </done>
</task>

<task type="auto">
  <name>Task 2: Add View button and integrate modal into QMHQ transactions tab</name>
  <files>
    app/(dashboard)/qmhq/[id]/page.tsx
  </files>
  <action>
Modify the QMHQ detail page to add View buttons and integrate the modal:

1. **Import the new component:**
   ```typescript
   import { TransactionViewModal } from "@/components/qmhq/transaction-view-modal";
   ```

2. **Add state for modal and selected transaction:**
   ```typescript
   const [viewingTransaction, setViewingTransaction] = useState<FinancialTransactionWithUser | null>(null);
   const [isViewModalOpen, setIsViewModalOpen] = useState(false);
   ```

3. **Add View button to each transaction row** (in Transactions tab, around line 656-728):
   - Find the transaction row div that maps over `transactions`
   - Add a View button in the row (right side, near the amount):
   ```tsx
   <Button
     variant="ghost"
     size="sm"
     onClick={() => {
       setViewingTransaction(tx);
       setIsViewModalOpen(true);
     }}
     className="text-slate-400 hover:text-slate-200"
   >
     View
   </Button>
   ```
   - Position it after the amount display, before the meta info line

4. **Add the modal component** at the end of the component (after the existing TransactionDialog):
   ```tsx
   <TransactionViewModal
     transaction={viewingTransaction}
     open={isViewModalOpen}
     onOpenChange={setIsViewModalOpen}
   />
   ```

5. **Import Eye icon from lucide-react** if you want to add an icon to the View button (optional).

Note: Per CONTEXT.md, the View button is an explicit action - NOT row click. This is important for UX clarity.
  </action>
  <verify>
- `npm run build` succeeds
- Navigate to `/qmhq/[id]` with expense or PO route type
- Go to Transactions tab
- Each transaction row shows a "View" button
- Clicking View opens the modal with transaction details
- Modal shows all fields in read-only format
- Modal closes with X button or clicking outside
  </verify>
  <done>
- View button appears on each transaction row
- Clicking View opens TransactionViewModal
- Modal displays all transaction details in read-only format
- Modal closes properly via X or outside click
  </done>
</task>

</tasks>

<verification>
1. Navigate to QMHQ detail page with expense or PO route (`/qmhq/[id]`)
2. Go to Transactions tab
3. Verify each transaction row has a "View" button
4. Click View on a Money In transaction
5. Verify modal opens with title "Money In"
6. Verify amount shows in emerald color with EUSD subtitle
7. Verify date format is DD/MM/YYYY
8. Verify exchange rate shows 4 decimal places
9. Close modal by clicking X
10. Click View on a Money Out transaction
11. Verify modal opens with title "Money Out"
12. Verify amount shows in amber color
13. Close modal by clicking outside
14. Verify no fields are editable (all display-only)
</verification>

<success_criteria>
- View button appears on transaction rows (not row click)
- Modal opens with correct transaction type title
- Amount displayed prominently with local currency and EUSD
- Exchange rate shows 4 decimal places
- Date format matches DD/MM/YYYY
- Notes display with line breaks preserved
- Modal is view-only (no edit fields)
- Modal closes via X button or outside click
</success_criteria>

<output>
After completion, create `.planning/phases/06-status-transaction-ux/06-02-SUMMARY.md`
</output>
