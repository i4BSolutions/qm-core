---
phase: 10-inventory-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - app/(dashboard)/inventory/page.tsx
  - app/(dashboard)/inventory/components/filter-popover.tsx
  - app/(dashboard)/inventory/components/filter-chips.tsx
autonomous: true

must_haves:
  truths:
    - "User can filter transactions by date range"
    - "User can filter transactions by warehouse"
    - "User can filter transactions by item (searchable)"
    - "Active filters shown as removable chips below filter button"
    - "Filters persist across page visits via URL"
    - "KPIs update when filters change"
  artifacts:
    - path: "app/(dashboard)/inventory/components/filter-popover.tsx"
      provides: "Filter popover with date range, warehouse, and item selection"
      min_lines: 100
    - path: "app/(dashboard)/inventory/components/filter-chips.tsx"
      provides: "Active filter chips with remove functionality"
      min_lines: 40
    - path: "app/(dashboard)/inventory/page.tsx"
      provides: "Updated page with filter integration"
      contains: "FilterPopover"
  key_links:
    - from: "app/(dashboard)/inventory/page.tsx"
      to: "filter-popover.tsx"
      via: "Component import and usage"
      pattern: "FilterPopover"
    - from: "app/(dashboard)/inventory/page.tsx"
      to: "filter-chips.tsx"
      via: "Component import and usage"
      pattern: "FilterChips"
    - from: "filter-popover.tsx"
      to: "URL search params"
      via: "useSearchParams + useRouter"
      pattern: "useSearchParams|updateFilter"
---

<objective>
Add filter system to inventory dashboard with date range, warehouse, item selection, and filter chips.

Purpose: Users can narrow down transaction view using filters. Filters persist in URL for shareability and page refresh persistence. KPIs dynamically update to reflect filtered data.

Output:
- Filter popover component with date range picker, warehouse select, item search
- Filter chips component showing active filters with remove buttons
- Updated dashboard page integrating filters with KPI and table updates
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-inventory-dashboard/10-CONTEXT.md
@.planning/phases/10-inventory-dashboard/10-RESEARCH.md
@.planning/phases/10-inventory-dashboard/10-01-SUMMARY.md
@app/(dashboard)/inventory/page.tsx
@components/ui/popover.tsx
@components/ui/date-picker.tsx
@components/ui/select.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create filter popover component</name>
  <files>app/(dashboard)/inventory/components/filter-popover.tsx</files>
  <action>
Create a filter popover component that contains all filter controls.

**Component structure:**
```tsx
interface FilterPopoverProps {
  warehouses: { id: string; name: string }[];
  items: { id: string; name: string; sku: string }[];
  currentFilters: {
    fromDate?: string;
    toDate?: string;
    warehouseId?: string;
    itemId?: string;
  };
  onFiltersChange: (filters: FilterPopoverProps['currentFilters']) => void;
}
```

**UI layout inside popover:**
1. **Date Range section**
   - Label: "Date Range"
   - Two DatePicker components (From, To)
   - From picker: maxDate = toDate value if set
   - To picker: minDate = fromDate value if set
   - Use existing DatePicker from components/ui/date-picker.tsx

2. **Warehouse section**
   - Label: "Warehouse"
   - Select dropdown with warehouses
   - "All Warehouses" as default/clear option
   - Use existing Select from components/ui/select.tsx

3. **Item section**
   - Label: "Item"
   - Searchable select/combobox
   - Type to filter items by name
   - Show item name + SKU in options
   - "All Items" as default/clear option
   - Use Input with filtered dropdown list pattern (or existing combobox if available)

4. **Actions row**
   - "Apply" button - calls onFiltersChange with current values
   - "Clear All" link - resets all filter values

**Trigger button:**
- Icon: Filter (lucide-react)
- Text: "Filters"
- Show badge with count of active filters (e.g., "Filters (2)")

**Styling:**
- Popover width: 320px
- Use existing Popover from components/ui/popover.tsx
- Sections separated by dividers
- Labels: text-sm text-slate-400
  </action>
  <verify>
Component file exists and exports FilterPopover.
TypeScript compiles: `npm run type-check`
  </verify>
  <done>
FilterPopover component created with date range, warehouse, and item filters.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create filter chips component</name>
  <files>app/(dashboard)/inventory/components/filter-chips.tsx</files>
  <action>
Create a component that displays active filters as removable chips.

**Component structure:**
```tsx
interface FilterChip {
  key: string;      // Filter key (e.g., 'fromDate', 'warehouseId')
  label: string;    // Display label (e.g., 'From: 01/01/2026')
}

interface FilterChipsProps {
  chips: FilterChip[];
  onRemove: (key: string) => void;
  onClearAll: () => void;
}
```

**UI:**
- Horizontal flex wrap container
- Each chip shows label + X button
- Chip styling: amber accent (border-amber-500/30, bg-amber-500/10, text-amber-400)
- X button: hover:text-amber-300
- "Clear all" link at end when chips exist
- Return null if no chips (empty array)

**Chip generation logic (in parent page):**
Map current filters to chip labels:
- fromDate: "From: DD/MM/YYYY"
- toDate: "To: DD/MM/YYYY"
- warehouseId: "Warehouse: {name}"
- itemId: "Item: {name}"

Only create chips for filters that have values.
  </action>
  <verify>
Component file exists and exports FilterChips.
TypeScript compiles: `npm run type-check`
  </verify>
  <done>
FilterChips component created with proper styling and remove functionality.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate filters into dashboard page</name>
  <files>app/(dashboard)/inventory/page.tsx</files>
  <action>
Update the inventory dashboard page to integrate filters with URL persistence.

**URL search params for filters:**
- `from` - ISO date string (YYYY-MM-DD)
- `to` - ISO date string (YYYY-MM-DD)
- `warehouse` - warehouse UUID
- `item` - item UUID
- `tab` - all | in | out (from Plan 01)
- `page` - page number

**Data fetching updates:**
1. Fetch warehouse list and item list on mount (for filter dropdowns)
2. Pass filter params to getInventoryKPIs and getInventoryTransactions
3. Re-fetch when any filter changes

**Filter state flow:**
1. Read initial filter values from URL on mount
2. When user applies filters in popover, update URL params
3. URL change triggers data re-fetch via useEffect
4. KPIs and table update with filtered data

**Tab counts update:**
When filters are active, tab counts should reflect filtered totals:
- All tab: stock_in_count + stock_out_count from KPIs
- Stock In tab: stock_in_count from KPIs
- Stock Out tab: stock_out_count from KPIs

**Page reset on filter change:**
Reset currentPage to 1 when filters change (add filters to the useEffect dependency that resets page).

**Layout update:**
Add filter bar between header and KPIs:
```
[Filters button]  [FilterChips row if active]
```

**KPI card click behavior:**
When clicking a KPI card:
1. Switch to corresponding tab
2. Preserve existing filters (date, warehouse, item)

**Performance note:**
Use shallow routing (router.replace with scroll: false) to avoid full page reloads when updating URL params.
  </action>
  <verify>
Run `npm run dev` and test:
1. Open filter popover, set date range - chips appear
2. Apply filters - URL updates, KPIs and table update
3. Remove a chip - filter cleared, data updates
4. Clear all - all filters reset
5. Refresh page - filters persist from URL
6. Share URL with filters - recipient sees filtered view
7. Change tab - filters preserved
8. Click KPI card - switches tab, preserves filters
  </verify>
  <done>
Filters fully integrated with URL persistence.
KPIs update when filters change.
Filter chips show active filters with remove functionality.
  </done>
</task>

</tasks>

<verification>
1. Type check passes: `npm run type-check`
2. Dev server runs: `npm run dev`
3. Filter popover opens with all sections (date, warehouse, item)
4. Applying filters updates URL params
5. KPIs update to reflect filtered data
6. Table shows only filtered transactions
7. Filter chips appear for active filters
8. Removing chip clears that filter
9. "Clear all" removes all filters
10. Page refresh preserves filters
11. Tab switching preserves filters
12. Page resets to 1 when filters change
</verification>

<success_criteria>
- [ ] FilterPopover component with date range, warehouse, item filters
- [ ] FilterChips component showing active filters
- [ ] Filters persist in URL search params
- [ ] KPIs update when filters change
- [ ] Transaction table filters based on active filters
- [ ] Removing filter chip clears that filter
- [ ] "Clear all" removes all filters
- [ ] Page resets to 1 when filters change
- [ ] Tab counts reflect filtered totals
</success_criteria>

<output>
After completion, create `.planning/phases/10-inventory-dashboard/10-02-SUMMARY.md`
</output>
