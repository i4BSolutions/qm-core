---
phase: 07-ux-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(dashboard)/po/new/page.tsx
  - app/(dashboard)/invoice/new/page.tsx
  - app/(dashboard)/inventory/stock-in/page.tsx
  - app/(dashboard)/inventory/stock-out/page.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "PO form exchange rate shows placeholder when empty"
    - "Invoice form exchange rate shows placeholder when empty"
    - "Stock-in form quantity and unit cost show placeholders when empty"
    - "Stock-out form quantity shows placeholder when empty"
    - "All numeric inputs reject negative values and scientific notation"
  artifacts:
    - path: "app/(dashboard)/po/new/page.tsx"
      provides: "Empty string exchange rate with placeholder"
      contains: "useState.*\"\""
    - path: "app/(dashboard)/invoice/new/page.tsx"
      provides: "Empty string exchange rate with placeholder"
      contains: "useState.*\"\""
    - path: "app/(dashboard)/inventory/stock-in/page.tsx"
      provides: "Empty string quantity and unit cost"
      contains: "useState.*\"\""
    - path: "app/(dashboard)/inventory/stock-out/page.tsx"
      provides: "Empty string quantity"
      contains: "useState.*\"\""
  key_links:
    - from: "all forms"
      to: "form calculations"
      via: "parseFloat with fallback"
      pattern: "parseFloat.*\\|\\|"
---

<objective>
Propagate number input UX fixes to all transaction-related forms: PO creation, Invoice creation, Stock-In, and Stock-Out.

Purpose: Users can type directly into number fields across all inventory and financial forms without needing to clear default values first.

Output: All forms use empty string state for number inputs with placeholder display and keyboard validation.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-ux-polish/07-CONTEXT.md
@.planning/phases/07-ux-polish/07-RESEARCH.md
@app/(dashboard)/po/new/page.tsx
@app/(dashboard)/invoice/new/page.tsx
@app/(dashboard)/inventory/stock-in/page.tsx
@app/(dashboard)/inventory/stock-out/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix PO and Invoice form number inputs</name>
  <files>
app/(dashboard)/po/new/page.tsx
app/(dashboard)/invoice/new/page.tsx
  </files>
  <action>
**PO Create Form (`app/(dashboard)/po/new/page.tsx`):**

1. Change exchange rate state (around line 70):
   ```typescript
   // FROM:
   const [exchangeRate, setExchangeRate] = useState(1);
   // TO:
   const [exchangeRate, setExchangeRate] = useState<string>("");
   ```

2. Update any calculation that uses exchangeRate to parse it:
   ```typescript
   // Example: const rate = parseFloat(exchangeRate) || 1;
   ```
   Look for `exchangeRate` usage in calculations like poTotalEusd and update accordingly.

3. Find the exchange rate Input JSX and update:
   - Change `value={exchangeRate}` to `value={exchangeRate}`
   - Change `onChange` to work with string: `onChange={(e) => setExchangeRate(e.target.value)}`
   - Add `placeholder="1.0000"`
   - Add onKeyDown handler to block minus/e:
     ```typescript
     onKeyDown={(e) => {
       if (e.key === "-" || e.key === "e" || e.key === "E") {
         e.preventDefault();
       }
     }}
     ```

4. Line items table (quantity/unit_price) - if using numeric defaults like `quantity: 1, unit_price: 0` in the initial line item object, consider keeping as-is since these are table cells where default values provide better UX (user sees what they're editing). BUT do add onKeyDown negative prevention to those inputs if they exist as direct Input elements.

**Invoice Create Form (`app/(dashboard)/invoice/new/page.tsx`):**

1. Change exchange rate state (around line 68):
   ```typescript
   // FROM:
   const [exchangeRate, setExchangeRate] = useState(1);
   // TO:
   const [exchangeRate, setExchangeRate] = useState<string>("");
   ```

2. Update calculations to use `parseFloat(exchangeRate) || 1`.

3. Update the exchange rate Input JSX similar to PO form:
   - String value, string onChange
   - placeholder="1.0000"
   - onKeyDown to block minus/e

4. For validation on submit, ensure it checks `parseFloat(exchangeRate) > 0`.

**Common Pattern for both:**

The Input element for exchange rate should look like:
```typescript
<Input
  type="number"
  min="0.0001"
  step="0.0001"
  value={exchangeRate}
  onChange={(e) => setExchangeRate(e.target.value)}
  onKeyDown={(e) => {
    if (e.key === "-" || e.key === "e" || e.key === "E") {
      e.preventDefault();
    }
  }}
  placeholder="1.0000"
  className="[existing classes] [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
/>
```
  </action>
  <verify>
Run: `npm run build`
Test PO form: Navigate to `/po/new`, verify exchange rate shows placeholder "1.0000"
Test Invoice form: Navigate to `/invoice/new`, verify exchange rate shows placeholder
Test both: Verify cannot type minus key in exchange rate
  </verify>
  <done>
PO and Invoice forms show placeholder for exchange rate, accept direct typing, and reject negative values.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Stock-In and Stock-Out form number inputs</name>
  <files>
app/(dashboard)/inventory/stock-in/page.tsx
app/(dashboard)/inventory/stock-out/page.tsx
  </files>
  <action>
**Stock-In Form (`app/(dashboard)/inventory/stock-in/page.tsx`):**

1. Find manual mode state variables (around lines 103-105):
   ```typescript
   // FROM:
   const [manualQuantity, setManualQuantity] = useState<number>(1);
   const [manualUnitCost, setManualUnitCost] = useState<number>(0);
   // TO:
   const [manualQuantity, setManualQuantity] = useState<string>("");
   const [manualUnitCost, setManualUnitCost] = useState<string>("");
   ```

2. Update any calculations using these values:
   ```typescript
   const qty = parseFloat(manualQuantity) || 0;
   const cost = parseFloat(manualUnitCost) || 0;
   ```

3. Find the Input JSX for manualQuantity and update:
   - `value={manualQuantity}`
   - `onChange={(e) => setManualQuantity(e.target.value)}`
   - `placeholder="1"`
   - Add onKeyDown to block minus/e

4. Find the Input JSX for manualUnitCost and update:
   - `value={manualUnitCost}`
   - `onChange={(e) => setManualUnitCost(e.target.value)}`
   - `placeholder="0.00"`
   - Add onKeyDown to block minus/e

5. Update validation on submit to check parsed values are valid.

**Stock-Out Form (`app/(dashboard)/inventory/stock-out/page.tsx`):**

1. Find quantity state (around line 73):
   ```typescript
   // FROM:
   const [quantity, setQuantity] = useState<number>(1);
   // TO:
   const [quantity, setQuantity] = useState<string>("");
   ```

2. Update any calculations or validations using quantity:
   ```typescript
   const qty = parseFloat(quantity) || 0;
   ```

3. Find the Input JSX for quantity and update:
   - `value={quantity}`
   - `onChange={(e) => setQuantity(e.target.value)}`
   - `placeholder="1"`
   - Add onKeyDown to block minus/e

4. Update validation - stock out should require qty > 0 and qty <= available stock.

**Common considerations:**

- For inputs already using min="0" or min="1", keep those attributes for form validation fallback
- The onKeyDown handler prevents typing minus but user could still paste - if paranoid, add onPaste handler too, but keyboard blocking is the primary requirement
- Quantity inputs typically need integer values - consider step="1" for those vs step="0.01" for costs

Spinner button CSS (if not already present):
```css
[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none
```
  </action>
  <verify>
Run: `npm run build`
Test Stock-In: Navigate to `/inventory/stock-in`, select Manual mode, verify quantity shows placeholder "1" and unit cost shows "0.00"
Test Stock-Out: Navigate to `/inventory/stock-out`, verify quantity shows placeholder "1"
Test both: Verify cannot type minus key in any number field
  </verify>
  <done>
Stock-In and Stock-Out forms show placeholders for numeric fields, accept direct typing, and reject negative values.
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` completes without errors
2. PO form: Exchange rate field shows "1.0000" placeholder when empty
3. Invoice form: Exchange rate field shows "1.0000" placeholder when empty
4. Stock-In form (manual mode): Quantity shows "1" placeholder, unit cost shows "0.00" placeholder
5. Stock-Out form: Quantity shows "1" placeholder
6. All forms: Cannot type "-" in number fields
7. All forms: Submitting with valid data works correctly (no NaN or undefined)
</verification>

<success_criteria>
- UX-02 (complete): All number input fields use empty placeholders instead of default values
- UX-03 (complete): All number input fields reject negative values via keyboard blocking
- Forms remain functional: Calculations use parseFloat with fallbacks, validation works
</success_criteria>

<output>
After completion, create `.planning/phases/07-ux-polish/07-02-SUMMARY.md`
</output>
