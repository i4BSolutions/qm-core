---
phase: 07-ux-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/ui/calendar.tsx
  - components/qmhq/transaction-dialog.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Transaction date picker displays DD/MM/YYYY format consistently"
    - "Calendar allows month/year selection via dropdown (not just arrows)"
    - "Exchange rate input shows placeholder when empty, not '1'"
    - "Number inputs reject negative values via keyboard"
  artifacts:
    - path: "components/ui/calendar.tsx"
      provides: "Month/year dropdown navigation"
      contains: "captionLayout"
    - path: "components/qmhq/transaction-dialog.tsx"
      provides: "DatePicker integration for transaction date"
      contains: "DatePicker"
  key_links:
    - from: "components/qmhq/transaction-dialog.tsx"
      to: "components/ui/date-picker.tsx"
      via: "DatePicker component import"
      pattern: "import.*DatePicker"
---

<objective>
Fix transaction dialog UX: replace native date input with DatePicker component, enhance Calendar with month/year dropdowns, and improve number input behavior for exchange rate field.

Purpose: Users experience consistent DD/MM/YYYY date format in transaction forms with intuitive month/year navigation, and can type directly into number fields without clearing default values first.

Output: Updated Calendar component with dropdown navigation, transaction dialog using DatePicker with proper number input UX.
</objective>

<execution_context>
@C:\Users\User\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\User\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-ux-polish/07-CONTEXT.md
@.planning/phases/07-ux-polish/07-RESEARCH.md
@components/ui/calendar.tsx
@components/ui/date-picker.tsx
@components/qmhq/transaction-dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance Calendar with month/year dropdown navigation</name>
  <files>components/ui/calendar.tsx</files>
  <action>
Update the Calendar component to use react-day-picker's `captionLayout` prop for month/year dropdowns:

1. Add to DayPicker props:
   - `captionLayout="dropdown-buttons"` - Shows month AND year dropdowns plus nav arrows
   - `fromYear={2020}` - Earliest year in dropdown
   - `toYear={2030}` - Latest year in dropdown

2. Add classNames for dropdown styling (dark theme consistent):
   - `dropdown: "bg-slate-800 border-slate-700 text-slate-200 rounded px-2 py-1 text-sm"`
   - `dropdown_month: "mr-2"`
   - `dropdown_year: ""`
   - `caption_dropdowns: "flex gap-2"`

3. Keep all existing classNames (don't remove any current styling).

4. The nav arrows should remain (that's what "dropdown-buttons" provides vs just "dropdown").

Why dropdown-buttons: CONTEXT.md specifies "month/year navigation via dropdowns" but keeping arrows provides both quick sequential and jump navigation.
  </action>
  <verify>
Run: `npm run build`
Manually test: Open any page with DatePicker (e.g., PO create form), verify calendar shows month and year dropdowns above the days grid.
  </verify>
  <done>
Calendar displays month and year dropdowns, allowing users to jump to distant dates quickly. Existing arrow navigation preserved for sequential month stepping.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update transaction dialog to use DatePicker and fix number inputs</name>
  <files>components/qmhq/transaction-dialog.tsx</files>
  <action>
Replace native date input with DatePicker component and fix number input behavior:

**Date Input Change:**

1. Add import at top:
   ```typescript
   import { DatePicker } from "@/components/ui/date-picker";
   ```

2. Change state type (line 71-73):
   ```typescript
   // FROM:
   const [transactionDate, setTransactionDate] = useState(
     new Date().toISOString().split("T")[0]
   );
   // TO:
   const [transactionDate, setTransactionDate] = useState<Date>(new Date());
   ```

3. Update resetForm() (line 91):
   ```typescript
   // FROM:
   setTransactionDate(new Date().toISOString().split("T")[0]);
   // TO:
   setTransactionDate(new Date());
   ```

4. Replace JSX (lines 387-399):
   ```typescript
   // FROM:
   <Input
     id="transaction_date"
     type="date"
     value={transactionDate}
     onChange={(e) => setTransactionDate(e.target.value)}
     className="bg-slate-800/50 border-slate-700 text-slate-200"
   />
   // TO:
   <DatePicker
     date={transactionDate}
     onDateChange={(date) => date && setTransactionDate(date)}
   />
   ```

5. Update submit handler (line 196):
   ```typescript
   // FROM:
   transaction_date: transactionDate,
   // TO:
   transaction_date: transactionDate.toISOString().split("T")[0],
   ```

**Exchange Rate Input Fix:**

6. Change initial state (line 70):
   ```typescript
   // FROM:
   const [exchangeRate, setExchangeRate] = useState("1");
   // TO:
   const [exchangeRate, setExchangeRate] = useState("");
   ```

7. Update resetForm() (line 90):
   ```typescript
   // FROM:
   setExchangeRate("1");
   // TO:
   setExchangeRate("");
   ```

8. The calculatedEusd already handles empty string correctly (line 81 uses `|| 1`).

9. Add onKeyDown handler to both amount and exchangeRate inputs to block minus/e keys:
   ```typescript
   onKeyDown={(e) => {
     if (e.key === "-" || e.key === "e" || e.key === "E") {
       e.preventDefault();
     }
   }}
   ```

The placeholder="1.0000" is already set for exchange rate, so it will display when empty.
  </action>
  <verify>
Run: `npm run build`
Run: `npm run dev`
Test flow:
1. Navigate to QMHQ detail page with expense or po route
2. Click "Add Transaction" button
3. Verify: Transaction Date shows DD/MM/YYYY format with calendar dropdown
4. Verify: Exchange Rate field shows placeholder "1.0000" (not "1")
5. Verify: Cannot type minus key in amount or exchange rate
6. Submit a test transaction, verify date saves correctly
  </verify>
  <done>
Transaction dialog uses DatePicker with DD/MM/YYYY format. Exchange rate shows placeholder when empty. Minus key blocked on numeric inputs.
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` completes without errors
2. Calendar dropdown: Any DatePicker shows month/year dropdowns in calendar
3. Transaction date format: Transaction dialog displays DD/MM/YYYY
4. Empty placeholder: Exchange rate shows "1.0000" placeholder when field is empty
5. Negative blocking: Cannot type "-" in amount or exchange rate fields
</verification>

<success_criteria>
- UX-01 (partial): Transaction date picker displays DD/MM/YYYY format matching system standard
- UX-02 (partial): Exchange rate field uses empty placeholder instead of default "1"
- UX-03 (partial): Transaction dialog number inputs reject negative values
- Calendar dropdowns work across all DatePicker instances
</success_criteria>

<output>
After completion, create `.planning/phases/07-ux-polish/07-01-SUMMARY.md`
</output>
